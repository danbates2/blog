<!doctype html>
  <!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
  <!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
  <!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
  <!--[if gt IE 8]><!--> <html> <!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>High Accuracy Current Measurement Over a Wide Range - Blog | OpenEnergyMonitor</title>
    <meta name="author" content="Glyn Hudson">
    <meta name="description" content="OpenEnergyMonitor Blog">
    
    <meta name="viewport" content="width=device-width">
    <link rel="canonical" href="https://blog.openenergymonitor.org/2012/06/high-accuracy-current-measurement-over/">

    <meta property="fb:app_id" content="">
    <meta property="og:title" content="High Accuracy Current Measurement Over a Wide Range">
    <meta property="og:site_name" content="Blog | OpenEnergyMonitor">
    <meta property="og:url" content="https://blog.openenergymonitor.org/2012/06/high-accuracy-current-measurement-over/">
    <meta property="og:type" content="article">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@openenergymon">
    
    <meta name="twitter:title" content="High Accuracy Current Measurement Over a Wide Range">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
    <link href="/atom.xml" rel="alternate" title="Blog | OpenEnergyMonitor" type="application/atom+xml">
    <link rel='shortcut icon' href='/images/favicon.ico' />
    <link rel='icon' type='image/png' href='/images/favicon-192x192.png' sizes='192x192' />
    
    
    
    <link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<link rel="icon" type="image/png" sizes="196x196" href="/images/favicon-192.png">
	<link rel="icon" type="image/png" sizes="160x160" href="/images/favicon-160.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96.png">
	<link rel="icon" type="image/png" sizes="64x64" href="/images/favicon-64.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.png">
	<link rel="apple-touch-icon" href="/images/favicon-57.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/images/favicon-114.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/images/favicon-72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/images/favicon-144.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/images/favicon-60.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/images/favicon-120.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/images/favicon-76.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/images/favicon-152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-180.png">
	<meta name="msapplication-TileColor" content="#FFFFFF">
	<meta name="msapplication-TileImage" content="/images/favicon-144.png">
	<meta name="msapplication-config" content="/images/browserconfig.xml">
	
  </head>

  <body >

    <header>
      <div class="grid-wrapper">
  <div class="grid">

    <div class="grid__item three-tenths lap-two-sixths palm-one-whole ha-title">
  <a href="/" class="site-title">
    <!--<img width='40' src='/images/favicon-192x192.png'> -->
    
    <span style="color:#555;font-weight:bold;font-family:Arial;font-size:20"'>
Open</span><span style="color:#0699fa;font-weight:bold;font-family:Arial;font-size:20"'>EnergyMonitor</span>

  </a>
</div>

<div class="grid__item seven-tenths lap-four-sixths palm-one-whole">
  <nav>
    <input type="checkbox" id="toggle">
<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu"></label>
<ul class="menu pull-right">
  <li><a href="https://openenergymonitor.org">Main Site</a></li>
  <li><a href="https://guide.openenergymonitor.org">User Guide</a></li>
  <li><a href="https://emoncms.org">Emoncms</a></li>
  <li><a href="https://community.openenergymonitor.org">Community</a></li>
  <li><a href="https://shop.openenergymonitor.com    ">Shop<i class="icon icon-shopping-cart"></i></a></li>
</ul>
  </nav>
</div>

  </div>
</div>
    </header>

    

    <div class="grid-wrapper">
      <div class="grid grid-center">
        
        <div class="grid__item two-thirds lap-one-whole palm-one-whole">
        

          <article class="post">
  <div class='edit-github'><a href='https://github.com/openenergymonitor/blog/tree/master/source/_posts/2012-06-01-high-accuracy-current-measurement-over.html'>Edit on GitHub</a></div>
<div class='edit-github'><a href='http://prose.io/#openenergymonitor/blog/edit/master/source/_posts/2012-06-01-high-accuracy-current-measurement-over.html'>Edit on GitHub Prose</a></div>
  
  <header>
  
  <h1 class="title indent">High Accuracy Current Measurement Over a Wide Range</h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-06-01T08:59:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-06-01 08:59:00 +00002012-06-01 08:59:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Glyn Hudson</span> <br>
    <span><i class='icon-time'></i> four minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emontx/'>emonTx</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/06/high-accuracy-current-measurement-over/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-GixykaE-ywU/T8PzXCzm_OI/AAAAAAAAbos/tf7V3XFQUVM/s1600/DSCF5036.JPG" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><br /></a><a href="http://2.bp.blogspot.com/-GixykaE-ywU/T8PzXCzm_OI/AAAAAAAAbos/tf7V3XFQUVM/s1600/DSCF5036.JPG" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><br /></a></div><div style="text-align: left;">Measuring the current in a domestic property using a clip-on CT sensor can be quite&nbsp;challenging&nbsp;since the range in which it has to work over is very large, potentially several order of magnitude: up to 25000W and down to a few 10'sW. We would like to have good accuracy over this wide range.&nbsp;</div><div style="text-align: left;"><br /></div><div>We have been exploring how to improve on the current emonTx. Robert Wall has written a page&nbsp;<a href="http://openenergymonitor.org/emon/node/712">detailing the measurement implications of current emonTx ADC</a> resolution at low current values when using&nbsp;the standard 100A max CT sensor and 18R burden resistor.&nbsp;</div><div style="text-align: left;"><br /></div><div style="text-align: left;">A while back we came across an application note from ATmel detailing how to build a fully featured energy monitor using CT sensor, AC voltage measurement and the ATmega328 MCU. App-notes are a fantastic source for&nbsp;open-source hardware information. The ATmel energy monitor app-note is very&nbsp;comprehensive&nbsp;and well written. It's even got a Bill of Materials that specs down to individual resistors&nbsp;complete&nbsp;with their corresponding Farrnel order codes!&nbsp;</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Download the app-note .pdf here:&nbsp;<a href="http://www.atmel.com/Images/doc2566.pdf" style="text-align: -webkit-auto;">www.atmel.com/Images/doc2566.pdf</a></div><div style="text-align: left;"><br /></div><div style="text-align: left;"></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-Z6-WTfCXnfY/T9S-l-RCp3I/AAAAAAAAbrk/eYv7rMySnNQ/s1600/Labeled+Atmel+Energy+Monitor+app+note.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="278" src="http://3.bp.blogspot.com/-Z6-WTfCXnfY/T9S-l-RCp3I/AAAAAAAAbrk/eYv7rMySnNQ/s640/Labeled+Atmel+Energy+Monitor+app+note.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Diagram from Atmel app-note - potential divider resistor values where changed to enabled the AC signal to be biased to Vcc/2</td></tr></tbody></table><div class="separator" style="clear: both; text-align: left;"><span style="text-align: -webkit-auto;">The app-note circuit&nbsp;achieves&nbsp;good resolution and accuracy over a wide range by having a adjustable op-amp gain stage. Using the resistor values in the inverting op-amp the gain can be switched from -1.25, -10.26 and -69.11. The gain is switched by digital switching the&nbsp;</span>Bilateral Switches (74HC4066). The gain of the op-amp is calculated as follows:</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-1V3jCpeeRMY/T8hxqXH0PxI/AAAAAAAAbpo/xs9OuQ7T3uU/s1600/Labeled+Atmel+Energy+Monitor+app+note.png" imageanchor="1"><img border="0" height="122" src="http://1.bp.blogspot.com/-1V3jCpeeRMY/T8hxqXH0PxI/AAAAAAAAbpo/xs9OuQ7T3uU/s640/Labeled+Atmel+Energy+Monitor+app+note.png" width="640" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">A couple of days a ago we built up a prototype of the above circuit, more an an exercise to check we can make it work rather than a scientific test, this would be difficult on a breadboard due to the sub-optimal circuit layout. A spare emonTx PCB was used as an easy way to connect the circuit up to an ATmega328 and RFM12B.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-GixykaE-ywU/T8PzXCzm_OI/AAAAAAAAbos/tf7V3XFQUVM/s1600/DSCF5036.JPG" imageanchor="1" style="margin-left: auto; margin-right: auto; text-align: left;"><img border="0" height="240" src="http://2.bp.blogspot.com/-GixykaE-ywU/T8PzXCzm_OI/AAAAAAAAbos/tf7V3XFQUVM/s320/DSCF5036.JPG" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Adjustable gain op-amp CT sensor circuit - prototype&nbsp;</td></tr></tbody></table><div class="separator" style="clear: both; text-align: center;"></div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-wyzX5ePzs20/T8Pz6eMV-GI/AAAAAAAAbo4/a1kLW5rIbc0/s1600/sample02.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="400" src="http://2.bp.blogspot.com/-wyzX5ePzs20/T8Pz6eMV-GI/AAAAAAAAbo4/a1kLW5rIbc0/s640/sample02.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">ATmega 328 ADC sample using <a href="http://openenergymonitor.org/emon/node/110">VI sampler</a></td></tr></tbody></table><div class="separator" style="clear: both; text-align: left;">The circuit worked first time with no&nbsp;hiccups. The above waveform is the RAW output from an ATmega 328's ADC, where one 100W light bulb and 30W laptop PSU was connected to the AC circuit being monitored. The high gain stage (x69.11) was active. To put this in perspective if the same sample was run on the current emonTx the signal would be so small as to be only just visible on the VI sampler. The spikes at the peak of the waveform is caused by the laptop's switch-mode PSU. The significantly increased amplitude of the signal will improve accuracy when monitoring low power levels. The app-note suggests accuracy of &lt;1% over a wide range, possibly even better with careful PCB design.&nbsp;</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Although this multi-gain op-amp circuit adds significant complexity over the current emonTx current monitoring circuit it can be added for relatively low cost. One quad op-amp and two quad bilateral switches IC's cost about £1, this is enough for 4 x CT channels. We're planning to use this circuit design in the forthcoming emonTx SMT. As the name suggests this board will be designed for SMT components and will be assembled by pick-and-place. See <a href="http://openenergymonitor.org/emon/node/642">this forum thread</a> for a discussion regarding ideas for the emonTx SMT. Design is progressing well, more details on this soon.&nbsp;</div>
      <b>To engage in discussion regarding this post, please post on our <a href="http://community.openenergymonitor.org">Community Forum</a></b>.
    <br>
</article>



        </div>

        
        <aside id="sidebar" class="grid__item one-third lap-one-whole palm-one-whole">
          <div class="grid">

 
 <section id="recent-posts" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">Recent Posts</h1>
  <ul class="divided">
    
      
        <li class="post">
          <a href="/2016/09/summer-placement/">Summer Placement</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/08/ecohomelab-control/">EcoHome Lab: From Monitoring to Control</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/07/HTU21D-Temperature-Humidity-sensor/">HTU21D / Si72021 Temperature and Humidity Sensor</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/06/esp8266-ota-update/">Part 3/3: Continuous Deployment (Over-The-Air Update to ESP8266)</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/06/emoncms-docker/">Emoncms Docker</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/06/esp8266-emonesp-developments/">ESP8266 WIFI developments</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/06/auto-build-continuous-test-firmware/">Part 2/3: Firmware Continuous Test & Build</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/06/platformio/">Part 1/3: PlatformIO open-source embedded development ecosystem</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/06/emonpi-vrms-line-fault/">Electrical Supply Line Vault</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/05/emonsd-update-03may16/">Substantial update to emonPi / emonBase: emonSD-03-May16 pre-built image release</a>
        </li>
      
    
  </ul>
</section>
  
  
</div>
        </aside>
        
      </div>
    </div>

    <footer>
      <div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item">
      <style>


div.searchtool {
  position: relative;
  display: inline-block;
  top: -6px;
}

input[type=text] {
  border: 3px solid #0699fa;
}

fieldset {
  border: 0;
}

</style>
<div class="copyright">

  <a rel="me" href='https://twitter.com/openenergymon'><i class="icon-twitter"></i></a>
  <a rel="me" href='https://github.com/openenergymonitor/guide'><i class="icon-github"></i></a>
  <a rel="me" href='https://blog.openenergymonitor.org/feed.xml'><i class="icon-rss"></i></a>

  <div class="credit">
    Website powered by <a href='http://jekyllrb.com/'>Jekyll</a> and <a href='https://github.com/coogie/oscailte'>Oscalite</a>.<br />
    Hosted by <a href='https://pages.github.com/'>GitHub</a> and served by <a href='https://cloudflare.com'>CloudFlare</a>.
  </div>

<div class="searchtool">


<form action="https://encrypted.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.openenergymonitor.org" />
    <input class="search" id="search" type="text" name="q" results="0" placeholder="Search..." />
  </fieldset>
</form>


</div>
</div>
    </div>
  </div>
</div>
    </footer>

    <!--[if lt IE 7]>
      <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->

    <script>
  var _gaq=[['_setAccount','UA-10321170-4'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
<script>
  var disqus_shortname = 'openenergymonitor';
  
    
    var disqus_script = 'count.js';
  
  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>


<script>
  $(document).ready(function(){
    if (!window.jXHR){
      var jxhr = document.createElement('script');
      jxhr.type = 'text/javascript';
      jxhr.src = '/javascripts/libs/jXHR.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jxhr, s);
    }

    github.showRepos({
      user: 'openenergymonitor',
      count: 5,
      skip_forks: true,
      target: '#gh_repos'
    });
  });
</script>
<script src="/javascripts/github.js"></script>

  </body>
</html>