---
layout: post
title: New emoncms features part 2 - Email notifier
date: '2012-02-18T15:31:00.000-08:00'
author: Trystan Lea
categories:
- email notifications
- emoncms
- energy monitoring
- openenergymonitor
modified_time: '2012-02-18T15:36:42.041-08:00'
thumbnail: http://1.bp.blogspot.com/-oUq0bwGDyiQ/T0AoJkpEZNI/AAAAAAAACX0/cI3odOAz6P8/s72-c/notift_feedview.png
blogger_id: tag:blogger.com,1999:blog-2472065242652647619.post-1560737763105431114
blogger_orig_url: http://openenergymonitor.blogspot.com/2012/02/emoncms-features-part-2-email-notifier.html
---

<div class="separator" style="clear: both; text-align: left;">Its good to know as soon as possible if there is an issue with an installed energy monitor, such as the base station dropping offline or a problem with RF connection. This is a rough and ready first implementation of an email notifier for emoncms, that sends you an email to say that a feed has become inactive or a feed is&nbsp;equal&nbsp;to a certain value. No longer are the days when you log in to emoncms just to find that there are two days of missing data as&nbsp;happened&nbsp;to me on feb 6-7 <a href="http://openenergymonitor.org/emon/emoncms/showcase">here</a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><b>A walkthrough</b></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">1) Click on a feed in the feed list to bring up the feed view page, scroll down to the bottom and click on set notifications:</div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-oUq0bwGDyiQ/T0AoJkpEZNI/AAAAAAAACX0/cI3odOAz6P8/s1600/notift_feedview.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="230" src="http://1.bp.blogspot.com/-oUq0bwGDyiQ/T0AoJkpEZNI/AAAAAAAACX0/cI3odOAz6P8/s320/notift_feedview.png" width="320" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">2) Select the events that you want notifications for. Notification on value and on inactive both work. Periodic notification is yet to be implemented.</div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-Q8in3h0PPZ0/T0AoeSLmCFI/AAAAAAAACX8/GXJCyeeQjZU/s1600/notify_feedsettings.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="320" src="http://3.bp.blogspot.com/-Q8in3h0PPZ0/T0AoeSLmCFI/AAAAAAAACX8/GXJCyeeQjZU/s320/notify_feedsettings.png" width="216" /></a></div><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />3) Click on edit mail settings and enter in the recipient email address. This only has to be done once as it is the same for all notifications.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-4U29I5trf2c/T0ApRWFl_5I/AAAAAAAACYE/0z7LJZ02xMQ/s1600/notify_recipients.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="222" src="http://1.bp.blogspot.com/-4U29I5trf2c/T0ApRWFl_5I/AAAAAAAACYE/0z7LJZ02xMQ/s320/notify_recipients.png" width="320" /></a></div><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />If you want to send the notifications to multiple&nbsp;addresses, just put in a comma between each address.<br /><br />4) Unplug your emonbase!! and check your email:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-_woWFUXfPMo/T0ApmAkoAlI/AAAAAAAACYM/GlkiXxJQ-uM/s1600/notify_emailsubject.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="19" src="http://3.bp.blogspot.com/-_woWFUXfPMo/T0ApmAkoAlI/AAAAAAAACYM/GlkiXxJQ-uM/s320/notify_emailsubject.png" width="320" /></a></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-r3iUkNr2rbs/T0AppLU7ICI/AAAAAAAACYU/CHQufBFe38s/s1600/notift_emailbody.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="95" src="http://1.bp.blogspot.com/-r3iUkNr2rbs/T0AppLU7ICI/AAAAAAAACYU/CHQufBFe38s/s320/notift_emailbody.png" width="320" /></a></div><b><br /></b><br /><b><br /></b><br /><b><br /></b><br /><b><br /></b><br /><b><br /></b><br /><div style="text-align: left;"><b><br /></b></div><div style="text-align: left;">It can be tried out here:&nbsp;<a href="http://vis.openenergymonitor.org/emoncms3">http://vis.openenergymonitor.org/emoncms3</a></div><b><br /></b><br /><b>Behind the scenes</b><br /><b><br /></b><br /><b>Main scripts:</b><br /><b><span class="Apple-style-span" style="font-weight: normal;"></span></b><br /><b><a href="https://github.com/openenergymonitor/emoncms3/blob/master/Models/notify_model.php">notify_model.php</a></b><br /><b><a href="https://github.com/openenergymonitor/emoncms3/blob/master/Models/mail_model.php">mail_model.php</a></b><br /><b><a href="https://github.com/openenergymonitor/emoncms3/blob/master/Controllers/notify_controller.php">notify_controller.php</a></b><br /><b><a href="https://github.com/openenergymonitor/emoncms3/blob/master/Views/notify_view.php">notify_view.php</a></b><br /><br /><b><br /></b><br /><b>Installation/Setup</b><br />1) To use the notifier on your own server you will need php mail installed, to do this on ubuntu enter the following into terminal<br /><br /><span class="Apple-style-span" style="background-color: white; color: #222222; font-family: Arial, Tahoma, Helvetica, FreeSans, sans-serif; font-size: 13px; line-height: 18px;">sudo apt-get install php-pear<br />sudo pear install mail<br />sudo pear install Net_SMTP<br />sudo pear install Auth_SASL<br />sudo pear install mail_mime</span><br /><b><br /></b><br />2) In emoncms3/Includes copy the default.mail_settings.php file and rename too<a href="https://github.com/openenergymonitor/emoncms3/blob/master/Includes/default.mail_settings.php"> mail_settings.php</a> and enter in your mail server settings.<br /><br />3) Open the file <a href="https://github.com/openenergymonitor/emoncms3/blob/master/cron.php">cron.php</a>&nbsp;and change the key password to something unique, this is used to ensure that only you can run the cron.php script.<br /><br />4) Create a cronjob, in ubuntu start by opening crontab:&nbsp;$ crontab -e<br />Then add a cronjob that calls the cron.php script including the key that you created. To call the cron.php script once a&nbsp;minute&nbsp;try the following:<br /><br /><br /># m h &nbsp;dom mon dow &nbsp; command<br />* * * * * wget -q -O /dev/null "http://localhost/emoncms3/cron.php?key=YOURKEY<br /><br /><br />5) If your using the same database as a previous emoncms version, you will need to create the new notify database tables. This can be done in index.php by pasting <b>require "Includes/setup.php"; </b>in the top. Its probably worth removing it afterwards.<br /><br />6) Configure your feeds as in the screens above!