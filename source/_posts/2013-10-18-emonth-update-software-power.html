---
layout: post
title: emonTH Update - Software and Power Consumption
date: '2013-10-18T05:47:00.000-07:00'
author: Glyn Hudson
categories:
- emonTH
modified_time: '2013-10-23T14:22:41.391-07:00'
thumbnail: http://4.bp.blogspot.com/-QFt-6GpofiA/UmEUeKZLmaI/AAAAAAAAmRY/ceFV--053-4/s72-c/DS2_QuickPrint19_DS28B20_incorrect+power_correct+time.png
blogger_id: tag:blogger.com,1999:blog-2472065242652647619.post-7429503480580689874
blogger_orig_url: http://blog.openenergymonitor.org/2013/10/emonth-update-software-power.html
---

Today I have spent some time writing the software for the emonTH. The goal for the emonTH is for it to last as long as possible from batteries (2 x AA's). The boost converter circuit as highlighted in my previous post will go someway to increasing battery life, however most gains in battery life will come from the software (ATmega328 Arduino sketch) .<br /><br />The emonTH supports both the DHT22 (humidity and temperature) and DS18B20 either onboard or remote temperature sensor. The default software will search for the presence of either sensor at startup. If both sensors are found it will return humidity from the DHT22 and temperature from the DS128B20. If only the DHT22 is found it will return both humidity and temperature readings from this sensor, finally if only the DS18B20 is found only temperature readings will be returned. In the future I would like to expand the code to support multiple DS18B20 sensors on the one-wire bus.<br /><br />I have implemented many of the power saving tricks as <a href="http://harizanov.com/2013/08/every-%CE%BCa-counts/">Martin Harizanov</a> has used in his <a href="https://github.com/mharizanov/new_Funky/blob/master/examples/Funky_DS18B20_plus_powersave/Funky_DS18B20_plus_powersave.ino">Funky Sensor code</a>, in particular the his&nbsp;<a href="http://harizanov.com/2013/07/optimizing-ds18b20-code-for-low-power-applications/">DS18B20 power saving tweaks</a>. Martin has done some great work optimising power and designing some very small low power nodes, his blog is well worth a read.<br /><br />The emonTH code (in beta) is now up on Github:&nbsp;<a href="https://github.com/openenergymonitor/emonth">https://github.com/openenergymonitor/emonth</a><br /><br />The power consumption results are as follows, assuming one reading is taken per min and using this <a href="http://oregonembedded.com/batterycalc.htm">battery estimation tool</a>&nbsp;assuming AA capacity of 2200mAh and not taking into account AA self-discharge*<br /><br /><h3>emonTH with DS18b20 temperature only (Vin = 2.6V)</h3><b><br /></b><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-QFt-6GpofiA/UmEUeKZLmaI/AAAAAAAAmRY/ceFV--053-4/s1600/DS2_QuickPrint19_DS28B20_incorrect+power_correct+time.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="384" src="http://4.bp.blogspot.com/-QFt-6GpofiA/UmEUeKZLmaI/AAAAAAAAmRY/ceFV--053-4/s640/DS2_QuickPrint19_DS28B20_incorrect+power_correct+time.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Blue - DS18B20 power digital power pin, Yellow - voltage drop across series resistor. Due to switching noise from the DC converter the scope was not very useful for measuring current (voltage drop across a resistor), the scope was used to measure timings and power was measured with accurate multimeter&nbsp;</td></tr></tbody></table><i>Sleep Current:</i> 0.12mA<br /><i>On current: </i>9.7mA for 70ms then peaking to 26mA for 2.8ms for RFM12B transmission, giving average of 10.2mA for 9.8ms<br /><br /><i><u>Approximate battery life of 3.5 years*</u></i><br /><br /><h3>emonTH with DHT22 (temperature &amp; humidity) only (Vin = 2.6V)</h3><b><br /></b><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-gUAkOiTNypQ/UmEUeDW0uVI/AAAAAAAAmRk/rmnypTJ-DQI/s1600/DS2_QuickPrint20_DHT22_incorrect+power+reading+correct+time.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="384" src="http://2.bp.blogspot.com/-gUAkOiTNypQ/UmEUeDW0uVI/AAAAAAAAmRk/rmnypTJ-DQI/s640/DS2_QuickPrint20_DHT22_incorrect+power+reading+correct+time.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Blue - DHT22 power digital power pin, Yellow - voltage drop across series resistor. Due to switching noise from the DC converter the scope was not very useful for measuring current (voltage drop across a resistor), the scope was used to measure timings and power was measured with accurate multimeter&nbsp;</td></tr></tbody></table><b><br /></b><i>Sleep Current: </i>0.12mA<br /><i>On current:&nbsp;</i>9.5mA for 1700ms then peaking to 26mA for 2.8 ms for RFM12B transmission giving average of 9.525mA for 1703ms<br /><br /><i><u>Approximate battery life of 1.1 years*</u></i><br /><b><br /></b> <br />*Stay tuned for the next post on <a href="http://blog.openenergymonitor.org/2013/10/aa-battery-considerations.html">AA battery considerations including how to deal with self-discharge issues</a>...