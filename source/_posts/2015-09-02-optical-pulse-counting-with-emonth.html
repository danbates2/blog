---
layout: post
title: Optical pulse counting with the EmonTH
date: '2015-09-02T05:53:00.001-07:00'
author: Trystan Lea
categories:
- optical pulse
- emonTH
modified_time: '2015-09-04T08:13:11.188-07:00'
thumbnail: http://3.bp.blogspot.com/-Mq6ZFJuLqcc/VebtplQo9rI/AAAAAAAAT14/NtBwwglgdxo/s72-c/SAM_1228.JPG
blogger_id: tag:blogger.com,1999:blog-2472065242652647619.post-6425772820372736161
blogger_orig_url: http://blog.openenergymonitor.org/2015/09/optical-pulse-counting-with-emonth.html
---

<style type="text/css">p { margin-bottom: 0.25cm; line-height: 120%; }</style>  <br /><div style="line-height: 100%; margin-bottom: 0cm;"><br /></div><div style="line-height: 100%; margin-bottom: 0cm;">In addition to temperature and humidity sensing the <a href="http://openenergymonitor.org/emon/modules/emonTH">EmonTH</a> has a digital input (with interrupt) that can be used for pulse counting.   </div><div style="line-height: 100%; margin-bottom: 0cm;"><br /></div><div style="line-height: 100%; margin-bottom: 0cm;">This can be used for <a href="http://openenergymonitor.org/emon/buildingblocks/introduction-to-pulse-counting">wired pulse counting</a> or with the <a href="http://shop.openenergymonitor.com/optical-utility-meter-led-pulse-sensor/">Optical LED pulse sensor</a>.</div><div style="line-height: 100%; margin-bottom: 0cm;"><br /></div><div style="line-height: 100%; margin-bottom: 0cm;">To use the Optical LED Pulse sensor the easiest way is to remove the RJ45 connector and then strip back the black sheathing to reveal the red (3.3V power), black (GND) and blue (pulse) wires.</div><div style="line-height: 100%; margin-bottom: 0cm;"><br /></div><div style="line-height: 100%; margin-bottom: 0cm;">Connect the red wire to the 3.3V terminal, the black wire to the GND terminal and the blue wire to the terminal labelled D3 (top) or IRQ1/D3 Pulse Counting (bottom of the board).<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://wiki.openenergymonitor.org/images/thumb/Emonth_pulse.jpg/1600px-Emonth_pulse.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://wiki.openenergymonitor.org/images/thumb/Emonth_pulse.jpg/1600px-Emonth_pulse.jpg" height="347" width="640" /></a></div><br /></div><div style="line-height: 100%; margin-bottom: 0cm;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-Mq6ZFJuLqcc/VebtplQo9rI/AAAAAAAAT14/NtBwwglgdxo/s1600/SAM_1228.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://3.bp.blogspot.com/-Mq6ZFJuLqcc/VebtplQo9rI/AAAAAAAAT14/NtBwwglgdxo/s320/SAM_1228.JPG" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-JKBIFoch2cU/VebtpvkXfcI/AAAAAAAAT18/4NYrBdD0Nlo/s1600/SAM_1229.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://2.bp.blogspot.com/-JKBIFoch2cU/VebtpvkXfcI/AAAAAAAAT18/4NYrBdD0Nlo/s320/SAM_1229.JPG" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-rIL3qPNNzt0/VebtpevfL6I/AAAAAAAAT10/ooswSPyzU_g/s1600/SAM_1230.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="480" src="http://1.bp.blogspot.com/-rIL3qPNNzt0/VebtpevfL6I/AAAAAAAAT10/ooswSPyzU_g/s640/SAM_1230.JPG" width="640" /></a></div><div style="line-height: 100%; margin-bottom: 0cm;"><br /></div><div style="line-height: 100%; margin-bottom: 0cm;"><br /></div>There are two firmware examples available for the EmonTH for pulse counting, the first is for Pulse counting in addition to DHT22 Temperature + Humidity sensing or DS18B20 temperature sensing:<br /><a href="https://github.com/openenergymonitor/emonTH/tree/master/emonTH_DHT22_DS18B20_RFM69CW_Pulse">https://github.com/openenergymonitor/emonTH/tree/master/emonTH_DHT22_DS18B20_RFM69CW_Pulse</a><br /><br />The second is for pulse counting only if the temperature and humidity sensing is not needed:<br /><a href="https://github.com/openenergymonitor/emonTH/tree/master/emonTH_pulse_lowpower">https://github.com/openenergymonitor/emonTH/tree/master/emonTH_pulse_lowpower</a><br /><br />To upload these firmware examples you will need the <a href="http://openenergymonitor.org/emon/buildingblocks/setting-up-the-arduino-environment">Arduino IDE and libraries installed</a> and a <a href="http://shop.openenergymonitor.com/programmer-usb-to-serial-uart/">USB to serial programmer</a> to upload the firmware to the EmonTH.<br /><br />The pulse count is accumulated on the EmonTH until the EmonTH is reset either by an outage or by turning off and on the power.<br /><br />To record the total accumulated pulse count in emoncms use the wh_accumulator input process which detects resets continuing the total pulse count accumulation from the last value before the reset.