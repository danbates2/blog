---
layout: post
title: Removing redundant datapoints â€“ algorithm 1
date: '2013-06-05T04:22:00.002-07:00'
author: Trystan Lea
categories:
- emoncms
modified_time: '2013-06-15T13:14:03.224-07:00'
thumbnail: http://2.bp.blogspot.com/-POXZpyzURpw/Ua8dhYHXDZI/AAAAAAAACos/u0n-xrGlb7Q/s72-c/algorithm1_01.jpg
blogger_id: tag:blogger.com,1999:blog-2472065242652647619.post-2005618110191892428
blogger_orig_url: http://openenergymonitor.blogspot.com/2013/06/removing-redundant-datapoints-algorithm.html
---

<br /><div style="margin-bottom: 0cm;">You could probably say that the aim of an algorithm that removes redundant datapoints is to create a line plot who's standard deviation compared to the raw data line is as small as possible while minimising the number of datapoints. This is probably a good rough criteria for evaluating a prospective algorithm.</div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">Here's one idea for an algorithm, I think it can certainly be improved upon but its a start.</div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">If we start with our monitor that's posting once every 10 seconds. If we note down the first datapoint received and then as subsequent datapoints come in draw a line between the first and the last datapoint.</div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-POXZpyzURpw/Ua8dhYHXDZI/AAAAAAAACos/u0n-xrGlb7Q/s1600/algorithm1_01.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="182" src="http://2.bp.blogspot.com/-POXZpyzURpw/Ua8dhYHXDZI/AAAAAAAACos/u0n-xrGlb7Q/s400/algorithm1_01.jpg" width="400" /></a></div><div style="margin-bottom: 0cm;">Then lets say there is a step change, a light goes on, suddenly the line is much higher than the actual data for most datapoints:</div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-0uEjg3xFhN0/Ua8dpNt6r5I/AAAAAAAACo0/THdnRwLHAKE/s1600/algorithm1_02.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="185" src="http://1.bp.blogspot.com/-0uEjg3xFhN0/Ua8dpNt6r5I/AAAAAAAACo0/THdnRwLHAKE/s400/algorithm1_02.jpg" width="400" /></a></div><div style="margin-bottom: 0cm;">If we measure the standard deviation of the raw datapoints vs the line to begin with it will be small, once that step change happens it will become much larger.</div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">At this point we note a significant change has happened (stdev is larger than a threshold) and create a datapoint one back from the last datapoint (the bottom of the step).</div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">We can then move our 'start' datapoint forward to this created datapoint and repeat the process. This should do a pretty good job of tracking the raw data.</div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">To test it I have created a visualisation that applies this algorithm using javascript in the browser here is the result:</div><div style="margin-bottom: 0cm;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-2S_rUF2Qns8/Ua8dyeX9RtI/AAAAAAAACo8/TXvcY5KBAC4/s1600/algorithm01_3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="173" src="http://1.bp.blogspot.com/-2S_rUF2Qns8/Ua8dyeX9RtI/AAAAAAAACo8/TXvcY5KBAC4/s400/algorithm01_3.png" width="400" /></a></div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">It works pretty well reducing 1064 datapoints to 52, but it does look messy in places.</div><div style="margin-bottom: 0cm;">To try out the code for the above, make a backup of the script:</div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;"><i>emoncms/Modules/vis/visualisations/rawdata.php</i> in your local emoncms installation.&nbsp;</div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">and replace with this:</div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;"><a href="https://github.com/emoncms/usefulscripts/blob/master/ideas/rawdata.php">https://github.com/emoncms/usefulscripts/blob/master/ideas/rawdata.php</a></div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">If you can think of a good algorithm to do this, It would be great to hear about it.</div>