---
layout: post
title: High Accuracy Current Measurement Over a Wide Range
date: '2012-06-01T01:59:00.002-07:00'
author: Glyn Hudson
categories:
- emonTx
modified_time: '2012-06-10T08:35:08.124-07:00'
thumbnail: http://3.bp.blogspot.com/-Z6-WTfCXnfY/T9S-l-RCp3I/AAAAAAAAbrk/eYv7rMySnNQ/s72-c/Labeled+Atmel+Energy+Monitor+app+note.png
blogger_id: tag:blogger.com,1999:blog-2472065242652647619.post-7449204705048649083
blogger_orig_url: http://blog.openenergymonitor.org/2012/06/high-accuracy-current-measurement-over.html
---

<div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-GixykaE-ywU/T8PzXCzm_OI/AAAAAAAAbos/tf7V3XFQUVM/s1600/DSCF5036.JPG" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><br /></a><a href="http://2.bp.blogspot.com/-GixykaE-ywU/T8PzXCzm_OI/AAAAAAAAbos/tf7V3XFQUVM/s1600/DSCF5036.JPG" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><br /></a></div><div style="text-align: left;">Measuring the current in a domestic property using a clip-on CT sensor can be quite&nbsp;challenging&nbsp;since the range in which it has to work over is very large, potentially several order of magnitude: up to 25000W and down to a few 10'sW. We would like to have good accuracy over this wide range.&nbsp;</div><div style="text-align: left;"><br /></div><div>We have been exploring how to improve on the current emonTx. Robert Wall has written a page&nbsp;<a href="http://openenergymonitor.org/emon/node/712">detailing the measurement implications of current emonTx ADC</a> resolution at low current values when using&nbsp;the standard 100A max CT sensor and 18R burden resistor.&nbsp;</div><div style="text-align: left;"><br /></div><div style="text-align: left;">A while back we came across an application note from ATmel detailing how to build a fully featured energy monitor using CT sensor, AC voltage measurement and the ATmega328 MCU. App-notes are a fantastic source for&nbsp;open-source hardware information. The ATmel energy monitor app-note is very&nbsp;comprehensive&nbsp;and well written. It's even got a Bill of Materials that specs down to individual resistors&nbsp;complete&nbsp;with their corresponding Farrnel order codes!&nbsp;</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Download the app-note .pdf here:&nbsp;<a href="http://www.atmel.com/Images/doc2566.pdf" style="text-align: -webkit-auto;">www.atmel.com/Images/doc2566.pdf</a></div><div style="text-align: left;"><br /></div><div style="text-align: left;"></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-Z6-WTfCXnfY/T9S-l-RCp3I/AAAAAAAAbrk/eYv7rMySnNQ/s1600/Labeled+Atmel+Energy+Monitor+app+note.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="278" src="http://3.bp.blogspot.com/-Z6-WTfCXnfY/T9S-l-RCp3I/AAAAAAAAbrk/eYv7rMySnNQ/s640/Labeled+Atmel+Energy+Monitor+app+note.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Diagram from Atmel app-note - potential divider resistor values where changed to enabled the AC signal to be biased to Vcc/2</td></tr></tbody></table><div class="separator" style="clear: both; text-align: left;"><span style="text-align: -webkit-auto;">The app-note circuit&nbsp;achieves&nbsp;good resolution and accuracy over a wide range by having a adjustable op-amp gain stage. Using the resistor values in the inverting op-amp the gain can be switched from -1.25, -10.26 and -69.11. The gain is switched by digital switching the&nbsp;</span>Bilateral Switches (74HC4066). The gain of the op-amp is calculated as follows:</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-1V3jCpeeRMY/T8hxqXH0PxI/AAAAAAAAbpo/xs9OuQ7T3uU/s1600/Labeled+Atmel+Energy+Monitor+app+note.png" imageanchor="1"><img border="0" height="122" src="http://1.bp.blogspot.com/-1V3jCpeeRMY/T8hxqXH0PxI/AAAAAAAAbpo/xs9OuQ7T3uU/s640/Labeled+Atmel+Energy+Monitor+app+note.png" width="640" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">A couple of days a ago we built up a prototype of the above circuit, more an an exercise to check we can make it work rather than a scientific test, this would be difficult on a breadboard due to the sub-optimal circuit layout. A spare emonTx PCB was used as an easy way to connect the circuit up to an ATmega328 and RFM12B.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-GixykaE-ywU/T8PzXCzm_OI/AAAAAAAAbos/tf7V3XFQUVM/s1600/DSCF5036.JPG" imageanchor="1" style="margin-left: auto; margin-right: auto; text-align: left;"><img border="0" height="240" src="http://2.bp.blogspot.com/-GixykaE-ywU/T8PzXCzm_OI/AAAAAAAAbos/tf7V3XFQUVM/s320/DSCF5036.JPG" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Adjustable gain op-amp CT sensor circuit - prototype&nbsp;</td></tr></tbody></table><div class="separator" style="clear: both; text-align: center;"></div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-wyzX5ePzs20/T8Pz6eMV-GI/AAAAAAAAbo4/a1kLW5rIbc0/s1600/sample02.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="400" src="http://2.bp.blogspot.com/-wyzX5ePzs20/T8Pz6eMV-GI/AAAAAAAAbo4/a1kLW5rIbc0/s640/sample02.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">ATmega 328 ADC sample using <a href="http://openenergymonitor.org/emon/node/110">VI sampler</a></td></tr></tbody></table><div class="separator" style="clear: both; text-align: left;">The circuit worked first time with no&nbsp;hiccups. The above waveform is the RAW output from an ATmega 328's ADC, where one 100W light bulb and 30W laptop PSU was connected to the AC circuit being monitored. The high gain stage (x69.11) was active. To put this in perspective if the same sample was run on the current emonTx the signal would be so small as to be only just visible on the VI sampler. The spikes at the peak of the waveform is caused by the laptop's switch-mode PSU. The significantly increased amplitude of the signal will improve accuracy when monitoring low power levels. The app-note suggests accuracy of &lt;1% over a wide range, possibly even better with careful PCB design.&nbsp;</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Although this multi-gain op-amp circuit adds significant complexity over the current emonTx current monitoring circuit it can be added for relatively low cost. One quad op-amp and two quad bilateral switches IC's cost about Â£1, this is enough for 4 x CT channels. We're planning to use this circuit design in the forthcoming emonTx SMT. As the name suggests this board will be designed for SMT components and will be assembled by pick-and-place. See <a href="http://openenergymonitor.org/emon/node/642">this forum thread</a> for a discussion regarding ideas for the emonTx SMT. Design is progressing well, more details on this soon.&nbsp;</div>