---
layout: post
title: 'Power emonTx from single AC power supply - Part 2 bench testing '
date: '2013-01-31T15:49:00.002-08:00'
author: Glyn Hudson
categories:
- electronics
- emonTx
modified_time: '2013-02-06T15:20:09.203-08:00'
thumbnail: http://4.bp.blogspot.com/-efRwc-_9iZo/UQsBx0N6oJI/AAAAAAAAdH0/ueIjVqug5Eg/s72-c/2013-01-31+20.50.48.jpg
blogger_id: tag:blogger.com,1999:blog-2472065242652647619.post-1349426625454751359
blogger_orig_url: http://blog.openenergymonitor.org/2013/01/power-emontx-from-single-ac-power.html
---

<br /><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">Back in May last year we did some work (with the help of Robert Wall and others) into the design of an AC-DC circuit to allow the emonTx to run off a single AC power adapter while at the same time taking accurate AC voltage samples to be used for Vrms, real power, frequency and power factor calculations. <a href="http://openenergymonitor.blogspot.co.uk/2012/05/emontx-single-ac-power-supply.html">Read the original blog post detailing how the circuit works</a>. Basicly, it's a half wave rectifier circuit with a carefully chosen value current limiting resistor.&nbsp;</div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">Just to recap, the challenge is powering the emonTx with 3.3V DC while not loading the AC adapter as to not effect the quality of the AC sine wave sample. An as close to perfect AC sample is desirable for best accuracy of real power readings,&nbsp;</div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">We have finally got round to testing the circuit we simulated using LT SPICE. In summary, results are positive, the circuit works as expected!</div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">Here's what I did: the following circuit was built on a bread board, using an emonTx with the voltage regulator. The <a href="http://shop.openenergymonitor.com/ac-ac-adapter-uk-plug/">standard Ideal Power 9V AC-AC adapter</a> from the shop was used for the test.<br /><br /></div><div style="margin-bottom: 0cm;"><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-efRwc-_9iZo/UQsBx0N6oJI/AAAAAAAAdH0/ueIjVqug5Eg/s1600/2013-01-31+20.50.48.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="240" src="http://4.bp.blogspot.com/-efRwc-_9iZo/UQsBx0N6oJI/AAAAAAAAdH0/ueIjVqug5Eg/s320/2013-01-31+20.50.48.jpg" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Scope trace showing input to voltage regulator</td></tr></tbody></table></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-3El_MoBPMCI/T8H-QwqxftI/AAAAAAAAbn4/Zl-kBlwbQRI/s1600/Half+wave+rectifier+power+supply+labeled+diagram.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="188" src="http://1.bp.blogspot.com/-3El_MoBPMCI/T8H-QwqxftI/AAAAAAAAbn4/Zl-kBlwbQRI/s640/Half+wave+rectifier+power+supply+labeled+diagram.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Half-wave rectifier circuit</td></tr></tbody></table><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">A sketch was uploaded to the ATmega328 on the emonTx to cycle through a number of different power levels while using a scope to measure the sawtooth voltage waveform going into the MCP1702 voltage regulator. The following was recorded  </div><div style="margin-bottom: 0cm;"><br /></div><table cellpadding="4" cellspacing="0" style="width: 100%px;"> <colgroup><col width="51*"></col> <col width="51*"></col> <col width="51*"></col> <col width="51*"></col> <col width="51*"></col> </colgroup><tbody><tr valign="TOP">  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: 1px solid #000000; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0.1cm;" width="20%"><b>Power State</b></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: 1px solid #000000; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0.1cm;" width="20%"><b>Current draw</b></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: 1px solid #000000; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0.1cm;" width="20%"><b>Vrms into MCP1702</b></td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: 1px solid #000000; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0.1cm;" width="20%"><b>Delta V into MCP1702</b></td>  <td style="border: 1px solid #000000; padding: 0.1cm;" width="20%"><b>AC Voltage sample ripple     </b></td> </tr><tr valign="TOP">  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">Sleep</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">25uA</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">16.4V</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">0V</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm; padding-top: 0cm;" width="20%"><br /><br /></td> </tr><tr valign="TOP">  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">ATmega328 only</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">7.7mA</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">12.7V</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">2.72V</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm; padding-top: 0cm;" width="20%"><br /><br /></td> </tr><tr valign="TOP">  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">ATmega328 + RFM12B     </td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">8.1mA</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">12.5V</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">2.8V</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm; padding-top: 0cm;" width="20%"><br /><br /></td> </tr><tr valign="TOP">  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">ATmega328 + LED</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">16.9mA</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">10.1V</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">5.5V</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm; padding-top: 0cm;" width="20%"><br /><br /></td> </tr><tr valign="TOP">  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">ATmega328 + LED + RFM12B</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">17.3mA</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">10V</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; padding-top: 0cm;" width="20%">5.53V</td>  <td style="border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; border-top: none; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm; padding-top: 0cm;" width="20%">Approx 80mV (limit of the scope)</td> </tr></tbody></table><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">The voltage limited zener diode was omitted from the test setup but will be present in the main circuit to avoid over volting the MCP1702 when supply is un-loaded.  </div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">The AC voltage sample will be taken when the emonTx is consuming 7.7mA (ATmega328 only running), the test has assured me that the circuit will be able to provide 3.3V DC without hardly any distortion to the AC waveform. There was only a 80mV ripple when drawing 17mA we can expect the ripple to be under half this when the emonTx is drawing 7.7mA.  </div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">It's interesting to note that the RMF12B (when idle, not sleeping) draws 0.4mA and the LED draws 9.2mA. The circuit is speed up to 20mA max so it would be possible to add one DS28B20 that will at maxim consume 2.3mA for short periods.  </div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">AC-DC circuit will be incorporated into the next version of the emonTx. Further testing will be done on this prototype to double check everything.  </div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">Roll on single power supply Real Power accurate energy monitoring. As well as being a neater setup it will also significantly reduce the carbon footprint and amount of electrical waste which will eventually go into landfill if we can enable the emonTx to only need the one plug-in power adapter.&nbsp;</div><div style="margin-bottom: 0cm;"><br /></div>