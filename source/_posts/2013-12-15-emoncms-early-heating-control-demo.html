---
layout: post
title: Emoncms (early) Heating Control Demo
date: '2013-12-15T13:20:00.001-08:00'
author: Glyn Hudson
categories:
- heating
- emonCtrl
- emoncms
- control
- raspberry pi
modified_time: '2013-12-15T16:38:00.998-08:00'
thumbnail: http://4.bp.blogspot.com/-SjVPMnBRjYY/Uq4aU1vsHWI/AAAAAAAArwc/9p8I5DZXh9g/s72-c/20131215_204511_Orwig+Terrace.jpg
blogger_id: tag:blogger.com,1999:blog-2472065242652647619.post-1353238015415659324
blogger_orig_url: http://openenergymonitor.blogspot.com/2013/12/emoncms-early-heating-control-demo.html
---

I've just hooked up a relay to control my central heating boiler and am successfully controlling it via the new emoncms packet generator module...it feels like the future has arrived in my house :-)<br><br>The next step will be to make a nice user facing interface which allows setting heating control time schedules and pulling in temperature data from emonTH and even making it smart by using energy data to try and detect if someone is home or not. Lots of exciting possibilities now the enabling hardware is in place.<br><br><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-SjVPMnBRjYY/Uq4aU1vsHWI/AAAAAAAArwc/9p8I5DZXh9g/s1600/20131215_204511_Orwig+Terrace.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="300" src="http://4.bp.blogspot.com/-SjVPMnBRjYY/Uq4aU1vsHWI/AAAAAAAArwc/9p8I5DZXh9g/s400/20131215_204511_Orwig+Terrace.jpg" width="400"></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Gas Combi Boiler Relay Control Unit top left</td></tr></tbody></table>Please excuse the old boiler, yes I know it should be a no brainer to replace it with a modern efficient condensing unit however things are never simple in rented accommodation. In practice I hardly use the boiler since bottled LPG is very expensive (no mains gas available here), luckily I have a wood stove and a good supply of wood!<br><br>Here's a demo of the heating boiler being turned on remotely:<br><br><iframe allowfullscreen="" frameborder="0" height="360" src="//www.youtube.com/embed/1d797idBJ2M" width="640"></iframe> <br><h3>Hardware:</h3><b>Webserver:&nbsp;</b><br><a href="http://shop.openenergymonitor.com/raspberry-pi/">Raspberry Pi with RFM12Pi expansion module</a> running emoncms (on external HDD file system): <a href="http://openenergymonitor.blogspot.com/2013/12/setup-emoncms-on-raspberrypi-with-hard.html">see blog post</a>. The Raspberry Pi and emoncms are also used to log my home power consumption from my <a href="http://openenergymonitor.org/emon/modules/emonTxV3">emonTx V3</a>, and room temperatures and humidity from my <a href="http://openenergymonitor.org/emon/modules/emonTH">emonTH's.</a> It also mirrors the data to a remote emoncms server for backup.<br><br><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-yE06dnTas_U/Uql-Wl0JuAI/AAAAAAAArqg/aKs3d72Xqh0/s1600/pihdsetup.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="300" src="http://2.bp.blogspot.com/-yE06dnTas_U/Uql-Wl0JuAI/AAAAAAAArqg/aKs3d72Xqh0/s400/pihdsetup.jpg" width="400"></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Raspberry Pi with RFM12Pi module with emoncms running locally on HDD file system</td></tr></tbody></table><br><br><b>Control Node:</b><br><br><b>If switching mains voltage is involved only undertake tasks you are&nbsp;comfortable&nbsp;with,&nbsp;making sure everything is isolated before starting work and don't take any chances.&nbsp;</b><br><b><br></b>Heating systems vary widely, as does the type of control available. Some heating boilers can be controlled via an RF protocol, this could be preferable since tapping into the boiler direct and switching high voltage would not be required.<br><br>My old Worcester Bosch 240 with Honeywell controller requires connecting two terminals together to switch the heating on (see image below). I managed to wire in an additional control wire while keeping the original timer unit in place.<br><br>I used an emonTx V2 with JeeLabs relay module, this is just what I had to hand, any RFM12B node with an appropriate relay module could be used. We're looking into making a prototype PCB with an RFM12B, relay unit, on-board power supply and in-line energy monitoring (why not?!). The important consideration here is to make sure everything is properly enclosed and wired up to a high standard if you're controlling mains voltage. DON'T TAKE CHANCES WITH MAINS VOLTAGE.<br><br>It's important that the relay module used can handle the current being switched in my case this was only about 500mA @ 240V AC&nbsp;but if you're controlling an electric heating direct this is an important consideration.<br><br><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-OZ4jgaJAK4E/Uq31bNdh45I/AAAAAAAArvs/9YoSKa3uQK8/s1600/IMG_20131214_185622.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="300" src="http://1.bp.blogspot.com/-OZ4jgaJAK4E/Uq31bNdh45I/AAAAAAAArvs/9YoSKa3uQK8/s400/IMG_20131214_185622.jpg" width="400"></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Old Honeywell timer controller unit with front face removed - connect terminal 5 to 3 to turn heating on - black wire goes to relay (caution 240V AC)</td></tr></tbody></table><br><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-0Gm-mp2wiyU/Uq3zQUVBu-I/AAAAAAAArvg/VkOa8uQvR7c/s1600/20131214_193529.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="300" src="http://4.bp.blogspot.com/-0Gm-mp2wiyU/Uq3zQUVBu-I/AAAAAAAArvg/VkOa8uQvR7c/s400/20131214_193529.jpg" width="400"></a></td></tr><tr><td class="tr-caption" style="text-align: center;">emonTx V2 with RFM12B and JeeLabs relay module</td></tr></tbody></table><span id="goog_440867743"></span><br><br><h3>Software:</h3><b>Emoncms Raspberry Pi Server</b><br>emoncms running on Raspberry Pi with the new packet generator module,<a href="http://openenergymonitor.blogspot.co.uk/2013/11/adding-control-to-emoncms-rfm12b-packet.html"> see blog post</a>. This is included in the emoncms Raspberry Pi external HDD image (it's still in beta). For the moment as shown in the video the relay is switched on and off from the emoncms backend web page by browsing to the Pi's local IP address and logging into emoncms and selecting the packet gen module under the extras menu.<br><br><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-_Ym-R5e4vro/Uq4ba4lTDQI/AAAAAAAArwk/jc3HuW2oXLw/s1600/Selection_036.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="257" src="http://1.bp.blogspot.com/-_Ym-R5e4vro/Uq4ba4lTDQI/AAAAAAAArwk/jc3HuW2oXLw/s640/Selection_036.png" width="640"></a></td></tr><tr><td class="tr-caption" style="text-align: center;">emoncms RFM12B control packet generator module - beta</td></tr></tbody></table><br>To enable control from outside the house the the http port would have to be opened on my router's firewall and a dynamic dns setup on the external IP address. As mentioned at the beginning of this post the next stage is to design a user facing interface dashboard for emoncms control modules.<br><br><b>Arduino Firmware:&nbsp;</b><br>I've pushed the Arduino sketch running on the emonTx to the e<a href="https://github.com/emoncms/packetgen/tree/master/Arduino_RFM12B_receiver_sketch_examples">moncms packetgen module GitHub as an example</a>.<br><br><b>Fail safe</b><br>I choose a non latching relay so in case of control unit power failure the relay will default to the open / off position.<br><br>I've tried to make the code on the relay control unit as fail safe as possible (independent of Raspberry Pi and network) and as boiler friendly as possible by including a fail safe time after which the relay will default to off (1hr - I'm a frugal user of heating), and a maximum switching rate of 5 min to stop the boiler repeatedly being switched on and off should something go wrong. A hardware watchdog on the ATmega328 was included to try and ensure the microprocessor never locks up.<br><br><br>