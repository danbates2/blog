---
layout: post
title: Outdoor Temperature Data from Weather Underground to Emoncms & MQTT
date: '2016-02-29T11:08:00.000-08:00'
author: Glyn Hudson
categories:
- MQTT
- temperature
- emoncms
- NodeRed
modified_time: '2016-03-15T13:49:04.904-07:00'
thumbnail: https://2.bp.blogspot.com/-mZJm0O0-xZM/VtSO8FO7O-I/AAAAAAABpIA/9wzoEv7Pz54/s72-c/capture%2Bimage.png
blogger_id: tag:blogger.com,1999:blog-2472065242652647619.post-8725295164671763734
blogger_orig_url: http://blog.openenergymonitor.org/2016/02/outdoor-temperature-data-from-weather.html
---

Monitoring the temperature outside your house is super useful to inform your home automation systems and calculate domestic heating (and dressing!) requirements.<br /><br />One way is to monitor external temperature is to install your own external <a href="http://shop.openenergymonitor.com/emonth-433mhz-temperature-humidity-node/">emonTH wireless temperature node</a> or use a commercial web-connected weather station. However a cheaper way is to tap into the Internet of Things and connect to another weather station in your area. &nbsp;<a href="https://www.wunderground.com/weather/api/">Weather Underground</a> have over 18K weather stations online in the USA and a <a href="https://www.wunderground.com/weather/api/">free API</a> for non commercial use.<br /><br />Here's an example of using nodeRED to poll the Weather Underground API and post to Emoncms (using <a href="http://flows.nodered.org/node/node-red-node-emoncms">nodeRED Emoncms flow</a>) and MQTT. &nbsp;See bottom of the post for nodeRED flow export which you can import into your nodeRED by pasting into the import box.<br /><br />NodRED included pre-installed on <a href="https://openenergymonitor.org/emon/node/12212">the latest emonPi image (currently in release-candidate)</a>. The Emoncms flow is pre-installed, you will need to add the <a href="http://flows.nodered.org/node/node-red-node-weather-underground">nodeRED Weather Underground</a> flow by connecting via SSH and running :<br /><br />$ rpi-rw<br />$ cd ~/data/node-red<br />$ sudo npm install node-red-node-weather-underground<br />$ rpi-rw<br />$ exit<br /><br />Once installed you will need to paste in your API key and latitude and longitude (or city) into the Weather Underground node.<br /><br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://2.bp.blogspot.com/-mZJm0O0-xZM/VtSO8FO7O-I/AAAAAAABpIA/9wzoEv7Pz54/s1600/capture%2Bimage.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="290" src="https://2.bp.blogspot.com/-mZJm0O0-xZM/VtSO8FO7O-I/AAAAAAABpIA/9wzoEv7Pz54/s640/capture%2Bimage.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Example NodeRED flow pulling temperature data from Weather Underground to Emoncms and MQTT</td></tr></tbody></table><div class="separator" style="clear: both; text-align: center;"><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://4.bp.blogspot.com/-Q4L4K6rrVkY/VtSSuTC03sI/AAAAAAABpIQ/hXwY9yTgj-A/s1600/capture%2Bimage2.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="224" src="https://4.bp.blogspot.com/-Q4L4K6rrVkY/VtSSuTC03sI/AAAAAAABpIQ/hXwY9yTgj-A/s640/capture%2Bimage2.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Emoncms Internal &amp; External Temperature Multigraph</td></tr></tbody></table><div class="separator" style="clear: both; text-align: left;"><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-WQkcdh5STpY/VtSVU6WGhAI/AAAAAAABpIc/eWEaw8v0jj8/s1600/capture%2Bimage3.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="640" src="https://3.bp.blogspot.com/-WQkcdh5STpY/VtSVU6WGhAI/AAAAAAABpIc/eWEaw8v0jj8/s640/capture%2Bimage3.png" width="304" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">My openHAB dashboard displaying outdoor temperature and emonPi data from MQTT</td></tr></tbody></table><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Example nodeRED flow:&nbsp;</div><div class="separator" style="clear: both; text-align: center;"><span style="font-size: x-small;"><br /></span></div><div style="clear: both; text-align: left;"><span style="font-size: x-small;">[{"id":"14e3d598.a7352a","type":"emoncms-server","z":"4cd40f47.6c38f","server":"http://192.168.0.35/emoncms","name":"emonpi"},{"id":"286b0130.d794fe","type":"mqtt-broker","z":"","broker":"192.168.0.35","port":"1883","clientid":"","usetls":false,"verifyservercert":true,"compatmode":true,"keepalive":"15","cleansession":true,"willTopic":"","willQos":"0","willRetain":null,"willPayload":"","birthTopic":"","birthQos":"0","birthRetain":null,"birthPayload":""},{"id":"8e40f136.25c8c","type":"inject","z":"4cd40f47.6c38f","name":"Poke every 30min","topic":"","payload":"","payloadType":"str","repeat":"1800","crontab":"","once":true,"x":293.33331298828125,"y":616.3333740234375,"wires":[["801e0088.7a2eb"]]},{"id":"1d8fc53b.c7453b","type":"mqtt out","z":"4cd40f47.6c38f","name":"MQTT: weather/temp","topic":"weather/temp","qos":"","retain":"","broker":"286b0130.d794fe","x":840,"y":479,"wires":[]},{"id":"9dfe39d9.afac48","type":"debug","z":"4cd40f47.6c38f","name":"","active":true,"console":"false","complete":"payload","x":772,"y":395,"wires":[]},{"id":"c647a520.c30618","type":"debug","z":"4cd40f47.6c38f","name":"View full output","active":true,"console":"false","complete":"payload","x":581.3333129882812,"y":589.3333740234375,"wires":[]},{"id":"17551590.ce038a","type":"function","z":"4cd40f47.6c38f","name":"Return temp deg C","func":"context.global.outdoor_temp = msg.payload.tempc; &nbsp;\nreturn {payload:context.global.outdoor_temp};","outputs":1,"noerr":0,"x":533.3333129882812,"y":454.3333435058594,"wires":[["1d8fc53b.c7453b","9dfe39d9.afac48","50f404a6.f89bac"]]},{"id":"801e0088.7a2eb","type":"wunderground","z":"4cd40f47.6c38f","name":"","lon":"-4.1716485","lat":"53.1429426","city":"","country":"","x":321,"y":529,"wires":[["17551590.ce038a","c647a520.c30618"]]},{"id":"50f404a6.f89bac","type":"emoncms","z":"4cd40f47.6c38f","name":"Emoncms","emonServer":"14e3d598.a7352a","nodegroup":"weather","x":800,"y":539,"wires":[]}]</span></div>