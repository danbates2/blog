<!doctype html>
  <!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
  <!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
  <!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
  <!--[if gt IE 8]><!--> <html> <!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>OpenEnergyMonitor, emonPi and openHAB  - Blog | OpenEnergyMonitor</title>
    <meta name="author" content="Glyn Hudson">
    <meta name="description" content="OpenEnergyMonitor Blog">
    
    <meta name="viewport" content="width=device-width">
    <link rel="canonical" href="http://blog.openenergymonitor.org/2015/12/openenergymonitor-emonpi-and-openhab/">

    <meta property="fb:app_id" content="">
    <meta property="og:title" content="OpenEnergyMonitor, emonPi and openHAB ">
    <meta property="og:site_name" content="Blog | OpenEnergyMonitor">
    <meta property="og:url" content="http://blog.openenergymonitor.org/2015/12/openenergymonitor-emonpi-and-openhab/">
    <meta property="og:type" content="article">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@openenergymon">
    
    <meta name="twitter:title" content="OpenEnergyMonitor, emonPi and openHAB ">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
    <link href="/atom.xml" rel="alternate" title="Blog | OpenEnergyMonitor" type="application/atom+xml">
    <link rel='shortcut icon' href='/images/favicon.ico' />
    <link rel='icon' type='image/png' href='/images/favicon-192x192.png' sizes='192x192' />
    
    
    
    <link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<link rel="icon" type="image/png" sizes="196x196" href="/images/favicon-192.png">
	<link rel="icon" type="image/png" sizes="160x160" href="/images/favicon-160.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96.png">
	<link rel="icon" type="image/png" sizes="64x64" href="/images/favicon-64.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.png">
	<link rel="apple-touch-icon" href="/images/favicon-57.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/images/favicon-114.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/images/favicon-72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/images/favicon-144.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/images/favicon-60.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/images/favicon-120.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/images/favicon-76.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/images/favicon-152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-180.png">
	<meta name="msapplication-TileColor" content="#FFFFFF">
	<meta name="msapplication-TileImage" content="/images/favicon-144.png">
	<meta name="msapplication-config" content="/images/browserconfig.xml">
	
  </head>

  <body >

    <header>
      <div class="grid-wrapper">
  <div class="grid">

    <div class="grid__item three-tenths lap-two-sixths palm-one-whole ha-title">
  <a href="/" class="site-title">
    <!--<img width='40' src='/images/favicon-192x192.png'> -->
    
    <span style="color:#555;font-weight:bold;font-family:Arial;font-size:20"'>
Open</span><span style="color:#0699fa;font-weight:bold;font-family:Arial;font-size:20"'>EnergyMonitor</span>

  </a>
</div>

<div class="grid__item seven-tenths lap-four-sixths palm-one-whole">
  <nav>
    <input type="checkbox" id="toggle">
<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu"></label>
<ul class="menu pull-right">
  <li><a href="http://openenergymonitor.org">Home</a></li>
  <li><a href="http://shop.openenergymonitor.com">Online-Store</a></li>
  <li><a href="http://guide.openenergymonitor.org">User Guide</a></li>
  <li><a href="http://emoncms.org">Emoncms</a></li>
  <li><a href="http://community.openenergymonitor.org">Forum</a></li>
</ul>
  </nav>
</div>

  </div>
</div>
    </header>

    

    <div class="grid-wrapper">
      <div class="grid grid-center">
        
        <div class="grid__item two-thirds lap-one-whole palm-one-whole">
        

          <article class="post">
  <div class='edit-github'><a href='https://github.com/openenergymonitor/blog/tree/master/source/_posts/2015-12-13-openenergymonitor-emonpi-and-openhab.html'>Edit this post on GitHub</a></div>
  
  <header>
  
  <h1 class="title indent">OpenEnergyMonitor, emonPi and openHAB </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2015-12-13T18:00:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2015-12-13 18:00:00 +00002015-12-13 18:00:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Glyn Hudson</span> <br>
    <span><i class='icon-time'></i> six minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emonpi/'>emonPi</a></li>
      
        <li><a class='category' href='/categories/openhab/'>openHAB</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2015/12/openenergymonitor-emonpi-and-openhab/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="separator" style="clear: both; text-align: left;"><br /></div><div class="" style="clear: both; text-align: left;">Using the emonPi in it's current default configuration works great to post data to Emoncms for logging and visualisation. However there may be times when you want some more flexibility and or ability to interface with other hardware or services&nbsp;</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">In my last few blog posts I have been taking a look at making the <a href="http://shop.openenergymonitor.com/emonpi-1/">emonPi</a> the heart of a smart energy optimised home and how live energy monitoring data from the emonPi can easily be used to inform other services: &nbsp;&nbsp;</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="" style="clear: both; text-align: left;">1.
<a name="read-more"></a>

&nbsp;<a href="http://openenergymonitor.blogspot.co.uk/2015/10/emonpi-nodered-and-mqtt.html">Integrating&nbsp;Node-RED and MQTT&nbsp;on the emonPi</a></div><div class="separator" style="clear: both; text-align: left;">2. <a href="http://openenergymonitor.blogspot.co.uk/2015/11/node-red-emoncms-node.html">Node-RED and Emoncms</a></div><div class="" style="clear: both; text-align: left;">3. <a href="http://openenergymonitor.blogspot.co.uk/2015/11/remote-control-of-lightwave-rf-plugs.html">Controlling LightWaveRF devices on the emonPi</a>&nbsp;(OOK RF Tx)&nbsp;</div><div class="" style="clear: both; text-align: left;"><br /></div><div class="" style="clear: both; text-align: left;">Following on from my last post on controlling LightWaveRF devices from the emonPi using MQTT we now need a front end interface to handle the control. I have recently been taking a look at how openHAB can be configured to provide a front end interface to OpenEnergyMonitor hardware and control.&nbsp;</div><div class="" style="clear: both; text-align: left;"><br /><a href="http://2.bp.blogspot.com/-Mn4SF-hLCuQ/Vm2cvhlvFCI/AAAAAAABkr4/cq8GoyQEYkc/s1600/openhab.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="179" src="http://2.bp.blogspot.com/-Mn4SF-hLCuQ/Vm2cvhlvFCI/AAAAAAABkr4/cq8GoyQEYkc/s320/openhab.jpg" width="320" /></a><br /><br /></div><div class="" style="clear: both; text-align: left;">We are working on releasing an updated pre-built SD card stack for the emonPi which will include Emoncms V9, MQTT, Node-RED and openHAB all pre-configured. I hope to post a beta image download to the forums in the next few days.&nbsp;</div><div class="" style="clear: both; text-align: left;"><br /></div><div class="" style="clear: both; text-align: left;"><a href="http://www.openhab.org/">Open Home Automation Bus (openHAB)</a> is "a vendor and technology agnostic open source automation software for your home". OpenHAB can run on an emonPi (Raspberry Pi) and is very flexible and can be configured for just about any home automation task. This high level of configurability can also make it seem quite hard to understand to start with. I've have put together a <a href="https://github.com/openenergymonitor/oem_openHab">skeleton config to setup openHAB with to OpenEnergyMonitor</a> pulling data from the MQTT server running on an emonPi.&nbsp;</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="" style="clear: both; text-align: left;">Once setup you simply browse to&nbsp;<a href="http://emonpi:8080/openhab.app?sitemap=oem">http://emonpi:8080/openhab.app?sitemap=oem</a>&nbsp;to view the openHAB user interface. openHAB also has a nice Android or IOS app which can be pointed at the same URL. &nbsp; <br /><br /></div><table align="left" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: left;"><tbody><tr><td style="text-align: left;"><a href="http://1.bp.blogspot.com/-lAn2SNSzyLQ/VmVkYfsFDxI/AAAAAAABkic/Wqhp7g4R4uA/s1600/OpenEnergyMonitor_openHAB.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://1.bp.blogspot.com/-lAn2SNSzyLQ/VmVkYfsFDxI/AAAAAAABkic/Wqhp7g4R4uA/s400/OpenEnergyMonitor_openHAB.png" width="385" /></a></td></tr><tr><td class="tr-caption" style="text-align: left;">openHAB OpenEnergyMonitor skeleton setup</td></tr></tbody></table><div class="separator" style="clear: both; text-align: left;"><br /></div><table align="left" cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: left; margin-right: 1em; text-align: left;"><tbody><tr><td style="text-align: left;"><a href="http://2.bp.blogspot.com/--fxB-426-Hs/VmXNqpc1KJI/AAAAAAABkk4/lzBoHKFz5g8/s1600/Screenshot_2015-12-07-10-23-42.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://2.bp.blogspot.com/--fxB-426-Hs/VmXNqpc1KJI/AAAAAAABkk4/lzBoHKFz5g8/s400/Screenshot_2015-12-07-10-23-42.png" width="225" /></a></td></tr><tr><td class="tr-caption" style="text-align: left;">openHAB Android app</td></tr></tbody></table><table align="left" cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: right; margin-left: 1em; text-align: right;"><tbody><tr><td style="text-align: left;"><a href="http://4.bp.blogspot.com/-Y_6-BnAJWcE/VmXNqpDvxjI/AAAAAAABkkw/4kpSmg9rdtU/s1600/Screenshot_2015-12-07-10-23-52.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://4.bp.blogspot.com/-Y_6-BnAJWcE/VmXNqpDvxjI/AAAAAAABkkw/4kpSmg9rdtU/s400/Screenshot_2015-12-07-10-23-52.png" width="225" /></a></td></tr><tr><td class="tr-caption" style="text-align: left;">openHAB LightWaveRF control using openHAB Android app</td></tr></tbody></table><br /><br /><br /><br /><div class="separator" style="clear: both; text-align: left;"></div><br /><h3>Installing OpenHAB</h3><div><span id="goog_2128785651"></span>I have put together a <a href="https://github.com/openenergymonitor/oem_openHab">guide from installing OpenHAB on an emonPi</a> with the config shown above to work with OpenEnergyMonitor on the oem_openHAB GitHub<span id="goog_2128785652"></span>.&nbsp;</div><div><br /></div><h3>OpenHAB Configuration&nbsp;</h3>OpenHAB configuration is based around two files 'items and 'sitemap'. In my openHAB emonPi install instructions I recommend cloning the&nbsp;oem_openHAB to the home directory then soft linking the Items and Sitemap files to the relevant config locations in /etc/openhab/configurations/. This makes the files easier to edit.<br /><br />It's possible to have multiple user interfaces defined by multiple sitemaps e.g oem.sitemap, kids.sitemap or admin.sitemap etc.<br /><br /><b>Items</b><br /><b><br /></b>The items file defines all the 'things' you might want to view or control in openHAB. Items can be bound to 'bindings' which are optional packages that used to extend functionality of openHAB. This example makes use of the MQTT and HTTP bindings. The items file is usually located in&nbsp;/etc/openhab/configurations/items.<br /><br />For example the line in the items file to pull power 1 from emonhub MQTT is as follows:<br /><br /><span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;">Number  emonpi_ct1       "Power 1 [%d W]"    { mqtt="&lt;[mosquitto:emonhub/rx/5/values:state:REGEX((.*),.*,.*,.*,.*,.*,.*,.*,.*,.*,.*)]" }</span><br /><br /><br />Notice the REGEX is used to tell openHAB that we want the first value in the 11 part CSV emonhub posts to MQTT to emonhub/rx/5/values.<br /><br />and the items line to control LightWaveRF plug 1 (publish "1 1" to /lwrf mqtt topic) is as follows:<br /><br /><span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;">Switch lwrf1   "LWRF Socket 1"  {mqtt="&gt;[mosquitto:lwrf:command:ON:1 1],&gt;[mosquitto:lwrf:command:OFF:1 0]"}</span><br /><span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;"><br /></span><a href="https://github.com/openenergymonitor/oem_openHab/blob/master/oem.items">See the full items file used for this example on the open_openhab GitHub repo</a><br /><br /><b>Sitemap</b><br /><b><br /></b>The second openHAB config file of interest is 'sitemap'.&nbsp;Sitemaps are used to create elements of a user interface for making openHAB items accessible to the frontend interface.<br /><br />For example the sitemap config line to produce the emonPi Power1 in the interface is as follows:<br /><br /><span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;">Text item=emonpi_ct1 icon="firstfloor"</span><br /><span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;"><br /></span>And to produce the LightWaveRF control swithches:<br /><br /><span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;">Switch item=lwrf1 label="LWRF Plug 1"</span><br /><span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;"><br /></span><span style="background-color: white; color: #333333; font-family: &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , &quot;courier&quot; , monospace; font-size: 12px; line-height: 16.8px; white-space: pre;"><br /></span><a href="https://github.com/openenergymonitor/oem_openHab/blob/master/oem.sitemap">See the full sitemap file used for this example on the open_openhab GitHub repo</a><br /><br />I have intentionally kept this 'skeleton' example as simple as possible. To view the full capabilities of openHAB including using groups checkout the <a href="http://demo.openhab.org:8080/openhab.app?sitemap=demo">openHAB demo</a>&nbsp;and corresponding demo <a href="https://github.com/openhab/openhab/blob/master/distribution/openhabhome/configurations/items/demo.items">items</a> and <a href="https://github.com/openhab/openhab/blob/master/distribution/openhabhome/configurations/sitemaps/demo.sitemap">sitemap</a> files.<br /><br /><h3>Demo</h3><br />Here's a quick demo I made using openHAB to control LightWave RF plugs:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="http://3.bp.blogspot.com/-SzaE2KRbyrY/Vm2tX_kJbzI/AAAAAAABksQ/j_A9OuXi6KA/s1600/Screenshot%2B2015-12-13%2Bat%2B17.35.56.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="411" src="http://3.bp.blogspot.com/-SzaE2KRbyrY/Vm2tX_kJbzI/AAAAAAABksQ/j_A9OuXi6KA/s640/Screenshot%2B2015-12-13%2Bat%2B17.35.56.png" width="640" /></a></div><br /><div class="separator" style="clear: both; text-align: left;"><iframe allowfullscreen="" class="YOUTUBE-iframe-video" data-thumbnail-src="https://i.ytimg.com/vi/6uF0qU30q-g/0.jpg" frameborder="0" height="266" src="https://www.youtube.com/embed/6uF0qU30q-g?feature=player_embedded" width="320"></iframe></div>
      <b>To engage in discussion regarding this post, please post on our <a href="http://community.openenergymonitor.org">Community Forum</a></b>.
    <br>
</article>



        </div>

        
        <aside id="sidebar" class="grid__item one-third lap-one-whole palm-one-whole">
          <div class="grid">

 
 <section id="recent-posts" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">Recent Posts</h1>
  <ul class="divided">
    
      
        <li class="post">
          <a href="/2016/05/website-changes/">New Forum, Blog and User Guide Website</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/05/Part3-Aggregated-supply-and-demand/">Part 3: Aggregated supply and demand across multiple households</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/04/Part2-Exploring-carbon-intensity/">Part2 Exploring Carbon Intensity</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/04/Understand-CO2-intensity-grid-electricity/">Part 1: Attempting to measure and understand the CO2 intensity of grid electricity</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/04/Git-Sub-Modules/">GitHub Submodules</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/04/Home-Assistant/">Home Assistant and emonPi</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/03/raspberry-pi-3/">Raspberry Pi 3 </a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/02/outdoor-temperature-data-from-weather/">Outdoor Temperature Data from Weather Underground to Emoncms & MQTT</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/02/heat-pump-testing-initial-results/">Heat pump Testing: Initial results</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/01/french-low-carbon-energy-film-featuring/">Low carbon energy film featuring OpenEnergyMonitor</a>
        </li>
      
    
  </ul>
</section>
  
  
</div>
        </aside>
        
      </div>
    </div>

    <footer>
      <div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item">
      <div class="copyright">
  <a rel="me" href='https://twitter.com/openenergymon'><i class="icon-twitter"></i></a>
  <a rel="me" href='https://github.com/openenergymonitor'><i class="icon-github"></i></a>
  <a rel="me" href='http://blog.openenergymonitor.org/atom.xml'><i class="icon-rss"></i></a>

  <div class="credit">
    Website powered by <a href='http://jekyllrb.com/'>Jekyll</a> and the <a href='https://github.com/coogie/oscailte'>Oscalite theme</a>.<br />
    Hosted by <a href='https://pages.github.com/'>GitHub</a> and served by <a href='https://cloudflare.com'>CloudFlare</a>.
  </div>
</div>
    </div>
  </div>
</div>
    </footer>

    <!--[if lt IE 7]>
      <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->

    <script>
  var _gaq=[['_setAccount','UA-10321170-4'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
<script>
  var disqus_shortname = 'openenergymonitor';
  
    
    var disqus_script = 'count.js';
  
  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>


<script>
  $(document).ready(function(){
    if (!window.jXHR){
      var jxhr = document.createElement('script');
      jxhr.type = 'text/javascript';
      jxhr.src = '/javascripts/libs/jXHR.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jxhr, s);
    }

    github.showRepos({
      user: 'openenergymonitor',
      count: 5,
      skip_forks: true,
      target: '#gh_repos'
    });
  });
</script>
<script src="/javascripts/github.js"></script>

  </body>
</html>