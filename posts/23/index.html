<!doctype html>
  <!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
  <!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
  <!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
  <!--[if gt IE 8]><!--> <html> <!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Blog | OpenEnergyMonitor</title>
    <meta name="author" content="Glyn Hudson">
    <meta name="description" content="OpenEnergyMonitor Blog">
    
    <meta name="viewport" content="width=device-width">
    <link rel="canonical" href="https://blog.openenergymonitor.org/posts/23/">

    <meta property="fb:app_id" content="">
    <meta property="og:title" content="Blog | OpenEnergyMonitor">
    <meta property="og:site_name" content="Blog | OpenEnergyMonitor">
    <meta property="og:url" content="https://blog.openenergymonitor.org/posts/23/">
    <meta property="og:type" content="website">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@openenergymon">
    
    <meta name="twitter:title" content="Blog | OpenEnergyMonitor">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
    <link href="/atom.xml" rel="alternate" title="Blog | OpenEnergyMonitor" type="application/atom+xml">
    <link rel='shortcut icon' href='/images/favicon.ico' />
    <link rel='icon' type='image/png' href='/images/favicon-192x192.png' sizes='192x192' />



    <link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<link rel="icon" type="image/png" sizes="196x196" href="/images/favicon-192.png">
	<link rel="icon" type="image/png" sizes="160x160" href="/images/favicon-160.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96.png">
	<link rel="icon" type="image/png" sizes="64x64" href="/images/favicon-64.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.png">
	<link rel="apple-touch-icon" href="/images/favicon-57.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/images/favicon-114.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/images/favicon-72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/images/favicon-144.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/images/favicon-60.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/images/favicon-120.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/images/favicon-76.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/images/favicon-152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-180.png">
	<meta name="msapplication-TileColor" content="#FFFFFF">
	<meta name="msapplication-TileImage" content="/images/favicon-144.png">
	<meta name="msapplication-config" content="/images/browserconfig.xml">
  <link href="https://fonts.googleapis.com/css?family=Ubuntu:light,bold&amp;subset=Latin" rel="stylesheet"> <!-- Ubuntu font -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  </head>

<style>

html, body {
  margin: 0; height: 100vh;
}

html {
  min-height: 100vh;
}

html, body {
  word-wrap: break-word;
  font-family: "ubuntu", sans-serif;
}

a:visited, .a:hover, a:focus, a {
  color: #44b3e2;
}

.meta.clearfix {
  overflow-x: hidden;
}

.communityWrapper {
  box-sizing: border-box;
  margin: 0 auto;
  width: 100%;
  height: 42px;
}

@media (min-width: 1080px) {
  .communityWrapper {
  width: 1080px;
  }
}

@media screen and (max-width: 400px) {
  .oemWrap {
  display: none;
  }
}

.fa-navicon {
  display: none;
  cursor: pointer;
  font-size: 30px;
  line-height: 42px;
  position: absolute;
  left: 0;
  color: #ffffff;
  padding-left: 12px;
  z-index: 9997;
}

@media screen and (max-width: 1079px) {
  .fa-navicon {
  display: inline-block;
  }
}

.titleHolder {
  position: relative;
  top: 0;
  width: 100%;
  height: 42px;
  background-color: #44b3e2;
  overflow: hidden;
  -webkit-box-shadow: 0 -2px 4px 2px #000;
  -moz-box-shadow: 0 -2px 4px 2px #000;
  box-shadow: 0 -2px 4px 2px #000;	
}

.thisTitle {
  position: relative;
  display: inline-block;
  color: #ffffff;
  left: 0;
  line-height: 42px;
  padding-right: 12px;
  padding-left: 0;
  font-size: 20px;
  text-align: right;
}

.thisTitle a {
  color: #ffffff;
}

@media screen and (min-width: 1080px) {
  .thisTitle {
  font-size: 16px;
  text-align: left;
  padding-right: 0;
  padding-left: 7px;
  }
}

@media screen and (max-width: 1079px) {
  .thisTitle {
  width: 100%;
}
.thisTitle a {
  padding-right: 12px;
  }
}

.navigation {
  position: absolute;
  display: inline-block;
  top: 0;
  right: 0;
  margin-right: 6px;
  height: 42px;
  min-width: 750px;
  overflow: visible;
  padding-right: 7px;
  z-index: 20;
  box-sizing: content-box;
}

@media screen and (min-width: 1080px) {
  .navigation {
  position: relative;
  float: right;
  display: inline-block;
  margin: 0;
  }
}

.navigation ul {
  list-style-type: none;
  float: right;
  top: 0;
  margin: 0;
  padding: 0;
  height: 100%;
  display: block;
}

.navigation ul li {
  float: left;
  background-color: #44b3e2;
}

.navigation ul li a {
  display: block;
  line-height: 42px;
  font-family:"ubuntu";
  font-size: 16px;
  text-align: center;
  padding-left: 10px;
  padding-right: 10px;
  color: #ffffff;
}

.menuFreeze {
  height: 100%;
  overflow: hidden;
}

@media screen and (max-width: 1079px) {
  .navigation {
      position: fixed;
      display: none;
      top: 0;
      left: 0;
      height: 100vh;
      margin: 0;
      width: 0;
      font-size: 20px;
      background-color: #44b3e2;
      color: #ffffff;
      z-index: 9999;
      box-sizing: border-box;
      overflow: auto;
      min-width: 0;
      padding-right: 0;
  }
  
  .navigation ul {
      list-style-type: none;
      margin: 0;
      padding-top: 0;
  }
  
  .navigation ul li a {
      box-sizing: border-box;
      font-family: "ubuntu";
      font-size: 20px;
      display: block;
      color: #ffffff;
      padding: 0 20px 0 40px;
      min-width: 220px;
      text-align: left;
      height: 12.5vh;
      line-height: 12.5vh;
  }
  
  .navigation ul li .fa {
      min-width: 25px;
  }
}


@media screen and (min-width: 1080px) {
  .navigation ul li:nth-child(1) {
    width: 82px;
  }
  .navigation ul li:nth-child(2) {
    width: 81px;
  }
  .navigation ul li:nth-child(3) {
    width: 85px;
  }
  .navigation ul li:nth-child(4) {
    width: 113px;
  }
  .navigation ul li:nth-child(5) {
    width: 123px;
  }
  .navigation ul li:nth-child(6) {
    width: 73px;
  }
  .navigation ul li:nth-child(7) {
    width: 75px;
  }
  .navigation ul li:nth-child(8) {
    width: 87px;
  }
}

.blackOut {
  position: fixed;
  display: none;
  top: 0;
  right: 0;
  height: 100vh;
  width: 100%;
  background-color: rgba(0,0,0,0.5);
  overflow: hidden;
  cursor: pointer;
  z-index:9998;
}

.actoemLink {
  background-color: #368fb4 !important;
}

.actoemLink a {
  color: #ffffff !important;
}

.searchBox {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  background-color: rgba(0,0,0,0.8);
  color: #fff;
  display: none;
  cursor: pointer;
  z-index: 9999999999999;
}

.searchBox form {
  margin: auto;
}

.searchBox input[type=submit] {
  cursor: pointer;
  padding: 10px;
  font-size: 20px;
  font-weight: bold;
  background-color: #44b3e2;
  color: #fff;
  border: none;
  -webkit-transition: background-color 500ms linear;
  -ms-transition: background-color 500ms linear;
  transition: background-color 500ms linear;
}

.searchBox input[type=submit]:hover {
  background-color: #77c8ea;
}

.searchBox input[type=text] {
  padding: 10px;
  font-size: 20px;
  border: none;
}

.searchText {
  width: 0;
}

.searchIcon {
  cursor: pointer;
}

</style>

<body >




<div class="titleHolder">
  <div class="communityWrapper">
    <i class="fa fa-navicon"></i>
    <div class="thisTitle">
      <a href="/">
        <strong>Blog</strong>
        <span class="oemWrap">
        | Open<strong>EnergyMonitor</strong>
        </span>
      </a>
    </div>
    <div id="siteLinks" class="navigation">
      <ul>
        <li title="the homepage of OpenEnergyMonitor">
          <a href="https://openenergymonitor.org">
            <i class="fa fa-home" aria-hidden="true"></i><span class="navname">&nbsp;Home</span>
          </a>
        </li>
        <li title="a user guide for the OpenEnergyMonitor system">
          <a href="https://guide.openenergymonitor.org">
            <i class="fa fa-book" aria-hidden="true"></i><span class="navname">&nbsp;Guide</span>
          </a>
        </li>
        <li title="general information about energy monitoring, diversion and sustainability">
          <a href="https://learn.openenergymonitor.org">
            <i class="fa fa-mortar-board" aria-hidden="true"></i><span class="navname">&nbsp;Learn</span>
          </a>
        </li>
        <li title="a definitive list of resources for OpenEnergyMonitor hardware">
          <a href="https://guide.openenergymonitor.org/technical/resources/">
            <i class="fa fa-list-alt" aria-hidden="true"></i><span class="navname">&nbsp;Resources</span>
          </a>
        </li>
        <li title="the openenergymonitor forum">
          <a href="https://community.openenergymonitor.org">
            <i class="fa fa-comments" aria-hidden="true"></i><span class="navname">&nbsp;Community</span>
          </a>
        </li>
        <li title="you are here: keep up with new developments at OpenEnergyMonitor" class="actoemLink">
          <a href="https://blog.openenergymonitor.org">
            <i class="fa fa-bullhorn" aria-hidden="true"></i><span class="navname">&nbsp;Blog</span>
          </a>
        </li>
        <li title="the official OpenEnergyMonitor online store">
          <a href="https://shop.openenergymonitor.com">
            <i class="fa fa-shopping-cart" aria-hidden="true"></i><span class="navname">&nbsp;Shop</span>
          </a>
        </li>
				<li title="search for something on OpenEnergyMonitor">
					<a class="searchIcon">
					    <i aria-hidden="true" class="fa fa-search"></i><span class="navname">&nbsp;Search</span>
				  </a>
				</li>
      </ul>
    </div>
  </div>
</div>
<div class="searchBox">
  <form target="_blank" id="searchform" action="https://www.google.com/cse">
    <div>
      <input type="hidden" name="cx" value="006198118389747886812:_nmxikw563w" />
      <input type="hidden" name="ie" value="UTF-8" />
      <input type="text" class="searchText" value="" name="q" id="q" autocomplete="off" />
      <input type="submit" id="searchsubmit" name="sa" value="Search" />
    </div>
  </form>
</div>
<div class="blackOut"></div>
<div style="position:relative;width:100%;top:0;height:20px"></div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script defer src="/javascripts/octopress.js"></script>

<script>
  var _gaq=[['_setAccount','UA-10321170-4'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
<script>
  var disqus_shortname = 'openenergymonitor';
  
    
    var disqus_script = 'count.js';
  
  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js">
  $(document).ready(function(){
    if (!window.jXHR){
      var jxhr = document.createElement('script');
      jxhr.type = 'text/javascript';
      jxhr.src = '/javascripts/libs/jXHR.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jxhr, s);
    }

    github.showRepos({
      user: 'openenergymonitor',
      count: 5,
      skip_forks: true,
      target: '#gh_repos'
    });
  });
</script>
<script src="/javascripts/github.js"></script>

<script>

var closeStatus = false;

function openButton() {
  $("html, body").addClass("menuFreeze");
  $(".blackOut").show();
  $(".navigation").show();
  $(".navigation").animate({ width:'220' },"0.5s");
}

$(".fa-navicon").click(function() {
  openButton();
  closeStatus = true;
});

function closeButton() {
  $("html, body").removeClass("menuFreeze");
  $(".blackOut").hide();
  $(".navigation").animate({ width:'0' },"0.5s");
}

$(".blackOut").click(function() {
  closeButton();
  closeStatus = false;
});

$(document).ready(function(){
  $("table").wrap("<div style='max-width:100%;overflow-x:auto'></div>");
});

$(window).resize(function(){
  if ($(window).width() > 1079 && closeStatus == true) {
    if (!$("html").hasClass("mobile-device")) {
      closeButton();
      closeStatus = false;
    }
  }
});

$(".searchIcon").click(function() {
   $(".searchBox").css("display","flex");
   $(".searchText").animate({width: "200px"});
   $(".searchText").focus();
   $("html, body").addClass("menuFreeze");
});
$(".searchBox").click(function() {
   $(".searchBox").css("display","none");
   $(".searchText").blur();
   $(".searchText").css("width","0");
   closeButton();
});
$(".searchBox form").click( function(event) {
   event.stopPropagation();
});

</script>

<div class="grid-wrapper">
  <div class="grid grid-center">
    
    <div class="grid__item two-thirds lap-one-whole palm-one-whole">
    

        
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/09/cleanweb-uk-ignite-evening-london-13th/">Cleanweb UK - Ignite Evening - London 13th Sep</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-09-04T09:58:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-09-04 09:58:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Glyn Hudson</span> <br>
    <span><i class='icon-time'></i> Less than one minute reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/presentation/'>presentation</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/09/cleanweb-uk-ignite-evening-london-13th/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div class="separator" style="clear: both; text-align: center;"><a href="http://www.cleanweb.org.uk/images/ignite_cleanweb.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://www.cleanweb.org.uk/images/ignite_cleanweb.png" width="320" /></a></div><div class="separator" style="clear: both; text-align: center;"></div><h1 style="background-color: white; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 30px; line-height: 40px; margin: 0px 0px 15px; text-rendering: optimizelegibility;">Thursday, September 13, 2012</h1><h3 style="background-color: white; color: #333333; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 18px; line-height: 30px; margin: 0px; text-rendering: optimizelegibility;">7:00pm, at&nbsp;<a href="http://forwardtechnology.co.uk/venue" style="color: #cc0000; text-decoration: none;">Forward Technology</a>&nbsp;in London</h3><div><br /></div><br /><div class="separator" style="clear: both; text-align: center;">Trystan and I are looking forward to attending and speaking at the first <a href="http://www.cleanweb.org.uk/">Cleanweb UK</a>&nbsp;<a href="http://igniteshow.com/">Ignite</a> evening in London. It looks like it will be a great event, there will be 12 short (5min) fast paced talks to do with sustainability and the&nbsp;internet.&nbsp;</div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;">Please come along and joins us, registration and full event details here:&nbsp;<a href="http://www.cleanweb.org.uk/ignite.html">http://www.cleanweb.org.uk/ignite.html</a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://www.cleanweb.org.uk/images/tree.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://www.cleanweb.org.uk/images/tree.png" width="184" /></a></div>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/08/reading-watt-hour-data-from-elster/">Reading Watt-hour data from an Elster A100C electricity meter using IrDA by Dave Berkeley part 2</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-08-27T11:02:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-08-27 11:02:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> 1 minute reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emontx/'>emonTx</a></li>
      
        <li><a class='category' href='/categories/pluse/'>pluse</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/08/reading-watt-hour-data-from-elster/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div><div style="text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-O6Rbpza8DRI/UDtMZHQNG7I/AAAAAAAACeo/i6Xx0PCuLdo/s1600/IMAG0876.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-O6Rbpza8DRI/UDtMZHQNG7I/AAAAAAAACeo/i6Xx0PCuLdo/s1600/IMAG0876.jpg" /></a></div><br /><br />As mentioned <a href="http://openenergymonitor.blogspot.co.uk/2012/07/reading-watt-hour-data-from-elster.html">before</a> if you have an Elster meter this is a fantastic way to read the exact accumulated watt hours that you have generated or used and can compliment and cross check a CT based measurement.<br /><br />Dave Berkeley has now packaged the code into a nice library which makes it really easy to use. We have uploaded the library to a repository on github here:&nbsp;<a href="https://github.com/openenergymonitor/ElsterMeterReader">https://github.com/openenergymonitor/ElsterMeterReader</a><br /><br /><b>How to build it</b><br /><b><br /></b>1) To build the <a href="http://shop.openenergymonitor.com/tsl261r-ir-sensor-kit/">TSL261R</a> based sensor for use with the emontx, follow the jack plug connection diagram on the emontx reference page here:&nbsp;<a href="http://openenergymonitor.org/emon/emontx/reference%20">http://openenergymonitor.org/emon/emontx/reference</a><br /><br />We've put together a small kit <a href="http://shop.openenergymonitor.com/tsl261r-ir-sensor-kit/">available in the shop</a> of all the components needed to connect it to an emontx including the TSL261R a male 3.5mm jack, 1m of cable and heat-shrink.<br /><br />2) Plug the sensor into the pulse input on the emontx (digital pin 3,&nbsp;interrupt&nbsp;pin 1)<br /><br />3) Download the ElsterMeterReader library and place in the arduino libraries folder.<br /><br />4) Open the Arduino IDE and run the following example:<br /><br /><pre>#include&nbsp;<span style="color: #006699;">"elster.h"</span><br /><br /><span style="color: #cc6600;">void</span> meter_reading(<span style="color: #cc6600;">unsigned</span> <span style="color: #cc6600;">long</span> r)<br />{<br />&nbsp;&nbsp;<span style="color: #cc6600;"><b>Serial</b></span>.<span style="color: #cc6600;">print</span>(r);<br />&nbsp;&nbsp;<span style="color: #cc6600;"><b>Serial</b></span>.<span style="color: #cc6600;">print</span>(<span style="color: #006699;">"\r\n"</span>);<br />}<br /><br />ElsterA100C&nbsp;meter(meter_reading);<br /><br /><span style="color: #cc6600;">void</span> <span style="color: #cc6600;"><b>setup</b></span>()<br />{<br />&nbsp;&nbsp;<span style="color: #cc6600;"><b>Serial</b></span>.<span style="color: #cc6600;">begin</span>(9600);<br />&nbsp;&nbsp;<span style="color: #cc6600;"><b>Serial</b></span>.<span style="color: #cc6600;">println</span>(<span style="color: #006699;">"IRDA Meter reader"</span>);<br />&nbsp;&nbsp;meter.init(1);<br />}<br /><span style="color: #cc6600;">void</span> <span style="color: #cc6600;"><b>loop</b></span>()<br />{<br />&nbsp;&nbsp;<span style="color: #7e7e7e;">// Decode the meter stream</span><br />&nbsp;&nbsp;<span style="color: #cc6600;">const</span> <span style="color: #cc6600;">int</span> byte_data = meter.decode_bit_stream();<br />&nbsp;&nbsp;<span style="color: #cc6600;">if</span> (byte_data != -1) {<br />&nbsp;&nbsp;&nbsp;&nbsp;meter.on_data(byte_data);<br />&nbsp;&nbsp;}<br />}</pre><br />5) If you now go to the serial window and place the sensor over the IrDA port (bottom-left of the meter) you should see the Watt-hours elapsed printed out to the serial window:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-fyAeGjqtaYw/UDtTSJ4AtNI/AAAAAAAACe4/nJS88EiX8lc/s1600/outputirda.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-fyAeGjqtaYw/UDtTSJ4AtNI/AAAAAAAACe4/nJS88EiX8lc/s1600/outputirda.png" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">Thanks a lot to Dave Berkeley for this, for more information see his project page:&nbsp;<a href="http://www.rotwang.co.uk/projects/meter.html">http://www.rotwang.co.uk/projects/meter.html</a></div></div>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/08/open-kontrol-gateway-emonbase/">Open Kontrol Gateway - emonBase</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-08-09T11:19:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-08-09 11:19:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Glyn Hudson</span> <br>
    <span><i class='icon-time'></i> three minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/okg/'>OKG</a></li>
      
        <li><a class='category' href='/categories/emonbase/'>emonBase</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/08/open-kontrol-gateway-emonbase/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div>For a while now we have been using the NanodeRF as our emonBase web-connected base station. The NanodeRF is great and has met our needs well. However using the ENC28J60&nbsp;Ethernet&nbsp;chip does have some limitations.<br /><br />We have through about having an emonBase option which supports the Wiznet Ethernet chip. This is the chip that is used in the official Arduino&nbsp;Ethernet. On the Wiznet chip the TCP/IP stack is implemented on the chip as opposed to on the ATmega328 as in the case of the ENC28J60, this means ATmega328 has a greatly reduced load, more application memory is freed up and the code is much simpler and brought in line with the Arduino&nbsp;Ethernet&nbsp;code examples.<br /><br />In testing we have found the Wiznet chip to be more stable at holding a connection over a long period.<br /><br />However the Wiznet chip is more expensive than the ENC28J60, what we need is a&nbsp;flexible&nbsp;emonBase unit which is&nbsp;interchangeable&nbsp;between the two&nbsp;Ethernet&nbsp;chips, enter the Open Kontrol Gateway (OKG)!<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-2MhNilPj6U0/UCDuPVoX9uI/AAAAAAAAcgs/vlU9bgoHSxU/s1600/2012-08-07+10.43.56.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://2.bp.blogspot.com/-2MhNilPj6U0/UCDuPVoX9uI/AAAAAAAAcgs/vlU9bgoHSxU/s320/2012-08-07+10.43.56.jpg" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-HzMe7OKjbn4/UCDugFjA1OI/AAAAAAAAcg0/lt8ncHdduVk/s1600/2012-08-07+10.45.07.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://1.bp.blogspot.com/-HzMe7OKjbn4/UCDugFjA1OI/AAAAAAAAcg0/lt8ncHdduVk/s320/2012-08-07+10.45.07.jpg" width="320" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-Opp6FDrMMM0/UCDu05W7n6I/AAAAAAAAchA/YixQcS1nOPg/s1600/gateway+pcb+v1.0.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="266" src="http://2.bp.blogspot.com/-Opp6FDrMMM0/UCDu05W7n6I/AAAAAAAAchA/YixQcS1nOPg/s400/gateway+pcb+v1.0.jpg" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div>The OKG is a very&nbsp;flexible web-connected base station based on the ATmega328 which is totally Arduino IDE&nbsp;compatible (Arduino UNO bootloader). The OKG has been designed and manufactured by our friend Miles who runs&nbsp;<a href="http://www.ciseco.co.uk/content/">Ciseco Plc</a>.<br /><br />The OKG PCB supports multiple wireless options such as RFM12B, XBEE, XRF, RN-XV Wifi. There is also PCB footprints for expansions like a RTC, SD card and SRAM. Finally what&nbsp;attracted&nbsp;us to the OKG was the ability to easily choose between the ENC28J60 or Wiznet&nbsp;Ethernet chips:<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-_6SxkiCo-Pw/UCDwJDEsHwI/AAAAAAAAchI/FD7XGW9cVXw/s1600/OKG_ENC28J60.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="299" src="http://2.bp.blogspot.com/-_6SxkiCo-Pw/UCDwJDEsHwI/AAAAAAAAchI/FD7XGW9cVXw/s320/OKG_ENC28J60.jpg" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">OKG ENC28J60 module</td></tr></tbody></table><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-r7eOA-w7_EM/UCDwKqITzcI/AAAAAAAAchQ/Cq8RmY0V2ac/s1600/OKG_Wiznet.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="253" src="http://3.bp.blogspot.com/-r7eOA-w7_EM/UCDwKqITzcI/AAAAAAAAchQ/Cq8RmY0V2ac/s320/OKG_Wiznet.jpg" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">OKG Wiznet W5200 module&nbsp;</td></tr></tbody></table>We now have stock of the OKG in kit form in the OpenEnergyMonitor shop. The kits will come with an RFM12B wireless radio (choice of frequency) and a choice of ENC28J60 or Wiznet&nbsp;Ethernet&nbsp;chips.<br /><br />The OKG with the ENC28J60 is almost hardware identical to the NanodeRF. NanodeRF emonBase sketches will run on the OKG with a couple of little changes.<br /><br />See the OKG OpenEnergyMonitor wiki page for the changes required to make the OKG work with the RFM12B and OpenEnergyMonitor emonBase examples:<br /><br /><a href="http://wiki.openenergymonitor.org/index.php?title=Open_Kontrol_Gateway">http://wiki.openenergymonitor.org/index.php?title=Open_Kontrol_Gateway</a><br /><br />Note: The wiki is still in beta, we will blog more about it once it's been a bit more polished. It's our hope that by using a Media Wiki for our more technical documentation people will be more inclined to contribute&nbsp;corrections&nbsp;and additions and the documentations should be easier to organise and maintain. The OpenEnergyMonitor login should automatically log you in to the wiki. Just make sure your logged into the OpenEnergyMonitor website before opening up the wiki page. Try clearing your browsers cookies if this&nbsp;doesn't&nbsp;work first time.<br /><br />We are now stocking the OKG in the OpenEnergyMonitor shop:&nbsp;<a href="http://shop.openenergymonitor.com/open-kontrol-gateway/">http://shop.openenergymonitor.com/open-kontrol-gateway/</a><br /><br /><b>What about the Raspberry Pi!?&nbsp;</b><br />Don't worry we&nbsp;haven't&nbsp;overlooked the Raspberry Pi! We have&nbsp;successfully had <a href="http://openenergymonitor.org/emon/emoncms/installing-ubuntu-debian-pi">emoncms running on a Pi</a> receiving RFM12B data from a USB JeeLink, we plan to blog more about this soon. We're currently with&nbsp;<a href="http://harizanov.com/">Martin Harizanov</a>&nbsp;to make a RFM12B to Raspberry Pi GPIO expansion board. The Raspberry Pi will make a very powerful emonbase/home energy server however it's quite a complicated little beast for beginners who have limited linux knowledge. We think there is still a need to also have a simpler Arduino based emonBase option such as the NanodeRF or OKG.
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/08/emontx-smt-progress-update/">emonTx SMT - Progress Update</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-08-08T11:58:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-08-08 11:58:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Glyn Hudson</span> <br>
    <span><i class='icon-time'></i> two minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emontx/'>emonTx</a></li>
      
        <li><a class='category' href='/categories/emontxsmt/'>emonTxSMT</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/08/emontx-smt-progress-update/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <br /><div class="western" style="margin-bottom: 0cm;">Hello Everyone,  </div><div class="western" style="margin-bottom: 0cm;"><br /></div><div class="western" style="margin-bottom: 0cm;">Here's another progress update on the emonTx SMT design.</div><div class="western" style="margin-bottom: 0cm;"><br /></div><div class="western" style="margin-bottom: 0cm;">This week I've sent the PCB CAD design files off to get a few prototype PCB's made. It's a very exciting moment, quite a milestone but also nerve wrecking! These prototypes will be assembled by hand and tested extensively. Eventually we plan to get the board ready assembled using factory SMT pick-and-place machines, selling the emonTX SMT as a kit is not an option! We don't plan to discontinue the current through-hole emonTx, we believe there is value in having a simpler through-hole kit version as an option.&nbsp;</div><div class="western" style="margin-bottom: 0cm;"><br /></div><div class="western" style="margin-bottom: 0cm;">It will be sometime before emonTx SMT's are rolling off the production line, there are many hoops which need to be jumped through before then, but getting the first prototype off the ground is a good step forward!&nbsp;</div><div class="western" style="margin-bottom: 0cm;"><br /></div><div class="western" style="margin-bottom: 0cm;">As a quick re-cap the main features of the emonTx SMT are:</div><ul><li><div class="western" style="margin-bottom: 0cm;"><b>Improved  accuracy when monitoring low power levels</b> with a programmable  gain op-amp input stage on the CT inputs..<a href="http://openenergymonitor.blogspot.com/2012/06/high-accuracy-current-measurement-over.html">see blog post</a></div></li><li><div class="western" style="margin-bottom: 0cm;"><b>Single power  supply</b>  - Half-wave rectifier AC-DC circuit to power the unit  (under basic operation) and monitor mains voltage (enabling real  power readings) from a single AC-AC PSU..see <a href="http://openenergymonitor.blogspot.com/2012/05/emontx-single-ac-power-supply.html">blog post</a></div></li><li><div class="western" style="margin-bottom: 0cm;"><b>Direct USB  programming</b>  - No USB to UART or  FTDI cable required - built in  USB host using the ATmega32u4 building on Arduino Leonardo design.   </div></li><li><div class="western" style="margin-bottom: 0cm;"><b>On-board  Ethernet and multiple wireless radio options</b> – RFM12B will  remain the default option.</div></li><li><div class="western" style="margin-bottom: 0cm;"><b>Pluggable-terminal block</b> - Pulse-counting input, 2 x one-wire temperature inputs and other spare I/O broken out on a  pluggable-terminal block.   </div></li><li><div class="western" style="margin-bottom: 0cm;"><b>Casing</b> - designed  to fit in a nice wall-mountable extruded aluminium case with laser  cut fascias and external SMA antenna.</div><div class="western" style="margin-bottom: 0cm;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-7oKuevJaDK8/UCJKdMwMzbI/AAAAAAAAch4/VvYwGVzu16A/s1600/emonTXSMT06_2_brd_components_white.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="550" src="http://4.bp.blogspot.com/-7oKuevJaDK8/UCJKdMwMzbI/AAAAAAAAch4/VvYwGVzu16A/s640/emonTXSMT06_2_brd_components_white.png" width="640" /></a></div><div class="western" style="margin-bottom: 0cm;"><br /></div></li></ul><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-sUIZXWler4o/UCJKNCbgiPI/AAAAAAAAcho/OOjA3X60d7s/s1600/emonTxSMT06_2_labeled.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="552" src="http://4.bp.blogspot.com/-sUIZXWler4o/UCJKNCbgiPI/AAAAAAAAcho/OOjA3X60d7s/s640/emonTxSMT06_2_labeled.png" width="640" /></a></div><div class="western" style="margin-bottom: 0cm;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-d9rjG-eQWJE/UCJKboQzTcI/AAAAAAAAchw/iSGt0GqOJ9I/s1600/emonTXSMT06_2_brd_tracks.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="550" src="http://2.bp.blogspot.com/-d9rjG-eQWJE/UCJKboQzTcI/AAAAAAAAchw/iSGt0GqOJ9I/s640/emonTXSMT06_2_brd_tracks.png" width="640" /></a></div><div class="western" style="margin-bottom: 0cm;"><br /></div><div class="western" style="margin-bottom: 0cm;">For more info, design notes and my general ramblings see my&nbsp;<a href="http://openenergymonitor.org/emon/node/736#comment-5592">forum post</a>...</div>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/08/overload-protection-of-mains-electrical/">Overload Protection of Mains Electrical Circuits by Robert Wall</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-08-04T18:29:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-08-04 18:29:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> 1 minute reading time</span> <br>
     <br>
    
      <a class='comments'
         href="/2012/08/overload-protection-of-mains-electrical/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    A new guide by Robert Wall on&nbsp;overload protection of mains electrical circuits.<br /><br /><a href="http://openenergymonitor.org/emon/user/924">Robert Wall </a>writes:<br /><br /><div style="background-color: #eeeeee; border: 1px solid #ccc; margin: 5px; padding: 10px;"><b>The fundamentals.</b><br /><br />All electrical circuits must have some means of protecting against overload. This may be done by including a fuse or circuit breaker in the circuit, or the protection may be designed in to the supply that is feeding the circuit. We will only consider fuses and circuit breakers, as these are most likely the device that will be encountered in a normal environment.<br /><br /><b>How to determine the ratings.</b><br /><br />First, you need to know the current that the load demands, under all conditions. You then need to choose a fuse or circuit breaker that will not blow (or trip) when carrying that current, but with only the smallest safety margin under worst-case conditions. Finally, you must choose everything in between – cable, switches, plug &amp; sockets, etc – so that each will safely carry the current that will guarantee that the fuse will blow, or the circuit breaker will trip, under all conditions (paying particular regard to ambient temperature and the ability of the cable expecially to stay cool, i.e. it must not be buried in insulation).<br /><br />Read the full guide here:&nbsp;<a href="http://openenergymonitor.org/emon/buildingblocks/overload-protection-of-mains-electrical-circuits">Overload Protection of Mains Electrical Circuits</a></div>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/08/plug-and-play-sensor-nodes/">Plug and play sensor nodes</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-08-02T12:38:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-08-02 12:38:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> 1 minute reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emonbase/'>emonBase</a></li>
      
        <li><a class='category' href='/categories/emonglcd/'>emonGLCD</a></li>
      
        <li><a class='category' href='/categories/emontx/'>emonTx</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/08/plug-and-play-sensor-nodes/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div><br /><div class="separator" style="clear: both; text-align: left;">At the moment to get a system up and running you need to do quite a bit of manual firmware configuration, setting&nbsp;unique&nbsp;node-id's selecting different emontx sketches for different functionality, hard coding the emonglcd to get different screens.&nbsp;To add a second emontx you need to add several lines of code to the emonbase and the basestation needs to know the data structure of the sensor nodes.</div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-M15_WatZsbA/UBpruoqSO2I/AAAAAAAACeQ/DWmAsG4iG6c/s1600/OEM_system_emoncms2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="212" src="http://3.bp.blogspot.com/-M15_WatZsbA/UBpruoqSO2I/AAAAAAAACeQ/DWmAsG4iG6c/s400/OEM_system_emoncms2.png" width="400" /></a></div><br />What if you could upload a standard sketch to each of these nodes, plug your base station into your router, power up an emontx and see emontx 1 appear in a node list in emoncms. Then as you add more nodes they automatically appear in emoncms, no additional base station configuration needed. In time the software could develop to allow remote configuration of nodes such as&nbsp;emontx config and emonGLCD pages: beginning with page template functions as described in the last blog post:&nbsp;<a href="http://openenergymonitor.blogspot.com/2012/07/emonglcd-template-based-displays.html">emonglcd template based displays</a><br /><br />Continue reading the forum post <a href="http://openenergymonitor.org/emon/node/904">here</a>.
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/08/low-level-adc-control-admux/">Low-level ADC control: ADMUX</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-08-02T09:51:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-08-02 09:51:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> seven minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emontx/'>emonTx</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/08/low-level-adc-control-admux/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div><span class="Apple-style-span" style="background-color: white; font-family: Arial, Verdana, sans-serif; font-size: 12px;"></span><br />While discussing the 3 phase sketch implementation here:&nbsp;<a href="http://openenergymonitor.org/emon/node/467">http://openenergymonitor.org/emon/node/467</a>&nbsp;by Pcunha which makes use of the AVR analog read commands rather than the arduino analog_read function&nbsp;which is a wrapping for these commands JBecker suggested that the analog reference voltage was not being selected correctly, so I had to do some reading up on this on ADMUX and bitwise operators.<br /><br />So for anyone interested, this is how it works first ADMUX is an 8-bit byte that holds the settings for the analog reference voltage and the analog pin to select:<br /><br />ADMUX is 8-bit:<br /><br /><span class="Apple-style-span" style="font-family: Verdana, Helvetica, Arial, sans-serif; font-size: 13px; line-height: 16px;"><table border="1" bordercolor="#888888" cellspacing="0" style="border-bottom-color: rgb(136, 136, 136); border-bottom-width: 1px; border-collapse: collapse; border-left-color: rgb(136, 136, 136); border-left-width: 1px; border-right-color: rgb(136, 136, 136); border-right-width: 1px; border-top-color: rgb(136, 136, 136); border-top-width: 1px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><tbody><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top; width: 59px;">&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>7 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>6 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>5 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>4 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>3 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>2 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>1 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>0 bit&nbsp;</b></td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top;"><b>ADMUX</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">REFS1</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">REFS0&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">ADLAR&nbsp;</td><td style="background-color: #f3f3f3; color: #999999; font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">-&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">MUX3&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">MUX2&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">MUX1&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">MUX0&nbsp;</td></tr></tbody></table></span><span class="Apple-style-span" style="font-family: Verdana, Helvetica, Arial, sans-serif; font-size: 13px; line-height: 16px;"></span>Where:<br /><br /><span class="Apple-style-span" style="font-family: Verdana, Helvetica, Arial, sans-serif; font-size: 13px; line-height: 16px;"><table border="1" bordercolor="#888888" cellspacing="0" style="border-bottom-color: rgb(136, 136, 136); border-bottom-width: 1px; border-collapse: collapse; border-left-color: rgb(136, 136, 136); border-left-width: 1px; border-right-color: rgb(136, 136, 136); border-right-width: 1px; border-top-color: rgb(136, 136, 136); border-top-width: 1px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><tbody><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top; width: 77px;"><b>&nbsp;REFS1</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 77px;"><b>REFS0&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 402px;"><b>Voltage Reference Selection&nbsp;</b></td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top;">&nbsp;0</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">0&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">AREF, Internal Vref turned off&nbsp;</td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top;">&nbsp;0</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">1&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">AVcc with external capacitor on AREF pin&nbsp;</td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top;">&nbsp;1</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">0&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">Reserved&nbsp;</td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top;">&nbsp;1</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">1&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">Internal 1.1V (ATmega168/328) or &nbsp;2.56V on (ATmega8)</td></tr></tbody></table></span>and:<br /><br /><span class="Apple-style-span" style="font-family: Verdana, Helvetica, Arial, sans-serif; font-size: 13px; line-height: 16px;"><table border="1" bordercolor="#888888" cellspacing="0" style="border-bottom-color: rgb(136, 136, 136); border-bottom-width: 1px; border-collapse: collapse; border-left-color: rgb(136, 136, 136); border-left-width: 1px; border-right-color: rgb(136, 136, 136); border-right-width: 1px; border-top-color: rgb(136, 136, 136); border-top-width: 1px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><tbody><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; vertical-align: top; width: 111px;"><b>MUX 3...0</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top; width: 307px;"><b>Single Ended Input</b></td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; vertical-align: top;">&nbsp;0000</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">ADC0&nbsp;</td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; vertical-align: top;">&nbsp;0001</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">ADC1&nbsp;</td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; vertical-align: top;">&nbsp;0010</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">ADC2&nbsp;</td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; vertical-align: top;">&nbsp;0011</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">ADC3&nbsp;</td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; vertical-align: top;">&nbsp;0100</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">ADC4&nbsp;</td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; vertical-align: top;">&nbsp;0101</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; vertical-align: top;">ADC5</td></tr></tbody></table></span><br /><span class="Apple-style-span" style="font-family: Verdana, Helvetica, Arial, sans-serif; font-size: x-small;"><span class="Apple-style-span" style="line-height: 16px;"><br /></span></span><br /><span class="Apple-style-span" style="background-color: white; font-family: Arial, Verdana, sans-serif; font-size: 12px;"><span class="Apple-style-span" style="font-family: Verdana, Helvetica, Arial, sans-serif; font-size: 13px; line-height: 16px;"><br /></span></span><br />So if we want to use AVcc with external capacitor on AREF pin as our voltage reference (which is the default arduino voltage reference) and we want to select ADC2 for example, we would need to set ADMUX to:<div><br /></div><div><span class="Apple-style-span" style="font-family: Verdana, Helvetica, Arial, sans-serif; font-size: 13px; line-height: 16px;"><table border="1" bordercolor="#888888" cellspacing="0" style="border-bottom-color: rgb(136, 136, 136); border-bottom-width: 1px; border-collapse: collapse; border-left-color: rgb(136, 136, 136); border-left-width: 1px; border-right-color: rgb(136, 136, 136); border-right-width: 1px; border-top-color: rgb(136, 136, 136); border-top-width: 1px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><tbody><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top; width: 59px;">&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>7 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>6 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>5 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>4 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>3 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>2 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>1 bit&nbsp;</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top; width: 59px;"><b>0 bit&nbsp;</b></td></tr><tr><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; height: 15px; text-align: center; vertical-align: top;"><b>ADMUX</b></td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">0</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">1</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">0&nbsp;</td><td style="background-color: #f3f3f3; color: #999999; font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">0&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">0&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">0&nbsp;</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">1</td><td style="font-family: Arial, Verdana, sans-serif; font-size: 12px; text-align: center; vertical-align: top;">0&nbsp;</td></tr></tbody></table></span><div><br /></div><div>We can use <a href="http://en.wikipedia.org/wiki/Operators_in_C_and_C%2B%2B">bitwise operations</a> to get there:</div><div><br /></div><div>This is how its done in&nbsp;<i>wiring_analog.c</i> found in <i>Arduino-1.0/hardware/arduino/cores/arduino</i><br /><br /><b>ADMUX = (analog_reference &lt;&lt; 6) | (pin &amp; 0x07);</b><br /><b><br /></b><br />Starting with<b>&nbsp;(analog_reference &lt;&lt; 6)</b>. The variable analog_reference is set to 1 as default for the atmega328 so&nbsp;1 &lt;&lt; 6 means bitshift 1 left 6 places where 1 in binary is&nbsp;00000001 and shifting the bits left 6 places moves the 1 to 01000000. The desirable result for setting the 6th bit REFS0 to 1.<br /><br />If you dont need to select different analog_reference values then we can get&nbsp;01000000 directly by specifying its&nbsp;hexadecimal: 0x40.<br /><br />Next looking at the&nbsp;<b>&nbsp;(pin &amp; 0x07) </b>part.<br /><br /><ul><li>The &amp; 0x07 is actually just for validation, it essentially says only allow selection of ADC0 to ADC5.&nbsp;</li><li>The &amp; bitwise operator is the <b>AND</b> operation.</li><li>0x07 is&nbsp;hexadecimal whose binary representation is 00000111</li><li>Selecting ADC2 which is pin = 2 or in binary 00000010</li><li>The result of 2 &amp; 0x07 =&nbsp;00000010 AND&nbsp;00000111 =&nbsp;00000010.</li></ul><br />The last part is the<b> | </b>bitwise operator: <b>OR</b><br /><b><br /></b><br />(analog_reference &lt;&lt; 6) | (pin &amp; 0x07) becomes in our example here&nbsp;01000000 OR 00000010. Which is equall to:&nbsp;<b>01000010 </b>the result we where looking for above.<br /><br />If you would like to read more on the AVR ADC commands see these&nbsp;helpful&nbsp;articles:<br /><br /><a href="https://sites.google.com/site/qeewiki/books/avr-guide/analog-input">https://sites.google.com/site/qeewiki/books/avr-guide/analog-input</a><br /><a href="http://www.protostack.com/blog/2011/02/analogue-to-digital-conversion-on-an-atmega168/">http://www.protostack.com/blog/2011/02/analogue-to-digital-conversion-on-an-atmega168/</a><br /><br /></div></div>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/08/configurable-single-to-3-phase/">Configurable single to 3-phase interrupt based EmonTX code by Pcunha</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-08-01T19:54:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-08-01 19:54:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> Less than one minute reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emontx/'>emonTx</a></li>
      
        <li><a class='category' href='/categories/three-phase/'>three phase</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/08/configurable-single-to-3-phase/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div>Some great work I'd like to flag up by <a href="http://openenergymonitor.org/emon/user/754">Pcunha</a>, who has developed a super configurable single to 3-phase interrupt based firmware for the EmonTX.<br /><br />Its up on github here:<br /><a href="https://github.com/pcunha-lab/emonTxFirmware/tree/master/emonTx_Interrupts">https://github.com/pcunha-lab/emonTxFirmware/tree/master/emonTx_Interrupts</a><br /><br />and there is more about it in the forum thread here:<br /><a href="http://openenergymonitor.org/emon/node/467#comment-5481">http://openenergymonitor.org/emon/node/467#comment-5481</a>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/07/emonglcd-template-based-displays/">EmonGLCD Template based display's</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-07-29T10:00:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-07-29 10:00:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> two minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emonglcd/'>emonGLCD</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/07/emonglcd-template-based-displays/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div><div>I have been thinking about how it could be possible to program an EmonGLCD display remotely or at least specify which displays are shown i.e if you could construct a command to tell the display to:</div><div><br /></div><div><i>display solar pv page as page 1, use the solar power value from node 10.&nbsp;</i></div><div><i><br /></i></div><div>Skipping for now the how the commands are sent and interpreted, I think the first part of creating these specifiable displays is to convert the current display code into template functions which should be of benefit whether the displays are remotely programmed or not.</div><div><br /></div><div>Here's my first attempt at this:</div><div><br /></div><b>draw_power_page( "POWER" ,use, "USE", usekwh);</b><br /><div><b>draw_temperature_time_footer(temp, mintemp, maxtemp, hour,minute);</b></div><div>draws the following page:</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-kdlCwY1w6Co/UBUIwPtRtNI/AAAAAAAACd4/3uUkU5CG3vA/s1600/IMAG0852.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-kdlCwY1w6Co/UBUIwPtRtNI/AAAAAAAACd4/3uUkU5CG3vA/s1600/IMAG0852.jpg" /></a></div><div><br /></div><div><br /></div><div><b>draw_solar_page(use, usekwh, gen, 2050, genkwh, temp, mintemp, maxtemp,&nbsp;hour,minute<span class="Apple-style-span">);</span></b></div><div><span class="Apple-style-span">draws:</span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-oQkq7qv3I2I/UBUI5y7r0UI/AAAAAAAACeA/4MzulT2rkfc/s1600/IMAG0855.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-oQkq7qv3I2I/UBUI5y7r0UI/AAAAAAAACeA/4MzulT2rkfc/s1600/IMAG0855.jpg" /></a></div><div><span class="Apple-style-span"><br /></span></div><div>(thanks to drsdre for <a href="http://openenergymonitor.blogspot.com/2012/07/emonglcd-icons-by-drsdre.html">the icons!</a>)</div><div><br /></div><div>This is what the full code looks like:</div><div><br /></div><pre>#include&nbsp;&lt;JeeLib.h&gt;<br />#include&nbsp;&lt;GLCD_ST7565.h&gt;<br />#include&nbsp;&lt;avr/pgmspace.h&gt;<br />GLCD_ST7565&nbsp;glcd;<br /><br /><span style="color: #cc6600;">unsigned</span> <span style="color: #cc6600;">long</span> fast_update;<br /><br /><span style="color: #7e7e7e;">//&nbsp;Fixed&nbsp;values&nbsp;for&nbsp;this&nbsp;example</span><br /><span style="color: #cc6600;">double</span> temp = 17.4 ,maxtemp = 19 ,mintemp = 16;<br /><span style="color: #cc6600;">int</span> hour = 23, minute = 43;<br /><span style="color: #cc6600;">double</span> use = 252, usekwh = 2.5;<br /><span style="color: #cc6600;">double</span> gen = 1760, genkwh = 4.8;<br /><br /><span style="color: #cc6600;">void</span> <span style="color: #cc6600;"><b>setup</b></span>()<br />{<br />&nbsp;&nbsp;glcd.<span style="color: #cc6600;">begin</span>(0x20);<br />&nbsp;&nbsp;glcd.backLight(200);<br />}<br /><br /><span style="color: #cc6600;">void</span> <span style="color: #cc6600;"><b>loop</b></span>()<br />{<br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//-----------------------------------------------------------------------------</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">// Display update every 200ms</span><br />&nbsp;&nbsp;<span style="color: #7e7e7e;">//-----------------------------------------------------------------------------</span><br />&nbsp;&nbsp;<span style="color: #cc6600;">if</span> ((<span style="color: #cc6600;">millis</span>()-fast_update)&gt;200)<br />&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;fast_update&nbsp;=&nbsp;<span style="color: #cc6600;">millis</span>();<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc6600;">int</span> S1 = <span style="color: #cc6600;">digitalRead</span>(15);<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc6600;">int</span> S2 = <span style="color: #cc6600;">digitalRead</span>(16);<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc6600;">int</span> S3 = <span style="color: #cc6600;">digitalRead</span>(19);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc6600;">if</span> (S1==1)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7e7e7e;">// powerstr, power, energystr, kwh</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;draw_power_page(&nbsp;<span style="color: #006699;">"POWER"</span> ,use, <span style="color: #006699;">"USE"</span>, usekwh);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7e7e7e;">// temp, mintemp, maxtemp, hour, minute</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;draw_temperature_time_footer(temp,&nbsp;mintemp,&nbsp;maxtemp,&nbsp;hour,minute);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;glcd.refresh();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc6600;">else</span> <span style="color: #cc6600;">if</span> (S2==1)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7e7e7e;">// powerstr, power, energystr, kwh</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;draw_power_page(&nbsp;<span style="color: #006699;">"SOLAR"</span> ,gen, <span style="color: #006699;">"GEN"</span>, genkwh);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7e7e7e;">// temp, mintemp, maxtemp, hour, minute</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;draw_temperature_time_footer(temp,&nbsp;mintemp,&nbsp;maxtemp,&nbsp;hour,minute);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;glcd.refresh();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #cc6600;">else</span><br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #7e7e7e;">// use, usekwh, gen, maxgen, genkwh, temp, mintemp, maxtemp, hour, minute</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;draw_solar_page(use,&nbsp;usekwh,&nbsp;gen,&nbsp;2050,&nbsp;genkwh,&nbsp;temp,&nbsp;mintemp,&nbsp;maxtemp,&nbsp;12,43);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;glcd.refresh();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;}&nbsp;<br />}<br /><br /><span class="Apple-style-span" style="font-family: 'Times New Roman'; white-space: normal;">To run this you will need the accompanying icons and templates files, its all available in the EmonGLCD repo here:&nbsp;<a href="https://github.com/openenergymonitor/EmonGLCD/tree/master/emonGLCD_Template_Dev">https://github.com/openenergymonitor/EmonGLCD/tree/master/emonGLCD_Template_Dev</a></span></pre><pre><br /></pre>Interested to hear any thoughts on how best to take this forward.</div>
    
  </div>
  </article>
  <hr>
  
  <article class="listing">
    <header>
  
  <h1 class="beta">
    <a href="/2012/07/reading-watt-hour-data-from-elster/">Reading Watt-hour data from an Elster A100C electricity meter using IrDA by Dave Berkeley</a>
  </h1>
  

  
  <div class="meta clearfix">
    <time datetime="2012-07-28T11:02:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2012-07-28 11:02:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> 1 minute reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emontx/'>emonTx</a></li>
      
        <li><a class='category' href='/categories/utility-meters/'>utility meters</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2012/07/reading-watt-hour-data-from-elster/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  <div class="entry-content clearfix">
    <div><div class="separator" style="clear: both; text-align: center;"><a href="http://www.rotwang.co.uk/projects/images/DSCN3869.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="272" src="http://www.rotwang.co.uk/projects/images/DSCN3869.JPG" width="400" /></a></div><br />If you have an Elster meter this is a fantastic way to read the exact accumulated watt hours that you have generated or used and can compliment and cross check a CT based measurement.<br /><br /><a href="http://www.rotwang.co.uk/">Dave Berkeley</a> writes:<br /><br /><div style="background-color: #dddddd; font-size: 90%; padding: 10px;">The A100C has an LCD display showing the number of kilowatt hours generated, but it also has two optical outputs. One flashes momentarily each time one watt hour is recorded. The second output is an infrared port which transmits the details of the meter, including accumulated Watt Hours, every second or so.<br /><br />There are lots of commercial power meter readers around, and many homemade ones too. But they all seem to simply count the 1Wh optical pulses. This does give you an accurate measure of instantaneous power usage / generation, but does not give accumulated totals. If you get a malfunction in the reader you will lose counts. If you count the IrDA output it always gives you accurate accumulated totals.</div><br />Read the full build guide here: <a href="http://www.rotwang.co.uk/projects/meter.html">Electricity Meter Reader</a><br /><br />and download the Arduino source code here: <a href="http://www.rotwang.co.uk/projects/docs/elec_meter.ino">elec_meter.ino</a><br /><br />The only thing you need to get this running on an arduino or an emontx is a&nbsp;<a href="http://www.alldatasheet.com/datasheet-pdf/pdf/92399/ETC/TSL261.html">TSL261R</a> optical sensor, the TSL261R has the same pin out as the  <a href="http://openenergymonitor.org/emon/sites/default/files/TSL257.pdf">TSL257</a>&nbsp;so can be connected to the emontx pulse input.<br /><br />We've put together a small kit <a href="http://shop.openenergymonitor.com/tsl261r-ir-sensor-kit/">available in the shop</a> of all the components needed to connect it to an emontx including the TSL261R a male 3.5mm jack, 1m of cable and&nbsp;heat-shrink to save needing to get all the components from different places.</div>
    
  </div>
  </article>
  <hr>
  

  <div class="pagination">
    
      <a class="btn pull-left" href="/posts/24">&larr; Older</a>
    

    
    <a class="btn pull-right" href="/posts/22">Newer &rarr;</a>
    
  </div>


    </div>

    
    <aside id="sidebar" class="grid__item one-third lap-one-whole palm-one-whole">
      <div class="grid">

 
 <section id="recent-posts" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">Recent Posts</h1>
  <ul class="divided">
    
      
        <li class="post">
          <a href="/2017/10/iotawatt/">Intorducing IoTaWatt</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/08/cydynni-energylocal/">CydYnni – Energy Local, community hydro smart grid</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/08/advances-article/">Advances Wales Magazine Article</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/06/emoncms-android-app-v2/">Emoncms Android App V2</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/06/emonpi-network-setup-wizard/">emonPi Network Setup Wizard</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/05/raspberrypi-blog/">Raspberry Pi blog</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/05/emonpi-mqtt-googlehome/">emonPi as a Home Automation Hub</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/02/myhomeenergyplanner/">MyHomeEnergyPlanner - open source home energy assessment</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/02/learn-sustainable-energy/">Launching Learn: Sustainable Energy</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2017/01/new-home-page-and-learn/">New home page and Learn website!</a>
        </li>
      
    
  </ul>
</section>
  
  
     <section class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">Categories</h1>
  <ul class="divided">
    
    
      <li><a href="/categories/air-quality-egg/">Air Quality Egg</a></li>
    
      <li><a href="/categories/antenna/">Antenna</a></li>
    
      <li><a href="/categories/building-energy-modelling/">Building Energy Modelling</a></li>
    
      <li><a href="/categories/china/">China</a></li>
    
      <li><a href="/categories/christmas/">Christmas</a></li>
    
      <li><a href="/categories/dc/">DC</a></li>
    
      <li><a href="/categories/dc-current-sensing/">DC current sensing</a></li>
    
      <li><a href="/categories/esp8266/">ESP8266</a></li>
    
      <li><a href="/categories/htu21d/">HTU21D</a></li>
    
      <li><a href="/categories/heat-pump/">Heat Pump</a></li>
    
      <li><a href="/categories/kaizen/">Kaizen</a></li>
    
      <li><a href="/categories/kicad/">KiCad</a></li>
    
      <li><a href="/categories/mqtt/">MQTT</a></li>
    
      <li><a href="/categories/nanoderf/">NanodeRF</a></li>
    
      <li><a href="/categories/nodered/">NodeRed</a></li>
    
      <li><a href="/categories/oem-labs/">OEM Labs</a></li>
    
      <li><a href="/categories/okg/">OKG</a></li>
    
      <li><a href="/categories/oscilloscope/">Oscilloscope</a></li>
    
      <li><a href="/categories/rfm12/">RFM12</a></li>
    
      <li><a href="/categories/rfm69/">RFM69</a></li>
    
      <li><a href="/categories/rs485/">RS485</a></li>
    
      <li><a href="/categories/sap-2012/">SAP 2012</a></li>
    
      <li><a href="/categories/shw/">SHW</a></li>
    
      <li><a href="/categories/srf/">SRF</a></li>
    
      <li><a href="/categories/tasker/">Tasker</a></li>
    
      <li><a href="/categories/android/">android</a></li>
    
      <li><a href="/categories/app/">app</a></li>
    
      <li><a href="/categories/application/">application</a></li>
    
      <li><a href="/categories/arduino/">arduino</a></li>
    
      <li><a href="/categories/award/">award</a></li>
    
      <li><a href="/categories/backup/">backup</a></li>
    
      <li><a href="/categories/batteries/">batteries</a></li>
    
      <li><a href="/categories/benchmarking/">benchmarking</a></li>
    
      <li><a href="/categories/build-sesh/">build sesh</a></li>
    
      <li><a href="/categories/business/">business</a></li>
    
      <li><a href="/categories/ciseco/">ciseco</a></li>
    
      <li><a href="/categories/community-energy/">community energy</a></li>
    
      <li><a href="/categories/community-smart-grid/">community smart grid</a></li>
    
      <li><a href="/categories/continuous-testing/">continuous testing</a></li>
    
      <li><a href="/categories/control/">control</a></li>
    
      <li><a href="/categories/current-sensor/">current sensor</a></li>
    
      <li><a href="/categories/current-transformer/">current transformer</a></li>
    
      <li><a href="/categories/dashboard/">dashboard</a></li>
    
      <li><a href="/categories/display/">display</a></li>
    
      <li><a href="/categories/diy-drones/">diy drones</a></li>
    
      <li><a href="/categories/docker/">docker</a></li>
    
      <li><a href="/categories/documentation/">documentation</a></li>
    
      <li><a href="/categories/ecohomelab/">ecohomelab</a></li>
    
      <li><a href="/categories/efergy/">efergy</a></li>
    
      <li><a href="/categories/electronics/">electronics</a></li>
    
      <li><a href="/categories/elektrocamp/">elektrocamp</a></li>
    
      <li><a href="/categories/email-notifications/">email notifications</a></li>
    
      <li><a href="/categories/embodied-energy/">embodied energy</a></li>
    
      <li><a href="/categories/emonbase/">emonBase</a></li>
    
      <li><a href="/categories/emonctrl/">emonCtrl</a></li>
    
      <li><a href="/categories/emonglcd/">emonGLCD</a></li>
    
      <li><a href="/categories/emonsd/">emonSD</a></li>
    
      <li><a href="/categories/emonth/">emonTH</a></li>
    
      <li><a href="/categories/emontx/">emonTx</a></li>
    
      <li><a href="/categories/emontx-v2/">emonTx V2</a></li>
    
      <li><a href="/categories/emontxsmt/">emonTxSMT</a></li>
    
      <li><a href="/categories/emontxshield/">emonTxShield</a></li>
    
      <li><a href="/categories/emoncms/">emoncms</a></li>
    
      <li><a href="/categories/emonesp/">emonesp</a></li>
    
      <li><a href="/categories/emonpi/">emonpi</a></li>
    
      <li><a href="/categories/emontx/">emontx</a></li>
    
      <li><a href="/categories/end-to-end/">end to end</a></li>
    
      <li><a href="/categories/energy-monitor/">energy monitor</a></li>
    
      <li><a href="/categories/energy-monitoring/">energy monitoring</a></li>
    
      <li><a href="/categories/esp8266/">esp8266</a></li>
    
      <li><a href="/categories/ev/">ev</a></li>
    
      <li><a href="/categories/feed-storage/">feed storage</a></li>
    
      <li><a href="/categories/firmware/">firmware</a></li>
    
      <li><a href="/categories/forum/">forum</a></li>
    
      <li><a href="/categories/github/">github</a></li>
    
      <li><a href="/categories/graphing/">graphing</a></li>
    
      <li><a href="/categories/hackathon/">hackathon</a></li>
    
      <li><a href="/categories/hall-effect/">hall effect</a></li>
    
      <li><a href="/categories/hardware/">hardware</a></li>
    
      <li><a href="/categories/heating/">heating</a></li>
    
      <li><a href="/categories/heatpumpmonitor/">heatpumpmonitor</a></li>
    
      <li><a href="/categories/home-assistant/">home Assistant</a></li>
    
      <li><a href="/categories/home-camp/">home camp</a></li>
    
      <li><a href="/categories/humidity/">humidity</a></li>
    
      <li><a href="/categories/integrations/">integrations</a></li>
    
      <li><a href="/categories/interface/">interface</a></li>
    
      <li><a href="/categories/interview/">interview</a></li>
    
      <li><a href="/categories/iotawatt/">iotawatt</a></li>
    
      <li><a href="/categories/java/">java</a></li>
    
      <li><a href="/categories/job/">job</a></li>
    
      <li><a href="/categories/kickstarter/">kickstarter</a></li>
    
      <li><a href="/categories/lightwaverf/">lightwaverf</a></li>
    
      <li><a href="/categories/linux/">linux</a></li>
    
      <li><a href="/categories/logo/">logo</a></li>
    
      <li><a href="/categories/manufacturing/">manufacturing</a></li>
    
      <li><a href="/categories/measurement/">measurement</a></li>
    
      <li><a href="/categories/media/">media</a></li>
    
      <li><a href="/categories/mobile/">mobile</a></li>
    
      <li><a href="/categories/mobile-app/">mobile app</a></li>
    
      <li><a href="/categories/modbus/">modbus</a></li>
    
      <li><a href="/categories/nanode/">nanode</a></li>
    
      <li><a href="/categories/ook/">ook</a></li>
    
      <li><a href="/categories/open-source/">open source</a></li>
    
      <li><a href="/categories/openhab/">openHAB</a></li>
    
      <li><a href="/categories/openenergymonitor/">openenergymonitor</a></li>
    
      <li><a href="/categories/openevse/">openevse</a></li>
    
      <li><a href="/categories/optical-pulse/">optical pulse</a></li>
    
      <li><a href="/categories/pcb/">pcb</a></li>
    
      <li><a href="/categories/pebble/">pebble</a></li>
    
      <li><a href="/categories/placement/">placement</a></li>
    
      <li><a href="/categories/platformio/">platformio</a></li>
    
      <li><a href="/categories/pluse/">pluse</a></li>
    
      <li><a href="/categories/presentation/">presentation</a></li>
    
      <li><a href="/categories/raspberry-pi/">raspberry Pi</a></li>
    
      <li><a href="/categories/raspberry-pi/">raspberry pi</a></li>
    
      <li><a href="/categories/renewable/">renewable</a></li>
    
      <li><a href="/categories/serial/">serial</a></li>
    
      <li><a href="/categories/shop/">shop</a></li>
    
      <li><a href="/categories/showcase/">showcase</a></li>
    
      <li><a href="/categories/smartwatch/">smartwatch</a></li>
    
      <li><a href="/categories/social-energy-monitoring/">social energy monitoring</a></li>
    
      <li><a href="/categories/solarpv/">solarPV</a></li>
    
      <li><a href="/categories/sparkfun/">sparkfun</a></li>
    
      <li><a href="/categories/sustainability/">sustainability</a></li>
    
      <li><a href="/categories/temperature/">temperature</a></li>
    
      <li><a href="/categories/three-phase/">three phase</a></li>
    
      <li><a href="/categories/travisci/">travisci</a></li>
    
      <li><a href="/categories/tutorials/">tutorials</a></li>
    
      <li><a href="/categories/upgrade/">upgrade</a></li>
    
      <li><a href="/categories/user-guide/">user guide</a></li>
    
      <li><a href="/categories/utility-meters/">utility meters</a></li>
    
      <li><a href="/categories/voltage-sensing/">voltage sensing</a></li>
    
      <li><a href="/categories/vrms/">vrms</a></li>
    
      <li><a href="/categories/website/">website</a></li>
    
      <li><a href="/categories/wifipixel/">wifipixel</a></li>
    
      <li><a href="/categories/wind/">wind</a></li>
    
      <li><a href="/categories/wind-turbine/">wind turbine</a></li>
    
      <li><a href="/categories/wireless/">wireless</a></li>
    
      <li><a href="/categories/workshop/">workshop</a></li>
    
      <li><a href="/categories/zerocarbonbritain/">zerocarbonbritain</a></li>
    
  </ul>
</section>
  
</div>
    </aside>
    
  </div>
</div>

<footer>
  <div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item">
      <div class="copyright">

  <a rel="me" href='https://twitter.com/openenergymon'><i class="icon-twitter"></i></a>
  <a rel="me" href='https://github.com/openenergymonitor/guide'><i class="icon-github"></i></a>
  <a rel="me" href='https://blog.openenergymonitor.org/feed.xml'><i class="icon-rss"></i></a>

  <div class="credit" style="text-align:center;">
    Website powered by <a href='http://jekyllrb.com/'>Jekyll</a> and <a href='https://github.com/coogie/oscailte'>Oscalite</a>.<br />
    Hosted by <a href='https://pages.github.com/'>GitHub</a> and served by <a href='https://cloudflare.com'>CloudFlare</a>.
  </div>
<!--
<div class="searchtool">


<form action="https://encrypted.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.openenergymonitor.org" />
    <input class="search" id="search" type="text" name="q" results="0" placeholder="Search..." />
  </fieldset>
</form>


</div> -->
</div>
    </div>
  </div>
</div>
</footer>

<!--[if lt IE 7]>
  <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
<![endif]-->

</body>
</html>
