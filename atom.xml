<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Blog | OpenEnergyMonitor]]></title>
  <link href="https://blog.openenergymonitor.org/atom.xml" rel="self"/>
  <link href="https://blog.openenergymonitor.org/"/>
  <updated>2016-10-30T19:36:07+00:00</updated>
  <id>https://blog.openenergymonitor.org/</id>
  <author>
    <name><![CDATA[Glyn Hudson]]></name>
    <email><![CDATA[support@openenergymonitor.zendesk.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Summer Placement]]></title>
    <link href="https://blog.openenergymonitor.org/2016/09/summer-placement/"/>
    <updated>2016-09-01T09:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/09/summer-placement</id>
    <content type="html"><![CDATA[<p>Hi! My name is Eben I’ve been working with OpenEnergyMonitor for the past 10 weeks as part of a summer placement organised by <a href="http://www.arloesigwyneddwledig.com/">Arloesi Gwynedd Wledig</a>; a local project aimed at highlighting the local tech sector employment opportunities on <a href="http://parcmenai.co.uk/">Parc Menai</a> the business park where we are located in North Wales, and the difficulties that they face, as well as the great perks of living in such a beautiful area.</p>

<p><img src="https://blog.openenergymonitor.org/images/eben.jpg" alt="image" /></p>

<p>The scheme organised placements for four students in four seperate tech companies in Parc Menai. Here is a video with highlights the whole 10 week scheme:</p>

<div class="videoWrapper">
<iframe width="560" height="315" src="https://www.youtube.com/embed/N2v2a3ZJq0E" frameborder="0" allowfullscreen=""></iframe>
</div>

<blockquote>
  <p>Working in a small company in a rural area, that has such a large online community has really opened my eyes to the possibilities that the internet and the digital age can offer, in that people are no longer bound to cities. Increasing infrastructure development in terms of roads and internet speeds has increased this mobility further, and I look forward to the growth that this will no doubt provide in Gwynedd. OpenEnergyMonitor is for me the perfect example of a growing business that has been made possible by opensource development, global connections and communities, and new technology.</p>
</blockquote>

<!--more-->

<h2 id="me-and-gwynedd">Me, and Gwynedd</h2>

<p><a href="https://en.wikipedia.org/wiki/Gwynedd">Gwynedd</a> is area that we live in North Wales. I am currently studying physics at Cardiff University, and originally from <a href="https://cy.wikipedia.org/wiki/Dyffryn_Nantlle">Dyffryn Nantlle</a>. As you can probably tell by my failure to find a decent photo of myself doing anything else, I’m (like Glyn and Trystan)  a keen climber, and that’s been my primary reason for wanting to return to Gwynedd to work, with a long list of climbs in the Llanberis Pass, Ogwen Valley, and Tremadog, and more that I wanted to have a go at. It’s a great way to appreciate Gwynedd, in my opinion, and I even got to go climbing with Glyn.</p>

<p>Check out the video here:</p>

<div class="videoWrapper">
<iframe width="560" height="315" src="https://www.youtube.com/embed/CzPMPY-I3_I" frameborder="0" allowfullscreen=""></iframe>
</div>

<p>It’s a little cheesy, but we got to climb with RC drones filming, so that was pretty sweet :-)</p>

<p>The other strong pull, for me, was the Welsh language; <a href="https://en.wikipedia.org/wiki/Welsh_language">Cymraeg</a>. I’ve spent two years now living and studying down in Cardiff, and the switch to the academic and leisure medium of English has been a little challenging, and it’s always amazing to come back to Gwynedd, and hear Welsh on the street and in the shops, as well as at home, and in the OpenEnergyMonitor workplace. A lot of our culture is tied intimately to the language, and it’s been good to feel that again.</p>

<h2 id="what-ive-been-up-to">What I’ve been up to</h2>

<p>During my time at the company, I’ve learnt how to write basic software from scratch (I’ve only ever done experimental analysis using python previously) to Arduino boards and the ESP8266, my eyes have been opened to the possibilities of GitHub, and other resources. I’ve played around with adding a DHT22 sensor to the ESP8266 and <a href="https://github.com/openenergymonitor/EmonESP/pull/7">creating an DHT22 &gt; Emoncms example</a> which I contributed to the emonESP GitHub repository.</p>

<p>I’ve also had the pleasure of working with Gwil on preparation and order fulfilment for the OpenEnergyMonitor shop, which has been fun!</p>

<p>Another interesting experience was the few times I visited the local electronics factory, <a href="http://www.dferrantigroup.com/pcb-population-test/">Denis Ferranti</a>  where the boards are all manufactured. It was really cool to see the manufacturing process, and the quality of the equipment there. It’s great to know that OpenEnergyMonitor are able to manufacuture locally, which contributes to the local economy.</p>

<h2 id="the-scheme">The Scheme</h2>

<p>Through the project that organised this placement opportunity, the four of us students (all at different companies) were asked to come to a conclusion on the situation regarding tech jobs in Gwynedd, and the so-called ‘brain drain’, as the best and brightest graduates leave the area to embrace city life.</p>

<p>The overall conclusion was that perceptions need to change. People overwhelmingly do not view Gwynedd as a place with lots of potential for tech jobs, but research has shown that the truth is the very opposite, with Parc Menai alone set to be the location of around 200 new jobs in the next few years. At a presentation at Pontio, at Bangor university, the four of us students reccomended modernisation of the school syllabus, a closer relationship between companies and schools, more grassroots tech events (a brilliant example of this sort of thing are the events held by <a href="https://www.facebook.com/NorthWalesTechnology/?fref=ts">North Wales Tech</a> (check them out!), and better utilisation of social media by companies looking for skilled graduates.</p>

<p>I’d like to thank Glyn, Trystan, and Gwil for making this summer such an incredibly fun and rewarding one, as well as an extremely eye opening one. I’m sure the company has a huge future, and I for one will be following future products and developments with keen interest.</p>

<p>Today is my last day, and it’s a little sad. I’m writing this blog but should probably stop and help Gwil assemble some more emonTH’s.. :-)</p>

<p>Eben, out.</p>

<p>There also will soon be footage of the Dennis Ferranti factory we visited, I will post it here as soon as it arrives!
Thanks for reading!</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[EcoHome Lab: From Monitoring to Control]]></title>
    <link href="https://blog.openenergymonitor.org/2016/08/ecohomelab-control/"/>
    <updated>2016-08-12T18:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/08/ecohomelab-control</id>
    <content type="html"><![CDATA[<p>Last night I attended <a href="https://www.meetup.com/Eco-Home-Lab-Manchester/events/230714252/">EcoHomeLab meetup</a> in Manchester organised by the <a href="http://carbon.coop/">CarbonCoop</a>.</p>

<blockquote>
  <p>EcoHomeLab monthly meetups at <a href="https://madlab.org.uk/">MadLab</a> brings householders and green-technologists together to take control of home energy use and generation.</p>
</blockquote>

<p>It was great fun to catch up with regular faces as well as meet many new interesting people.</p>

<p>I gave a short presentation overview of our efforts as OpenEnergyMonitor to make it as easy as possible for people to get started with energy monitoring and control (home automation) with a sustainability / energy saving focus.</p>

<p>I presented the recent work we have been doing to integrate platforms such as MQTT, Node-RED and openHAB ready-installed and pre-configured on the emonPi, our RaspberryPi based energy monitoring platform. These additional platforms run alongside Emoncms on the emonPi.</p>

<p><strong>See the <a href="http://guide.openenergymonitor.org/integrations/">Integrations section of our user guide for more info</a></strong></p>

<p>Here are copy of my slides from the event:</p>

<iframe src="https://docs.google.com/presentation/d/1qSaxiB2tAgMe3ehQ08E9_r340y9HgHUOYvyUvsHd55I/embed?start=false&amp;loop=false&amp;delayms=10000" frameborder="0" width="529" height="426" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" style="max-width: 100%;"></iframe>

<ul>
  <li>
    <p><a class="attachment" href="https://community.openenergymonitor.org/uploads/default/original/2X/1/1a55b8c172086f743b1b0abe1d01d7c10963d88c.pdf">Download in PDF format</a> (6.8 MB)</p>
  </li>
  <li><a href="https://docs.google.com/presentation/d/1qSaxiB2tAgMe3ehQ08E9_r340y9HgHUOYvyUvsHd55I/pub?start=false&amp;loop=false&amp;delayms=3000">View in HTML (hosted from Google Slides)</a></li>
  <li><a href="https://docs.google.com/presentation/d/1qSaxiB2tAgMe3ehQ08E9_r340y9HgHUOYvyUvsHd55I/edit?usp=sharing">View in full Google Slides format (with clickable hyperlinks &amp; selectable text)</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[HTU21D / Si72021 Temperature and Humidity Sensor]]></title>
    <link href="https://blog.openenergymonitor.org/2016/07/HTU21D-Temperature-Humidity-sensor/"/>
    <updated>2016-07-26T10:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/07/HTU21D-Temperature-Humidity-sensor</id>
    <content type="html"><![CDATA[<p>I have been been evaluating the <a href="https://octopart.com/htu21d-measurement+specialties-30374934">HTU21D</a> temperature and humidity sensor made by Measurement Specialties as a possible DHT22 replacement for the emonTH. This is quite a new sensor, released in 2013. The <a href="https://octopart.com/si7021-a10-gm-silicon+labs-31448011">Si72021</a> is also a posiblity with an identical pin-out and specs.</p>

<p><img src="https://blog.openenergymonitor.org/images/htu21d_1.png" alt="image" /></p>

<ul>
  <li><a href="https://octopart.com/htu21d-measurement+specialties-30374934">OctoPart list</a></li>
  <li><a href="http://datasheet.octopart.com/HTU21D-Measurement-Specialites-datasheet-22149496.pdf">Datasheet</a></li>
  <li><a href="http://uk.farnell.com/measurement-specialties/htu21d/humidity-digital-3-rh-dfn-6/dp/2393536?CMP=GRHB-OCTOPART">Farnell item</a></li>
  <li>DFM footprint</li>
  <li>Digital, pre-clibrated</li>
  <li>I2C</li>
</ul>

<p>The metrics speak for themselves:</p>

<table>
  <thead>
    <tr>
      <th>Metric</th>
      <th>HTU21D</th>
      <th>Si72021</th>
      <th>DHT22</th>
      <th>DHT22 vs HTU21D Difference</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Cost in 1k off</td>
      <td>£1.42 (July16)</td>
      <td>£2.15</td>
      <td>£4.57 (July16)</td>
      <td>3.2 times cheaper (£3.15 less!)</td>
    </tr>
    <tr>
      <td>Vcc</td>
      <td>2.1v - 3.6V</td>
      <td>1.9V - 3.6V</td>
      <td>3.3-6V</td>
      <td> </td>
    </tr>
    <tr>
      <td>Humidity accuracy</td>
      <td>±2% RH</td>
      <td>±2% RH</td>
      <td>±2%RH</td>
      <td>n/a</td>
    </tr>
    <tr>
      <td>Humidity Range</td>
      <td>0-100% RH</td>
      <td>0-100% RH</td>
      <td>0-100% RH</td>
      <td>n/a</td>
    </tr>
    <tr>
      <td>Temperature accuracy</td>
      <td>±0.3°C</td>
      <td>±0.4°C</td>
      <td>±0.5°C</td>
      <td>40% more accurate</td>
    </tr>
    <tr>
      <td>Temperature Range</td>
      <td>-40°C +125°C</td>
      <td>-40°C +125°C</td>
      <td>-40°C +80°C</td>
      <td>56% more accurate</td>
    </tr>
    <tr>
      <td>Sleep Current</td>
      <td>0.02uA</td>
      <td>0.06uA</td>
      <td>15uA</td>
      <td>750 times less power</td>
    </tr>
    <tr>
      <td>Measurement Current</td>
      <td>0.045mA</td>
      <td>0.09 mA</td>
      <td>0.5mA</td>
      <td>11 times less power</td>
    </tr>
    <tr>
      <td>Measurement time</td>
      <td>0.01s - 0.0026s</td>
      <td>0.01s - 0.0026s</td>
      <td>2s</td>
      <td>200 times faster</td>
    </tr>
    <tr>
      <td>Energy consumed per sample</td>
      <td>1.5uJ</td>
      <td>2.97uJ</td>
      <td>3300uJ</td>
      <td>2000 times less power</td>
    </tr>
    <tr>
      <td>Time sampling per day*</td>
      <td>14.4s</td>
      <td> </td>
      <td>2800s</td>
      <td> </td>
    </tr>
    <tr>
      <td>Time sleeping per day*</td>
      <td>86386s</td>
      <td> </td>
      <td>83600s</td>
      <td> </td>
    </tr>
    <tr>
      <td>Energy consumed per day*</td>
      <td>2.36mW [1]</td>
      <td> </td>
      <td>2836mW [2]</td>
      <td>1201 times less energy per day!</td>
    </tr>
  </tbody>
</table>

<p><em>-energy consumed (joule, J) = potential difference (volt, V) × charge (coulomb, C)</em><br />
<em>-charge (coulomb, C) = current (ampere, A) × time (second, s) 
*-energy consumed (joule, J)  = potential difference (volt, V) × current (ampere, A) × time (second, s)</em></p>

<!--more-->

<p>*Assuming 1 sample per min and sleeping in between samples, 1440 min per day = 86400s per day. See HTU21D testing repo a <a href="https://github.com/openenergymonitor/emonTH/blob/master/sensor_test/htu21d">sub-repository of the emonTH</a> for full calculations.</p>

<p><strong>An upgraded emonTH with a HTU21D sensor instead of DHT22 should benefit from substantially increased battery life, increased accuracy and lower cost.</strong></p>

<p>I’ve obtained <a href="https://www.sparkfun.com/products/retired/12064">HTU21D Sparkfun breakout to test</a> and easily got it working with an Arduino using the <a href="https://github.com/adafruit/Adafruit_HTU21DF_Library">Adafruit library</a>.</p>

<p><img src="https://blog.openenergymonitor.org/images/htu21d_2.jpg" alt="image" /></p>

<hr />

<p>There is some confusion with regard to the variants of this sensor <em>I believe</em> from my research that the HTU21D <strong>replaces</strong> the <a href="https://octopart.com/sht21-sensirion-19013846">SHT21</a> made by Sensirion. Both sensors have identical pin-outs.</p>

<hr />

<p>I hope to get a prototype emonTH with HTU21D up and running soon. I would be interested to hear if anyone has experience working with this sensor.</p>

<p>For disucssion see <a href="https://community.openenergymonitor.org/t/htu21d-temperature-and-humidity-sensor-possible-dht22-replacement/1106">HTU21D forum thread.</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Part 3/3: Continuous Deployment (Over-The-Air Update to ESP8266)]]></title>
    <link href="https://blog.openenergymonitor.org/2016/06/esp8266-ota-update/"/>
    <updated>2016-06-29T10:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/06/esp8266-ota-update</id>
    <content type="html"><![CDATA[<p><strong>This post is part of a series</strong></p>

<ul>
  <li><a href="https://blog.openenergymonitor.org/2016/06/platformio/">1/3 PlatfomIO overview &amp; compiling + uploading locally and on a Raspberry Pi</a></li>
  <li><a href="https://blog.openenergymonitor.org/2016/06/auto-build-continuous-test-firmware/">2/3: Continuous testing and auto release binary generation using PlatformIO &amp; TravisCI</a>
    <ul>
      <li>Related post: <a href="https://blog.openenergymonitor.org/2016/06/esp8266-emonesp-developments/">EmonESP ESP8266 WiFi developments</a></li>
    </ul>
  </li>
  <li><strong>3/3: Continuous Deployment (OTA to ESP8266)</strong></li>
</ul>

<hr />

<p>Following on from my last couple of posts in this series we now have a working continuous cloud-based build &amp; test (firmware compiling) flow using PlatformIO and TravisCI, to quickly recap:</p>

<ol>
  <li>Code change is committed to the <a href="https://github.com/openenergymonitor/EmonESP">EmonESP repo on GitHub</a></li>
  <li>TravisCI triggers a build (compile) using PlatformIO running in a TravisCI container in the cloud.</li>
  <li>If build/compilation process fails we get an email alert, if pull-request we get a warning before merging if proposed changes break the build.</li>
  <li>If a Git commit is tagged as a release the build process uploads the generated compiled binary (.bin) to the repo GitHub release page.</li>
</ol>

<p>The next step is to get the compiled binary from GitHub-releases (EmonESP in this example) deployed to a WiFi connected production ESP8266. Here’s the user facing EmonESP web-interface for this firmware update process:</p>

<p><img src="https://blog.openenergymonitor.org/images/emonesp-update.png" alt="image" /></p>

<!--more-->

<p>The OTA (over-the-air) firmware deployment process is based on Daniel Eichhorn’s (<a href="https://twitter.com/squix78">@squix78</a>) <a href="http://blog.squix.org/2016/06/esp8266-continuous-delivery-pipeline-push-to-production.html">excellent blog post</a>. In summary the process is as follows:</p>

<p><img src="https://blog.openenergymonitor.org/images/esp-update-process.png" alt="image" />
Diagram from <a href="http://blog.squix.org/2016/06/esp8266-continuous-delivery-pipeline-push-to-production.html">Daniel Eichhorn’s blog</a></p>

<ul>
  <li>The build is tagged with a version number using PlatformIO build-flag, see EmonESP <a href="https://github.com/openenergymonitor/EmonESP/blob/master/platformio.ini">platformio.ini</a>.</li>
  <li>An intermediate PHP script connects to the GitHub API to check the latest release version and returns this as a string.</li>
  <li>ESP sends it’s current running firmware version to the PHP script using tag argument <code class="highlighter-rouge">&amp;tag=1.0.2</code>.</li>
  <li>If the running firmware version does not match the latest release version, the PHP script grabs the latest release .bin from github-releases API and serves it up as a download to the ESP.</li>
  <li>ESP then flashes the compiled .bin OTA update using the <a href="https://github.com/esp8266/Arduino/tree/master/libraries">ESP8266httpUpdate library</a> which is built-in to the espressif Arduino tool-chain</li>
</ul>

<h3 id="intermediate-php-script">Intermediate PHP script</h3>

<p>Ideally the production ESP8266 would be able to contact the GitHub-release API directly negating the need for the intermediate PHP script. However, there are a number of reasons why this is not practical at the moment. To quote Daniel’s blog post:</p>

<blockquote>
  <ul>
    <li>The ESPhttpUpdate currently cannot follow redirects. This is important since github hosts the release artefacts on Amazon AWS. But in the API JSON &gt; object the address points to github, so the http client has to follow a redirect to download the artefact.</li>
    <li>Github uses https for its API and will redirect you to it if you are trying plain HTTP. This means that you would have to know the SSL fingerprints &gt; of the github API server and the AWS hosting instance since this is required by the ESPs secure client interface. After all the ESPs don’t have a chain &gt; of trusted certificates stored somewhere. While the fingerprint of the github API might be stable, the redirection on Amazon AWS might not always use &gt; the same certificate.</li>
  </ul>
</blockquote>

<p><strong>There is currently working example of this process (ESP8266 firmware + intermediate PHP script) in the <code class="highlighter-rouge">ota</code> branch of <a href="https://github.com/openenergymonitor/EmonESP">EmonESP GitHub Repo</a>.</strong></p>

<h3 id="security">Security</h3>

<p><strong>In it’s current implementation the update process described above is not secure.</strong></p>

<p>Obviously secure delivery and verification of the update binary is essential.</p>

<p>Ideally the binary download to the ESP would be done over secure https. This maybe be possible, however https support on the ESP is currently not super stable and limited by the available memory (as mentioned above).</p>

<p>A method to verify the compiled binary could be to sign the compiled binary with a private key which is verified by the ESP before firmware is updated.</p>

<p>I would be interested to hear from anyone with any thoughts / advice as to how secure ESP OTA firmware delivery can be achieved.</p>

<hr />
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Emoncms Docker]]></title>
    <link href="https://blog.openenergymonitor.org/2016/06/emoncms-docker/"/>
    <updated>2016-06-25T10:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/06/emoncms-docker</id>
    <content type="html"><![CDATA[<p>We have made the first steps towards running Emoncms to run in a <a href="https://www.docker.com/">Docker</a> container.</p>

<p>Dockerfiles and setup notes are in the emoncms-docker repository:</p>

<h3 id="httpsgithubcomemoncmsemoncms-dockerhttpsgithubcomemoncmsemoncms-docker"><a href="https://github.com/emoncms/emoncms-docker">https://github.com/emoncms/emoncms-docker</a></h3>

<p><img src="https://blog.openenergymonitor.org/images/docker-logo.png" alt="image" /></p>

<p>Docker is an exciting tool to help make development, testing and deployment of web-applications easier.</p>

<h2 id="what-is-docker-the-short-version">What is docker? (the short version):</h2>

<blockquote>
  <p>Docker containers wrap a piece of software in a complete filesystem that contains everything needed to run: code, runtime, system tools, system libraries – anything that can be installed on a server. This guarantees that the software will always run the same, regardless of its environment.</p>
</blockquote>

<h3 id="what-is-docker-the-long-version">What is docker? (the long version):</h3>

<blockquote>
  <p>Docker is an open-source platform for developers and sysadmins to build, ship, and run distributed applications. Consisting of Docker Engine, a portable, lightweight runtime and packaging tool, and Docker Hub, a cloud service for sharing applications and automating workflows, Docker enables apps to be quickly assembled from components and eliminates the friction between development, QA, and production environments. As a result, IT can ship faster and run the same app, unchanged, on laptops, data center VMs, and any cloud.</p>
</blockquote>

<h2 id="quick-start">Quick Start</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>$ docker pull openenergymonitor/emoncms
$ git clone https://github.com/emoncms/emoncms-docker
$ cd emoncms-docker
$ docker-compose up
</code></pre>
</div>

<p><strong>That’s it! Emoncms should now be runnning, browse to <a href="http://localhost:8080">http://localhost:8080</a></strong></p>

<!--more-->

<h2 id="emoncms-docker">Emoncms Docker</h2>

<p>Using Docker it’s possible to fire up Emoncms on a bare system (assuming Docker is installed) in a couple of minutes with all the LAMP install &amp; config taken care of.</p>

<p>This is great for development since it’s possible to play about with Emoncms running in a Docker container without fear of messing up your system or production Emoncms install.</p>

<p>In the future, Docker can even be used as a deployment tool for Emoncms. In theory, it should possible to deploy the Emoncms Docker container on any server within minutes.</p>

<p>We have taken a multi-container approach with php-apache running in one container and the MYSQL database running in another. The containers are linked using <a href="https://docs.docker.com/compose/overview/">docker-compose</a>.</p>

<p><strong>See <a href="https://github.com/emoncms/emoncms-docker">emoncms-docker Readme</a> for setup &amp; build instructions.</strong></p>

<p><em>Note: The Emoncms docker setup is currently in development and not recomended for production Emoncms deployment just yet.</em></p>

<h2 id="forum-discussion">Forum discussion</h2>

<p>See <a href="https://community.openenergymonitor.org/t/emoncms-docker/823/4">this forum topic</a> for discussion.</p>

<hr />
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ESP8266 WIFI developments]]></title>
    <link href="https://blog.openenergymonitor.org/2016/06/esp8266-emonesp-developments/"/>
    <updated>2016-06-20T10:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/06/esp8266-emonesp-developments</id>
    <content type="html"><![CDATA[<p>Glyn and I have been doing a bit of development recently on using the ESP8266 WiFi board with OpenEnergyMonitor hardware, we are quite excited about the potential of this little module to both reduce the cost of the system and simplify setup and installation especially for applications that primarily post to a remote emoncms server such as <a href="https://emoncms.org">emoncms.org</a>.</p>

<p><strong>Note:</strong> we have no plans to discontinue developments and support for Raspberry Pi based systems e.g. emonPi / emonBase. Quite the opposite: the local storage and processing of a Raspberry Pi based system has many advantages particularly for systems requiring more flexibility and customisation e.g Local Emoncms storage. MQTT, openHAB &amp; nodeRED integration. The ESP developments will be ran in parallel, in fact ESP could be configured to post to an emonPi / emonBase via MQTT for local on-site storage and integration.</p>

<p>We are at the moment working on three initial uses of the ESP8266:</p>

<h2 id="emontx-v3--esp8266-module">1. <strong>EmonTx V3</strong> + ESP8266 module</h2>

<p>We are initially using the Adafruit HUZZAH ESP8266 module as a development platform. For anyone keen to get going with the ESP8266 Huzzah module it is available from a number of places such as <a href="https://www.adafruit.com/product/2471">adafruit</a> (USA) and <a href="https://shop.pimoroni.com/products/adafruit-huzzah-esp8266-breakout">Pimoroni</a> (UK). Any ESP8266 with ESP-12 module should work the same. See lower in the post for EmonESP firmware dev.</p>

<p><img src="https://blog.openenergymonitor.org/images/emontx-esp.png" alt="image" /></p>

<p>There will be another post very soon detailing how to use this module with the EmonTx v3.</p>

<!--more-->

<h2 id="heatpumpenergy-monitor">2. Heatpump/Energy Monitor</h2>

<p>Heatpump / energy monitor through-hole development board, essentially and EmonTx v2 with additional features for interfacing with heat meters and multiple DS18B20 temperature sensors as well as an integrated ESP8266 WIFI module.</p>

<p><img src="https://blog.openenergymonitor.org/images/heatpumpmonitor.png" alt="image" /></p>

<p>The heatpump monitor board currently supports:</p>

<ul>
  <li>3x CT + ACAC Channels</li>
  <li>Elster A100C Irda meter reader (watt hours)</li>
  <li>Pulse Counting</li>
  <li>Supports MBUS heat meters (Kamstrup 402)</li>
  <li>Supports SIKA flow meters</li>
  <li>4x DS18B20 Temperature Sensors</li>
  <li>Miniature solid state relay for heating control (not yet tested)</li>
  <li>ESP8266 Low cost Wifi</li>
  <li>RFM69 option</li>
  <li>Raspberry PI connector option</li>
  <li>A Through-hole ESP Wifi development platform</li>
  <li>Fits in the EmonTx V3 Aluminum case</li>
</ul>

<p>Guide cost ~£50 (ex VAT) for full heatpump monitor kit with case, ~£30 (ex VAT) for cut down WIFI energy monitor only kit without case.. To be finalised.</p>

<p><a href="https://github.com/openenergymonitor/HeatpumpMonitor">See Heatpump monitor development repo</a></p>

<h2 id="esp8266-based-wifi-pixel-energy-display">3. ESP8266 based WIFI Pixel Energy Display,</h2>

<p>This is an idea thanks to David Hunninsett (<a href="http://twitter.com/m0untainpenguin">@m0untainpenguin</a>) with hardware being developed by <a href="https://github.com/Protoneer/WifiPixels">Protoneer</a>. It fits into a project we are more recently part of here in North Wales called <a href="http://www.energylocal.co.uk/cydynni/">CydYnni by EnergyLocal</a> where 100 households within the boundary of the substation get cheap electricity when a local community hydro is running. David Hunninsett is one of the households on the project and he is keen to have a display that shows when it’s a good time to use electricity among other uses. The wifi pixel could become a nice platform for a ambient home energy indicator.</p>

<p><img src="https://blog.openenergymonitor.org/images/wifi-pixel1.jpg" alt="image" /></p>

<p><img src="https://blog.openenergymonitor.org/images/wifi-pixel2.jpg" alt="image" /></p>

<p><a href="http://community.openenergymonitor.org/uploads/default/original/1X/c72e375230597049c0d8a9e06645a8d088d70774.mp4">See video</a></p>

<p><a href="https://github.com/davehun/mqtt-wifi-pixel">See software development  repo on</a></p>

<h1 id="emonesp-easier-setup-and-installation">EmonESP, easier setup and installation</h1>

<p>One of the really nice things about using the ESP module is that it can really simplify setup for installations that only need to post to a remote emoncms server. The wifi module starts by broadcasting a hotspot that you connect to directly, you can then scan for wifi networks, select the network, get the ip address of the monitor on the network (which saves using fing or accessing your router device list), enter your emoncms.org apikey to connect to an emoncms.org account (to be replaced with username and passowrd login + ability to register and link the monitor to a emoncms account in one step).</p>

<p><img src="https://blog.openenergymonitor.org/images/emonesp.jpg" alt="image" /></p>

<p>We plan to extend EmonESP to also support MQTT.</p>

<p>The EmonESP software is based on work by Chris Howel of <a href="http://www.openevse.com">OpenEVSE</a> which is a really nice open hardware electric vehicle charging station, it’s been really nice to find a common development like this that can be beneficial to two open hardware and software projects. OpenEVSE <a href="https://data.openevse.com/">already use Emoncms</a> for logging and graphing.</p>

<p><a href="https://github.com/openenergymonitor/emonesp">EmonESP firmware developments can be found on github</a></p>

<h2 id="over-the-air-firmware-upload">Over the air firmware upload</h2>

<p>Glyn has been doing a lot of work on how we can do over the air updates to ESP8266 based units. Being able to do this will make it a lot easier to maintain and keep the firmware on these updated especially as the software goes through the larger number of iterations in initial development. Check out his blog posts here to follow the development:</p>

<ul>
  <li><a href="https://blog.openenergymonitor.org/2016/06/platformio/">Part 1/3: PlatformIO open-source embedded development ecosystem</a></li>
  <li><a href="https://blog.openenergymonitor.org/2016/06/auto-build-continuous-test-firmware">Part 2/3: Firmware Continuous Test &amp; Build</a></li>
  <li>3/3: Continuous Deployment (OTA to ESP8266) <em>…In the making!</em></li>
</ul>

<h2 id="forum-discussion">Forum discussion</h2>

<p>See <a href="https://community.openenergymonitor.org/t/esp8266-wifi-developments/784">this forum topic</a> for discussion.</p>

<hr />
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Part 2/3: Firmware Continuous Test & Build]]></title>
    <link href="https://blog.openenergymonitor.org/2016/06/auto-build-continuous-test-firmware/"/>
    <updated>2016-06-14T10:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/06/auto-build-continuous-test-firmware</id>
    <content type="html"><![CDATA[<p><strong>This post is part of a series</strong></p>

<ul>
  <li><a href="https://blog.openenergymonitor.org/2016/06/platformio/">1/3 PlatfomIO overview &amp; compiling + uploading locally and on a Raspberry Pi</a></li>
  <li><strong>2/3: Continuous testing and auto release binary generation using PlatformIO &amp; TravisCI</strong></li>
  <li><a href="https://blog.openenergymonitor.org/2016/06/esp8266-ota-update/">3/3: Continuous Deployment (OTA to ESP8266)</a></li>
</ul>

<hr />

<p>Following on from the <a href="https://blog.openenergymonitor.org/2016/06/platformio/">last blog post</a> on using <a href="https://blog.openenergymonitor.org/2016/06/platformio/">PlatformIO</a> to compile and upload firmware locally, we’re now going to take things a step further and do the same but in <em>The Cloud</em>!</p>

<p><em>Groan…I know I just used the clichéd ‘C’ word, however there are many advantages to compiling and testing the code in the cloud. At least I didn’t mention ‘IoT’…whoops, just doing my bit for SEO!</em></p>

<p>In this instance when we say <em>‘compile in the cloud’</em> I mean use GitHub, <a href="https://travis-ci.org">Travis IO</a> and <a href="https://platformio.org">PlatfromIO</a> to compile the firmware and if the branch is tagged with a ‘Git Release’ auto-generate a compiled binary and upload it back to GitHub release page.</p>

<p>The motivation behind this automated-build and testing is working towards creating a robust infrastructure to push OTA updates to ESP8266 connected nodes (<a href="https://github.com/openenergymonitor/EmonESP">EmonESP dev</a>) inspired by <a href="http://blog.squix.org/2016/06/esp8266-continuous-delivery-pipeline-push-to-production.html">this blog post</a> by Daniel Eichhorn (<a href="https://twitter.com/squix78">@squix78</a>).</p>

<!--more-->

<p>The advantages of <a href="https://en.wikipedia.org/wiki/Continuous_testing">continuous testing</a> have been long established in the software industry. The test we are performing is <em>‘does this firmware compile?’</em>; obviously this is not a comprehensive test but it will at least give us confidence that there are no syntax errors etc. To actually test operation of embedded firmware, physical hardware (or simulation) would be required.</p>

<h2 id="how-it-works">How it works</h2>

<ul>
  <li>A commit or pull request is made to the firmware repository on GitHub
    <ul>
      <li><em>To date emonPi, emonTx and EmonESP repositories have been enabled for continuous build &amp; test</em></li>
    </ul>
  </li>
  <li>
    <p>This triggers Travis CI to start a ‘build’</p>
  </li>
  <li>Code compilation is generated using platformIO in the same way as when compiling locally, <a href="https://blog.openenergymonitor.org/2016/06/platformio/">See blog post</a>. The <a href="https://github.com/openenergymonitor/emonpi/blob/master/.travis.yml"><code class="highlighter-rouge">.travis.yml</code> file in the repo</a> configures the Travis CI build using platformIO:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>language: python
python:
- '2.7'
sudo: false
cache:
  directories:
  - "~/.platformio"
install:
- pip install -U platformio
script:
- platformio run -d firmware -e emonpi_deploy
deploy:
  on:
    repo: openenergymonitor/emonpi
    all_branches: true
    condition: $TRAVIS_TAG =~ ^[0-9]+\.[0-9]+\.[0-9]+$
  skip_cleanup: true
  provider: releases
  overwrite: true
  api_key:
    secure: OzNwxsQEVlSj2e4sOqKNYlNXqPqc5myL0nOBtY1FYD+sbxslHMixmlRASWuFMCjHdpFYQST2IuR3UMCPCjfPzMDVCVtsJ8VPd299fgDGzmEnL3P5Z8wCAv1CfHURcfXzFJDM7prevGx9cfz8uAiwIaNOhbTL7kL2GfSatV5PERzr2ytVh6WUj650Rd7bLKKhj8YHOzO9wOBoKDadYDFF99XYQbDDoHj9pAv+OPG76X0kWrdrq/0w26jh7JZaxrwhF/xD7maGaEjLOa/FcXbyZlVy/JIFjyrKp79swzVNSFNox/CbF7e6tzBf3NhZsoQyEchnCrgWw8IB7j/Ja7Ypetn6IG7C5rT/h46rWrZshbVdw7ZBUzhNJIUVLHFBy7hi2hxMw9Bn+oCt0UWLt8SnQnRfAbjw+z3XQ2/6MccUAINKGDqd4fm9M85sN6drpXySeJ/ZyRkdlUN0xsDpARI05mYLLlCutRzlSCkglbsKJr5XM7h7pXHLUQY5dfw9LrA788w25OBoO9U8vCKtoV8UCXWh6og/364CRl9Uih958f1t7kHIvfwLJjwSDFYVxUsyvSFyjfY+pIfuGEXtgIqMZ87nK3O1vAb9udbPErp0q5kJBeks9Df6wVsvjI7O++7YwiSuWlJBD0x45ZV9pxOFLnWb1hetHpPH5kFgBlTDqsY=
  file: "firmware/.pioenvs/emonpi_deploy/firmware.hex"
</code></pre>
</div>

<ul>
  <li>If the build fails for whatever reason (syntax error, library error etc) then the green <code class="highlighter-rouge">build passing</code> icon changes to a ominous red <code class="highlighter-rouge">build Failed</code> and we get an alert email. For a full build log example see the <a href="https://travis-ci.org/openenergymonitor/emonpi">emonPi Travis CI build page</a>.</li>
</ul>

<p><a href="https://travis-ci.org/openenergymonitor/emonpi"><img src="https://travis-ci.org/openenergymonitor/emonpi.svg?branch=master" alt="Build Status" /></a></p>

<ul>
  <li>If the GitHub branch is tagged with a ‘release tag’ and compilation is successful then the generated <code class="highlighter-rouge">.hex</code> or <code class="highlighter-rouge">.bin</code> is uploaded to the GitHub release page:</li>
</ul>

<p><img src="https://blog.openenergymonitor.org/images/emonpi-draft-release.png" alt="image" /></p>

<p><img src="https://blog.openenergymonitor.org/images/emonpi-travis-release.png" alt="image" /></p>

<p>For a detailed explanation of how the release binary is generated and deployed see Daniel Eichhorn’s (<a href="https://twitter.com/squix78">@squix78</a>) <a href="http://blog.squix.org/2016/06/esp8266-continuous-delivery-pipeline-push-to-production.html">excellent blog post</a>.</p>

<hr />

<p>Stay tuned for part 3/3 of the PlatformIO firmware work-flow post series, which will cover auto deploying (OTA) the compiled firmware release onto an ESP8266. For a sneak peak checkout <a href="http://blog.squix.org/2016/06/esp8266-continuous-delivery-pipeline-push-to-production.html">this excellent blog post</a> which was a source of inspiration and information.</p>

<hr />
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Part 1/3: PlatformIO open-source embedded development ecosystem]]></title>
    <link href="https://blog.openenergymonitor.org/2016/06/platformio/"/>
    <updated>2016-06-12T10:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/06/platformio</id>
    <content type="html"><![CDATA[<p><strong>This post is part of a series:</strong></p>

<ul>
  <li><strong>1/3: PlatfomIO overview &amp; compiling + uploading locally and on a Raspberry Pi</strong></li>
  <li><a href="https://blog.openenergymonitor.org/2016/06/auto-build-continuous-test-firmware/">2/3: Continuous testing and auto release binary generation using PlatformIO &amp; TravisCI</a>
    <ul>
      <li>Related post: <a href="https://blog.openenergymonitor.org/2016/06/esp8266-emonesp-developments/">EmonESP ESP8266 WiFi developments</a></li>
    </ul>
  </li>
  <li><a href="https://blog.openenergymonitor.org/2016/06/esp8266-ota-update/">3/3: Continuous Deployment (OTA to ESP8266)</a></li>
</ul>

<hr />

<p>Getting an Arduino based project (or other embedded platform) to compile and upload can be a pain. Making sure all the libraries are installed in the correct locations and are the correct versions can be tricky and time-consuming.</p>

<p>I’m sure many developers will agree that the tools we use for embedded development are generally not as good as those used for web application development.</p>

<p>The Arduino team have done a good job with their IDE to try and make the embedded development tool-chain setup as easy as possible. However, I still find library management a cause of frustration. Especially since I move between computers and OS’s frequently.</p>

<p>Recently I have been using <a href="http://platformio.org">PlatformIO</a> and am rather impressed with the ease of setup, speed of compilation, uploading (auto port detection), and most importantly an excellent <a href="http://platformio.org/lib">library manager</a>.</p>

<blockquote>
  <p>PlatformIO is an open-source ecosystem for IoT development.</p>
</blockquote>

<blockquote>
  <p>Cross-platform build system, IDE integration and continuous testing. Arduino, Espressif, ARM and mbed compatible.</p>
</blockquote>

<p><img src="https://blog.openenergymonitor.org/images/pio-ide.png" alt="PlatformIO IDE" /></p>

<!--more-->

<p>Here are some things that have impressed me about PlatformIO (pio) after using it for a couple of weeks:</p>

<ul>
  <li><a href="https://github.com/platformio"><strong>Fully open-source</strong></a> with active and friendly dev community.</li>
  <li><strong>Easy to install</strong> - Pure python based, installed using pip
    <ul>
      <li>Tool-chains are auto installed on first compile / upload e.g.
        <ul>
          <li>If trying to upload to Arduino avrdude will automatically be installed</li>
          <li>If trying to compile an ESP8266 project the ESP toolchain will be installed</li>
        </ul>
      </li>
      <li>Cross-platform (Linux, Windows and mac all work the same), this will make support much easier</li>
    </ul>
  </li>
  <li><strong>Supports all the main embedded platforms</strong>
    <ul>
      <li>atmelavr (Arduino), espressif (ESP8266), ststm32 (ARM etc.)</li>
    </ul>
  </li>
  <li><strong>Command line and IDE</strong>
    <ul>
      <li>At work I use pio via Atom IDE on Ubuntu</li>
      <li>At home, I use a Chromebook with Caret IDE and interact with pio via command-line</li>
      <li>When developing directly on an emonPi / RaspberryPi pio command-line works great - <em>Yes, that’s right pio works on a RaspberryPi to compile and upload code directly!</em></li>
    </ul>
  </li>
  <li><a href="http://platformio.org/lib"><strong>Excellent library manager</strong></a>
    <ul>
      <li>Libraries can be searched and reviewed using command-line or web 2.0 manager</li>
      <li>Required libraries can be specified in the <code class="highlighter-rouge">platformio.ini</code> file and if not present install is prompted upon compilation</li>
      <li>Specific library version (as defined in <code class="highlighter-rouge">library.json</code> <a href="https://github.com/openenergymonitor/EmonLib/blob/master/library.json">(emonLib example)</a>) or git commit SHA</li>
    </ul>
  </li>
  <li><strong>Fast compilation &amp; pain-free uploading</strong>
    <ul>
      <li>PlatformIO’s compiler is the <a href="https://twitter.com/krzychb2/status/729294573760065536">fastest in the business</a></li>
      <li>USB / Serial ports auto detected</li>
      <li>Since the emonPi has been added as a custom board PlatformIO can even upload direct to emonPi via RaspberryPi GPIO and trigger GPIO AVR reset, not more <a href="https://github.com/openenergymonitor/avrdude-rpi">hacked avrdude</a>.</li>
    </ul>
  </li>
  <li><strong>Easy integration with continuous testing &amp; deployment</strong>
    <ul>
      <li>Integration with TravisCI to enable compilation, code testing and binary (.hex / .bin) release generation in the cloud.</li>
      <li><a href="http://github.com/openenergymonitor/emonpi/">emonPi</a> and <a href="github.com/openenergymonitor/emonTxFirmware">emonTx</a> git repos are now enabled for continous-testing and auto binary generation on release tag…this is a step change in embedded development.</li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="example-compiling-emontx--emonpi-firmware">Example: Compiling emonTx / emonPi firmware</h2>

<p><a href="http://docs.platformio.org/en/latest/quickstart.html">PlatformIO has some excellent quick start docs</a> to cover setting up your first ‘blinky’ project, therefore I will not duplicate here. In this example I focus on setting up pio and compiling emonTx / emonPi firmware. This example assumes a totally bare metal machine with nothing installed except python (2.7 recommended). Pio works great on a Raspberry Pi.</p>

<p>This guide used command-line steps on Linux, if using Windows or if you want to use the platformio IDE see <a href="http://platformio.org/get-started">PlatformIO Getting Started Page</a>.</p>

<p>The PlatformIO IDE or Atom IDE is excellent and very easy to use (self explanatory). This guide uses pio via command line as this gives a more hands-on experience to how pio is working.</p>

<h3 id="install-platformio">1. Install PlatformIO</h3>

<p>The easiest way if running Linux is to use the install script, this installs pio via python pip and installs pip if not present. See <a href="http://docs.platformio.org/en/latest/installation.html#installer-script">PlatformIO installation docs</a>:</p>

<p><code class="highlighter-rouge">$ sudo python -c "$(curl -fsSL https://raw.githubusercontent.com/platformio/platformio/master/scripts/get-platformio.py)"</code></p>

<h3 id="clone-emontx--emonpi-repo">2. Clone emonTx / emonPi repo</h3>

<p>We’ll use the emonTx (V3 discrete sampling) as an example here but the steps are exactly the same for emonPi.</p>

<p><strong>emonTx V3</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ git clone https://github.com/openenergymonitor/emonTxFirmware`
$ cd emonTxFirmware/emonTxV3/RFM/emonTxV3.4/emonTxV3_4_DiscreteSampling
</code></pre>
</div>

<p><strong>emonPi</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ git clone https://github.com/openenergymonitor/emonpi`
cd emonpi/firmware
</code></pre>
</div>

<h3 id="compile-with-platformio">3. Compile with PlatformIO</h3>

<p><code class="highlighter-rouge">$ platformio run</code></p>

<p>or shorthand for the lazy</p>

<p><code class="highlighter-rouge">$ pio run</code></p>

<p><strong>That’s it!</strong> That’s all that’s needed to setup pio from scratch and compile emonTx firmware :-D</p>

<p>The first time platformIO is run it will ask to install the required libraries (versions specified) and AVR toolchain. The required libraries are defined in <a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM/emonTxV3.4/emonTxV3_4_DiscreteSampling/platformio.ini"><code class="highlighter-rouge">platformio.ini</code> in the emonTx discrete sampling firmware folder</a>:</p>

<p>e.g.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>lib_deps_external =
  DHT sensor library @1.2.3
  DallasTemperature @3.7.7
  EmonLib
  JeeLib@c057b5f4c0
  LiquidCrystal_I2C @4bb48bd648
</code></pre>
</div>

<p>The latest version of the libraries are automatically cloned from their native git repos into the <code class="highlighter-rouge">~/platformio</code> folder.</p>

<p>If required specific versions can be installed e.g.:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ pio lib install 252 --version="e70c9d9f4e"
$ platformio lib install 54 --version="3.7.7"
</code></pre>
</div>

<h3 id="upload-using-platformio">3. Upload using PlatformIO</h3>

<h4 id="a-via-usb-to-uart-programmer-to-emontx">3a. Via USB to UART programmer to emonTx</h4>

<p><code class="highlighter-rouge">$ sudo platformio run --target upload</code></p>

<p>or lazy shorthand</p>

<p><code class="highlighter-rouge">$ sudo pio run -t upload</code></p>

<p>Pio will attempt to auto detect the USB programmer and upload :-)</p>

<p><em>Note: you will need <code class="highlighter-rouge">sudo</code> unless you have correctly <a href="https://github.com/platformio/platformio/blob/develop/scripts/99-platformio-udev.rules">configured udev rules</a>.</em></p>

<p>To list available serial ports:</p>

<p><code class="highlighter-rouge">$ pio serialports list</code></p>

<p>There is even a built in serial monitor</p>

<p><code class="highlighter-rouge">$ pio serialports monitor</code></p>

<h3 id="b-using-ttyama0-gpio-to-upload-direct-to-emonpi">3b. Using ttyAMA0 GPIO to upload direct to emonPi</h3>

<p>This is where things get very exciting, pio can compile the code directly on a Raspberry Pi. The latest version of pio (<del>due to be released in the next few weeks</del>, <a href="https://community.platformio.org/t/platformio-cli-2-10-0/381">released 2.10.0</a>) will have built in support for the emonPi auto-reset on upload using GPIO4. See <a href="http://platformio.org/boards?count=1000&amp;filter%5Bname%5D=emonpi&amp;page=1&amp;sorting%5Bvendor%5D=asc">emonPi listed on PlatformIO boards page</a>:</p>

<p><img src="https://blog.openenergymonitor.org/images/emonpi-platformio.png" alt="emonpi-platformio.png" /></p>

<p>The emonPi board is defined in <code class="highlighter-rouge">platformio.ini</code> in the <a href="https://github.com/openenergymonitor/emonpi/blob/master/firmware/platformio.ini">emonpi/firmware folder</a>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>board = emonpi
upload_port = /dev/ttyAMA0
</code></pre>
</div>

<p>All that is needed to compile and upload directly on the emonPi is:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cd ~/emonpi/firmware
$ sudo service emonhub stop
$ sudo pio run -t upload
$ sudo service emonhub start
</code></pre>
</div>

<p><em>Thanks a lot to <a href="https://github.com/ivankravets">Ivan Kravets</a> for helping integrate emonPi into the PlatfomIO ecosystem. <a href="https://github.com/platformio/platformio/commit/c5b5e80de4928cf91be59e675429b520e31d873a">View commit changes</a></em></p>

<hr />
<p>Stay tuned for part 2/3 of the PlatformIO post series which will cover setting up firmware continuous testing using Travis CI and auto compiled binary generation on release tag directly on github. This is currently live on the emonPi &amp; emonTx repos if you want a sneak preview. See <a href="https://github.com/openenergymonitor/emonpi/blob/master/.travis.yml">travis.yaml</a> file and Travis build status icon on the main emonpi repo <a href="https://github.com/openenergymonitor/emonpi/blob/master/README.md">Readme.md</a>.</p>

<hr />
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Electrical Supply Line Fault]]></title>
    <link href="https://blog.openenergymonitor.org/2016/06/emonpi-vrms-line-fault/"/>
    <updated>2016-06-03T10:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/06/emonpi-vrms-line-fault</id>
    <content type="html"><![CDATA[<p>Last week my home emonPi energy monitor came in handy to help diagnose an electrical supply fault.</p>

<p>A neighbour alerted me that her lights were flickering and internet router was dropping offline. At the time I was doing some DIY and had noticed the power drill I was using change speed erratically. I had presumed it was my drill about the give up the ghost.</p>

<p>I checked the Emoncms graph on my emonPi energy monitor and noticed that VRMS was well out of spec at about 150V (we usually get 230V*) and occasionally jumping up to almost 300V! The electrical company was alerted and the fault was traced back to a frayed conductor on our street. I helped the electrical contractors view the real-time VRMS value to confirm the fault was fixed.</p>

<p><img src="https://blog.openenergymonitor.org/images/vrms.png" alt="VRMS Fault" /></p>

<!--more-->

<h2 id="notes-on-mains-voltage-limits">* Notes on Mains Voltage Limits</h2>

<p>The standard domestic mains supply for Europe is 230 V ± 10%, giving a lower limit of 207 V and an upper limit of 253 V. It is permissible under BS 7671 to have a voltage drop within the installation of 5%, which would give a lower limit of 195.5 V.
The UK standard prior to harmonization was 240 V ± 6%, giving an upper limit of 254.4 V.</p>

<p>Although the UK nominal standard is now 230 V, the supply system has not generally been adjusted, and the voltage centers around 240 V.</p>

<p>Thanks to Robert Wall for summarizing the rather convoluted standards surrounding UK grid voltages.</p>

<p>All of Europe, Africa, Asia, Australia, New Zealand and most of South America, use a supply that is within 6% of 230 V</p>

<p><a href="https://en.wikipedia.org/wiki/Mains_electricity_by_country">Mains Electricity by Country (Wikipedia)</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Substantial update to emonPi / emonBase: emonSD-03-May16 pre-built image release]]></title>
    <link href="https://blog.openenergymonitor.org/2016/05/emonsd-update-03may16/"/>
    <updated>2016-05-20T10:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/05/emonsd-update-03may16</id>
    <content type="html"><![CDATA[<p>This latest update to emonSD the pre-built SD card image for the emonPi/emonBase significantly enhances the out-the-box functionality of the emonPi by integrating applications such as nodeRED, openHAB and improved MQTT support.</p>

<blockquote>
  <p>The emonPi in its default configuration works great using Emoncms for data logging and visualisation. However there may be times when more flexibility and the ability to interface with other hardware or services is desirable.</p>
</blockquote>

<p>The emonPi with this latest software update is perfectly positioned to become the heart of a smart home automation system. The ‘always-on’ requirement of energy monitoring and the processing power of the Raspberry Pi makes it a fantastic customisable home-hub. See <em>Related Blog Posts</em> at the bottom of this post for inspiration as to what can be achieved.</p>

<hr />

<p>For the past few years we have made available a pre-built SD card image for the RaspberryPi. Since launching the emonPi last year the pre-built image has been developed extensively. We have now given it a name: <strong>emonSD</strong>.</p>

<p>The latest update to emonSD (<strong><a href="https://github.com/openenergymonitor/emonpi/wiki/emonSD-pre-built-SD-card-Download-&amp;-Change-Log#emonsd-03may16--release">emonSD-03May16</a></strong>) now incudes the following all setup and pre-configured:</p>

<ul>
  <li><a href="https://github.com/emoncms/emoncms">Emoncms V9</a></li>
  <li><a href="https://guide.openenergymonitor.org/integrations/nodered">nodeRED</a></li>
  <li><a href="https://guide.openenergymonitor.org/integrations/openhab">openHAB</a></li>
  <li><a href="https://guide.openenergymonitor.org/technical/mqtt">MQTT</a></li>
  <li><a href="https://guide.openenergymonitor.org/integrations/lightwaverf/">Support for MQTT LightWaveRF OOK Control</a></li>
  <li><a href="https://guide.openenergymonitor.org/integrations/mqtt-relay/">Support for MQTT WiFi control Relay</a></li>
  <li><a href="https://guide.openenergymonitor.org/setup/connect/#5-connect-via-3g-gsm-optional">GSM 3G USB modem support</a></li>
</ul>

<!--more-->

<ul>
  <li><a href="https://www.raspberrypi.org/downloads/raspbian/">RASPBIAN JESSIE LITE</a> (2015-11-21)</li>
  <li><a href="https://blog.openenergymonitor.org/2016/03/raspberry-pi-3/">Raspberry Pi 3 Suppport</a>
    <ul>
      <li>Including on-board Wifi, external USB Wifi adapter no longer required</li>
    </ul>
  </li>
  <li>low-write optimisations for long SD card life-span</li>
  <li>Root file-system read-only</li>
</ul>

<h3 id="download-latest-emonsd--view-full-change-loghttpsgithubcomopenenergymonitoremonpiwikiemonsd-pre-built-sd-card-download--change-logemonsd-03may16--release"><a href="https://github.com/openenergymonitor/emonpi/wiki/emonSD-pre-built-SD-card-Download-&amp;-Change-Log#emonsd-03may16--release">Download latest emonSD &amp; view full change-log</a></h3>

<p>All emonPi / emonBase’s that have been purchased from our online store from June 2015 - May 2016 have been shipped with the old <a href="https://github.com/openenergymonitor/emonpi/wiki/emonSD-pre-built-SD-card-Download-&amp;-Change-Log#emonsd-17jun15">17June15</a> emonSD. The new emonSD 03May16 will now be included by default (<a href="https://blog.openenergymonitor.org/2016/05/emonpi-raspberrypi3/">together with a Raspberry Pi 3</a>) with all emonPi / emonBase purchases. If you have recently puchased an emonPi and it like the photo (black acrylic fascia) then you have the new emonSD and Raspberry Pi 3inside. The acrylic fascia is required to use the Raspberry Pi 3’s on-board WiFi (<a href="https://blog.openenergymonitor.org/2016/05/emonpi-raspberrypi3/">see blog post</a>):</p>

<p><img src="https://blog.openenergymonitor.org/images/emonpi-raspi3.jpg" alt="emonPi Raspberry Pi 3 Acrylic Fascia" /></p>

<p>Existing users can download the new emonSD from the link above and flash to a spare SD card and then use the <a href="https://guide.openenergymonitor.org/setup/import/">Emoncms backup / import</a> tool to migrate local Emoncms data.</p>

<p><strong>We would highly recommend all users that are interested in having the latest features and future update to update to this new emonSD image. The June15 image will not receive any Emoncms updates.</strong></p>

<p>However if your emonPi is currently stable and is working as indented then don’t feel that upgrading is essential, <em>“If it ain’t broke, don’t f ix it!”</em>.</p>

<h2 id="thank-you-feedback--support">Thank you, Feedback &amp; Support</h2>

<p>Releasing this pre-built image update is a significant milestone for us. It’s been the main focus of my work since November lasat year. Thanks a lot to all the community members who helped with testing the dev and release candidates version of the image and provided excellent feedback and contributions. See the <a href="https://github.com/openenergymonitor/emonpi/wiki/emonSD-pre-built-SD-card-Download-&amp;-Change-Log">emonSD download repository wiki</a> for links to forum discussion thread.</p>

<p>To give feedback or obtain support for the new image please post in the <a href="https://community.openenergymonitor.org/c/emonsd">emonSD forum</a>.</p>

<hr />

<h2 id="documentation">Documentation</h2>

<p>As <a href="2016/05/website-changes/">previously mentioned on the blog</a> a couple of weeks ago we have launched a new User Guide website, the launch of this Guide has coincide with the launch of the new emonSD. The User Guide is designed to be the goto location for everything a user needs to know to setup, use and configure an OpenEnergyMonitor system:</p>

<h3 id="httpsguideopenenergymonitororghttpsguideopenenergymonitororg"><a href="https://guide.openenergymonitor.org">https://guide.openenergymonitor.org</a></h3>

<h2 id="related-blog-posts">Related Blog posts</h2>

<h3 id="nodered">nodeRED</h3>

<ul>
  <li><a href="https://blog.openenergymonitor.org/categories/nodered/">Node-RED blog post tag</a></li>
  <li><a href="https://blog.openenergymonitor.org/2015/10/emonpi-nodered-and-mqtt/">emonPi, NodeRed and MQTT</a></li>
  <li><a href="http://2.bp.blogspot.com/-wVqIG0KV_8k/VkPM0XAJCYI/AAAAAAABi1c/EoNQ2OvDVvs/s1600/emoncms_nodered_node.png">Node-RED Emoncms Node</a></li>
  <li><a href="https://blog.openenergymonitor.org/2016/02/outdoor-temperature-data-from-weather/">Outdoor Temperature Data from Weather Underground to Emoncms &amp; MQTT</a></li>
  <li><a href="https://blog.openenergymonitor.org/2015/11/ambient-wind-energy-indicator-using/">Ambient Wind Energy Indicator using Node-RED and Blink(1) USB</a></li>
</ul>

<h3 id="openhab">openHAB</h3>

<ul>
  <li><a href="https://blog.openenergymonitor.org/2015/12/openenergymonitor-emonpi-and-openhab/">OpenEnergyMonitor, emonPi and openHAB</a></li>
</ul>

<h3 id="lightwave-rf">LightWave RF</h3>

<ul>
  <li><a href="https://blog.openenergymonitor.org/2015/11/remote-control-of-lightwave-rf-plugs/">Controling LightWaveRF plugs using emonPi</a></li>
</ul>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[emonPi / emonBase Raspberry Pi 3]]></title>
    <link href="https://blog.openenergymonitor.org/2016/05/emonpi-raspberrypi3/"/>
    <updated>2016-05-13T15:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/05/emonpi-raspberrypi3</id>
    <content type="html"><![CDATA[<p>All emonPi’s / emonBase’s shipped to date have included a Raspberry Pi 2. In the next week or so we will be upgrading to include a RaspberryPi 3. This is a nice upgrade: approximately double the processor speed and on-board WiFi with zero cost increase.</p>

<p>Since the RaspberryPi 3 has got on-board WiFi a USB WiFi dongle is not required; even more costing cost saving for our customers, thanks to hard work of the Raspberry Pi foundation and a bit of <a href="https://en.wikipedia.org/wiki/Moore%27s_law">Moore’s law</a>.</p>

<p><img src="https://blog.openenergymonitor.org/images/emonpi-raspi3.jpg" alt="emonPi Raspberry Pi 3 Acrylic Fascia" /></p>

<!--more-->

<p>If you receive an emonPi with a black acrylic fascia like in the photo above this means you have a RaspberryPi 3 inside. The reason for switching from punched-aluminium end-plates to black acrylic plastic is to allow the RaspberryPi 3’s on-board Wifi to propagate out of the enclosure.</p>

<p>The Raspberry Pi 3 equipped emonPi’s and emonBase’s will be running the latest <a href="https://guide.openenergymonitor.org/technical/#software-overview">emonSD pre-built SD card image</a> which includes the latest version of Emoncms as well as <a href="https://guide.openenergymonitor.org/integrations/nodered">NodeRED</a> and <a href="https://guide.openenergymonitor.org/integrations/openhab">openHAB</a> pre-installed. Checkout our <a href="https://guide.openenergymonitor.org/">new Setup &amp; User Guide</a>.</p>

<p><em>Note: The Raspberry Pi 3 also includes integrated on-board Bluetooth, however this has been disabled on the emonPi due to a serial port conflict. See our <a href="https://blog.openenergymonitor.org/2016/03/raspberry-pi-3/">original post on the Raspberry Pi 3</a>.</em></p>

<hr />

<h2 id="emonpi-online-store-itemhttpsshopopenenergymonitorcomemonpi-3"><a href="https://shop.openenergymonitor.com/emonpi-3/">emonPi Online Store Item</a></h2>

<h2 id="emonbase-online-store-itemhttpsshopopenenergymonitorcomemonbase-web-connected-base-station"><a href="https://shop.openenergymonitor.com/emonbase-web-connected-base-station/">emonBase Online Store Item</a></h2>

<h2 id="getting-start-guide-httpsguideopenenergymonitororg"><a href="https://guide.openenergymonitor.org/">Getting Start Guide </a></h2>

<p><img src="https://blog.openenergymonitor.org/images/raspberrypi3.jpg" alt="Raspberry Pi 3" /></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Emoncms android App QR Code Scanner Setup]]></title>
    <link href="https://blog.openenergymonitor.org/2016/05/emoncms-qr/"/>
    <updated>2016-05-11T15:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/05/emoncms-qr</id>
    <content type="html"><![CDATA[<p>I would like to highlight a nice improvement to Emoncms and the Emoncms android app that has been contributed by community memebers <a href="https://community.openenergymonitor.org/users/jumpmaster/activity">@jumpmaster</a> and <a href="https://community.openenergymonitor.org/users/andy_taylor/activity">@andy_taylor</a>. See <a href="https://community.openenergymonitor.org/t/mobile-app-qr-code/149">development forum thread</a> on our <a href="https://blog.openenergymonitor.org/2016/05/website-changes/">shiny new forums</a>.</p>

<p>Emoncms MyAccount page now displays a QR code and a couple of handy ‘Copy to Clipboard’ buttons for the API keys:</p>

<p><img src="https://blog.openenergymonitor.org/images/emoncms-qr.png" alt="Emoncms QR code generator" /></p>

<!--more-->

<p><em>This updated has been merged into the stable Emoncms branch V9.6. If your running an emonPi/emonBase jsut hit update to pull in the changes. The update will appear on Emoncms.org in the next few days.</em></p>

<p>This QR code contains the Emoncms URL and read-API key to automate setting up the <a href="https://play.google.com/store/apps/details?id=org.emoncms.myapps&amp;hl=en_GB">Emoncms android app</a>. The update for the app to support the QR code scanner has been pushed to Googe Play. After the update just can the QR code to setup the app.</p>

<p><img src="https://blog.openenergymonitor.org/images/android-qr.png" width="300" /></p>

<p>If your feeds are named <strong>use</strong> and <strong>use_kwh</strong> the app will automatically select use these feeds as the Power and kWh feeds.</p>

<p>Any issues, please post on the <a href="https://community.openenergymonitor.org/t/mobile-app-qr-code/149">development forum thread</a>.</p>

<p>Thanks again to everyone involved in the development and testing. It’s been great working with an enthusiastic development community over on the new forums. Onwards and upwards :-)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[New Forum, Blog and User Guide Website]]></title>
    <link href="https://blog.openenergymonitor.org/2016/05/website-changes/"/>
    <updated>2016-05-03T15:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/05/website-changes</id>
    <content type="html"><![CDATA[<p>We have been busy for the past couple of months building some new websites to improve OpenEnergyMonitor.</p>

<p>Introducing a shiny new:</p>

<ol>
  <li>Community Forum</li>
  <li>User Guide website</li>
  <li>Blog</li>
</ol>

<p><strong>Later this week on Thursday 5th May 2016 the old forums will be frozen and we will be moving to the new community forums</strong></p>

<!--more-->

<h2 id="new-community-forum">1. New Community Forum</h2>

<p><img src="https://blog.openenergymonitor.org/images/Selection_037.png" alt="image" /><img src="https://blog.openenergymonitor.org/images/Selection_038.png" alt="image" /></p>

<h4 id="httpscommunityopenenergymonitororghttpscommunityopenenergymonitororg"><a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></h4>

<p>The current <a href="http://openenergymonitor.org/emon/forum">OpenEnergyMonitor Forums</a> have been running (since 2010) on Drupal 6. As of February 2016 Drupal 6 reached EOL. This does not mean that the site will stop working, however, it does mean we have decided the time has come to upgrade the highest traffic and most interacted-with part of the site &gt; The Community Forums.</p>

<p>Later this week <strong>on Thursday 5th May 2016 the old forum will be frozen</strong> and we will be moving to the new forum powered by <a href="https://www.discourse.org/">Discourse</a> open-source forum platform hosted and managed us (OpenEnergyMonitor) on our servers.</p>

<p>You will need to create an account on the new forum. You should receive an email soon inviting you to the new forum, if you join via the link in the email you will receive elevated privileges on the new forum since you have already proved yourself as a trusted user.</p>

<p>Thanks a lot to the team of community volunteers who have prepare the new forum over the past few weeks.</p>

<h2 id="new-user-guide">2. New User Guide</h2>

<p><img src="https://blog.openenergymonitor.org/images/Selection_036.png" alt="image" /></p>

<h4 id="httpsguideopenenergymonitororghttpsguideopenenergymonitororg"><a href="https://guide.openenergymonitor.org">https://guide.openenergymonitor.org</a></h4>

<p><a href="https://openenergymonitor.org/emon/">OpenEnergyMonitor.org</a> contains has a wealth of information (specifically the <a href="http://openenergymonitor.org/emon/buildingblocks">Building Blocks</a> resources section), however a common issue raised by new users is they feel lost swimming in a sea of information. The user guide has been created to provide just the right amount of information to setup and configure and OpenEnergyMonitor system. The guide is focused on the emonPi but will also cover emonBase (Raspberry Pi + RFM69Pi), emonTx and emonTH.</p>

<p>The launch of the Guide site coincides with the launch of the new emonSD Raspberry Pi emonPi / emonBase pre built image which includes the latest version of Emoncms as well as MQTT, nodeRED, openHAB and Raspberry Pi 3 support all setup and pre-configured. <a href="https://community.openenergymonitor.org/t/emonsd-03may16-release/145">See forum post</a>. This new emonSD image will be installed as standard with all emonPi/emonBase’s shipped from our store in the next few weeks. <em>We soon be selling the Raspberry Pi 3 as standard with emonPi / emonBase, another blog post on this coming soon..</em></p>

<p>The User Guide site will attempt to create a distinction between ‘user’ documentation and ‘developer’ documentation and discussions. The Guide site has been designed to look and work great on mobile devices. We think this is important since stats indicated that users often follow the setup guide on a mobile or tablet while at the install site (think head stuck inside a meter cabinet!). Going forward we would like to standardise on the following locations for documentation:</p>

<ul>
  <li>User Guide Site - User documentation</li>
  <li>Forums - User support / Developer discussion separated with categories.</li>
  <li>GitHub - Technical documentation</li>
</ul>

<p>The Hardware Wiki will still exist, however expect hardware documentation to move to <a href="https://github.com/openenergymonitor/hardware">GitHub Hardware Repo</a> over time.</p>

<h2 id="new-blog">3. New Blog</h2>

<p><img src="https://blog.openenergymonitor.org/images/Selection_039.png" alt="image" /></p>

<h4 id="httpsblogopenenergymonitororghttpsblogopenenergymonitororg"><a href="https://blog.openenergymonitor.org">https://blog.openenergymonitor.org</a></h4>

<p>We have wanted to move away from our <a href="http://openenergymonitor.blogspot.co.uk/">old Google blogger</a> for a while. During the learning process building the Guide website I realised that using GitHub and Jekyll would also be a good solution for the blog. Thanks to Google export and a nice <a href="https://import.jekyllrb.com/docs/blogger/">Jekyll import script</a> we managed to migrate over the blog without too much difficulty. Please update your RSS subscription to the <a href="http://blog.openenergymonitor.org/feed.xml">new Atom feed.xml</a>.</p>

<h3 id="technical-info">Technical info</h3>

<p>The new Guide and Blog are built using <a href="http://jekyllrb.com/">Jekyll</a> static site generator with Octopress <a href="https://github.com/coogie/oscailte">Oscailte theme</a> to convert markdown files to html. The sites are <a href="https://github.com/openenergymonitor/guide">fully open-source on GitHub </a> and are hosted by GitHub pages. <a href="https://travis-ci.org/openenergymonitor/guide/">Travis CI</a> has been configured to re-build the static html pages each time a change commit is made. Hosting the site on github will make it easy for anyone to propose a change/fix. The site is served and secured via Cloud Flare using CF’s <a href="https://blog.cloudflare.com/cloudflare-ca-encryption-origin/">Universal SSL/TLS to origin</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Part 3: Aggregated supply and demand across multiple households]]></title>
    <link href="https://blog.openenergymonitor.org/2016/05/Part3-Aggregated-supply-and-demand/"/>
    <updated>2016-05-02T15:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/05/Part3-Aggregated-supply-and-demand</id>
    <content type="html"><![CDATA[<p>One of the main problems with looking at demand at the single household level is that demand at this level is very spiky, there are often long periods of low use around 100W and then suddenly a kettle or electric car charger turns on and demand increases by 20-30x in an instant. Solar generation can be very spiky too and so there is room for matching but it can be difficult to get the timing right.</p>

<p>One solution to increasing supply &amp; demand matching at the household level is to have in home battery storage and diversion to hot water stores – but it may not be the best solution for all cases.</p>

<p>Aggregating supply and demand across households provides an example of how the degree of matching can be increased significantly by what could be described as sequential demand. Not everyone boils a kettle at the same time or a cloud passing over one households solar pv system may not be passing over another’s.</p>

<p>In order to explore the extent of increased matching possible through aggregation of supply and demand I have been working with Dominic McCann from Carbon Coop on what could be called a <a href="https://openenergymonitor.org/dev/smartgrid"><strong>‘virtual microgrid’ concept</strong></a>, we have a provisional front page for this here - please note that its still in early development:</p>

<p><img src="https://blog.openenergymonitor.org/images/smart-grid.png" alt="image" /></p>

<!--more-->

<p>With only four households aggregating on-site solar, off-site wind, hydro and consumption and with total supply matching total demand over the whole period achieved by scaling the wind component, we can see matching increasing from 46% in the previous example to around 64% here. The resulting average carbon intensity is 132gCO2/kWh.</p>

<p>At this carbon intensity a heatpump (@ COP 3.0) has a delivered heat carbon intensity of 44gCO2/kWh, 81% less than gas and an EV (@ 3.7 miles/kWh) has a carbon intensity of 22gCO2/km 80% less than a very efficient petrol car doing 60 real world mpg, this compares with a carbon saving of roughly 45% vs direct gas heating and a petrol car if the electricity supply was from a grid supply consisting of gas, coal and nuclear at present UK proportions. Its a bit more complicated than this as more of the co2 was emitted when the EV was charging than at other times, the overall carbon intensity is just an average, Il come back to a more in-depth analysis of this again.</p>

<p>The result goes some way to illustrating why a mixture of renewable generation sources and aggregated demand ultimately increases the usefulness of the renewable supply and reflects the kind of results we see from running hourly zero carbon energy system models such as the one developed by the Center for Alternative Technology. These indicate that matching levels of between 62% and 78% are possible before storage and significant demand shifting with normal electric demand, heatpump heating demand and EV charging demand. See <a href="(https://openenergymonitor.org/energymodel/)">modelled supply/demand matching</a> based on ZeroCarbonBritain data:</p>

<p><a href="https://openenergymonitor.org/dev/smartgrid">Smart grid test intro page</a></p>

<p>Visible currently on the community smart grid test front page is the participating households renewable supply mix, real-time information on grid CO2 intensity and grid wind, solar and hydro. Household demand is not currently shown as there are not enough participants for the demand profile to be sufficiently anonymous.</p>

<p><img src="https://blog.openenergymonitor.org/images/supply.png" alt="image" /></p>

<p>At the top of the page is a UK grid status indicator that is based on Dominic McCann’s work explained in more detail in <a href="http://carbon.coop/blog/zapaman/community-smart-grid-prosumer-perspective-part-2">Dominic’s blog post</a>.</p>

<p><img src="https://blog.openenergymonitor.org/images/smartgrid2.png" alt="image" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Part 2: Exploring carbon intensity and renewable energy matching]]></title>
    <link href="https://blog.openenergymonitor.org/2016/04/Part2-Exploring-carbon-intensity/"/>
    <updated>2016-04-28T15:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/04/Part2-Exploring-carbon-intensity</id>
    <content type="html"><![CDATA[<p><img src="https://blog.openenergymonitor.org/images/winderful.png" alt="image" /></p>

<p>This post describes an approach we have been exploring that uses the MyEnergy emoncms app and work on virtual <a href="https://github.com/TrystanLea/VirtualSmartGrid">smart grids</a> with Dominic McCann from Carbon Coop. There’s a good blog and video on what we’ve been working on over on the <a href="http://carbon.coop/blog/jonathan/smart-grid-aggregation-dashboard-prototype">Carbon Coop blog</a>.</p>

<p>The <a href="https://blog.openenergymonitor.org/2016/04/Understand-CO2-intensity-grid-electricity/">last post</a> described two approaches to grid carbon intensity that consider the UK grid as a whole. This approach explores what the overall household carbon intensity might be when on-site renewable energy is considered such as home solar but also when renewable energy is bought over the grid, this could be from a green electricity tariff.</p>

<p>If imported electricity is supplied from a 100% renewable energy supplier in the UK: a large portion of the supply will likely be wind energy (54% of good energy’s ‘fuel’ mix comes from wind) and the UK has the best wind resource in Europe. Incorporating grid wind data and exploring matching with wind and solar, means we can really start to test scenarios such as ZeroCarbonBritain in the present.</p>

<p>There is real-time data available on UK wind supply and its possible to scale the total UK wind output in order to estimate a household ‘share of UK wind’ in real-time.</p>

<!--more-->

<div class="highlighter-rouge"><pre class="highlight"><code>Calculating a households share of real-time wind output

Between March 2015 and March 2016 the output of UK wind power was on average 2630MW.

If a household buys 54% of 3300 kWh (typical annual household electricity consumption) or about 1800 kWh this converts to an average power of 205 Watts.

The scaling factor to convert total wind power output in MW to a household share is therefore:

scaling factor = 205 W / 2630 MW

The wind power available at any given moment would then be

wind power available = ( 205W / 2630MW ) x uk wind power output (MW)

If total UK wind power is 4000MW the estimated amount available in this example for the household is = (205W/2630MW) x 4000MW = 312 Watts.

Over the year the average available wind power for the household will work out to being 205W but for any given moment it could be more or less than this depending on how much power is being generated at that moment.
</code></pre>
</div>

<p>With data on household demand, onsite solar and a share of UK wind, we then work out how much backup supply is needed and from this an estimate of household CO2 intensity.</p>

<p>The backup CO2 intensity could be a single source such as CCGT gas power or a grid CO2 intensity with the wind power component removed in order to avoid double counting. Using an intensity based on grid: coal, gas, nuclear and interconnectors with the wind component removed may help incentivise use outside of peak periods but as discussed in the last post an extended analysis would be needed to establish what’s best from a carbon perspective.</p>

<p><img src="https://blog.openenergymonitor.org/images/week6.png" alt="image" /></p>

<p><em>Above: Emoncms MyEnergy App showing onsite solar (yellow), share of uk wind estimate (green) and household demand (blue). Available on emoncms.org or self-hosted installations.</em></p>

<p>The average CO2 intensities that result from this approach depend on the degree of matching between household demand and the renewable supply. From our experience so far matching can be anywhere between 40% and 70% depending on the nature of the household demand and how much demand shifting effort is undertaken. The resulting average carbon intensity is directly proportional to the level of matching: 40% matching means we need backup supply to cover 60% of the demand reducing the carbon intensity by 40% compared to grid average or perhaps CCGT gas CO2 intensity.</p>

<p>While far from perfect as no account is taken of what is actually happening on the local network, this approach could be seen as a good middle ground between on the one hand saying that all grid electricity has to be counted at grid average carbon intensity and on the other that all electricity from a green tariff is zero carbon at all times. It provides an incentive for demand shifting to times of high renewable output, while reflecting a substantial carbon reduction benefit that should be available from buying renewable energy across the grid.</p>

<h3 id="excessexported-renewable-energy">Excess/exported renewable energy</h3>
<p>There is an interesting question as to what happens to excess renewable energy not used by the household in this approach. If the energy is exported to the grid and used by others effectively displacing otherwise needed fossil fuel generation then this carbon saving could offset the carbon emissions emitted by the household when backup electricity was used. The result could mean that regardless of the degree of matching achieved between renewable supply and demand, whether on-site solar or wider grid renewable, the household could achieve net zero carbon by generating and equal amount of renewable supply as demand over a longer time period such as a year. This is a commonly used argument for net zero buildings. On the one hand it makes sense but on the other it relies on there being a wider fossil fuel powered grid in order to displace the fossil fuel generation and it substantially removes the incentive for renewable supply/demand matching.</p>

<h3 id="displaced-carbon">Displaced carbon</h3>
<p>Perhaps a better way to look at the displaced carbon issue is who is it that actually gets to claim the zero carbon benefit of that electricity. It would make sense that exported electricity is sold and then bought by the other party, once you’re buying renewable energy you would expect to be able to claim the zero carbon benefit of that energy as the user. Counting the exported electricity if bought by another user as displaced carbon would result in double counting in this case.</p>

<p>This is somewhat complicated by fact that exported solar pv electricity is not metered for small domestic installations in the UK. Instead the amount exported is assumed to be 50% of total generation. The exported electricity is paid for at around 4.91p/kWh but not measured. It’s not clear who gets to claim the carbon saved.</p>

<h3 id="next-aggregation">Next: Aggregation</h3>
<p>The degree of matching can be increased by aggregating supply and demand across several households. Not everyone boils a kettle at the same time or a cloud passing over one households solar pv system may not be passing over another’s. We have been testing with a limited number of households so far, the effect of aggregation on the degree of supply/demand matching which I will come on to in the next post.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Part 1: Attempting to measure and understand the CO2 intensity of grid electricity]]></title>
    <link href="https://blog.openenergymonitor.org/2016/04/Understand-CO2-intensity-grid-electricity/"/>
    <updated>2016-04-27T15:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/04/Understand-CO2-intensity-grid-electricity</id>
    <content type="html"><![CDATA[<p>Zero carbon energy scenarios such as <a href="http://zerocarbonbritain.org/">ZeroCarbonBritain</a> feature significant electrification of energy demands previously provided by fossil fuels such as heating and transport. With electrification it becomes possible to supply these energy demands with renewably generated electricity from primarily wind, solar and backed up by storage technologies from short term stores such as batteries to long term stores such as power to gas.</p>

<p>We do not of course yet have a zero carbon grid. However there has been significant growth of renewable energy and a decline in coal generation in recent years.</p>

<p>The CO2 emissions of demand side solutions such as heat pumps and electric vehicles are significantly affected by the co2 intensity of the supply but in many cases installing and using these technologies make sense at the UK’s present supply mix and can make more or less sense depending on how you calculate co2 intensity and where you assume the additional electricity required comes from.</p>

<!--more-->

<div class="highlighter-rouge"><pre class="highlight"><code>As an example the CO2 intensity of combined cycle gas turbines (CCGT) which provide the majority of electricity generated from gas in the UK have a co2 intensity of 360gCO2/kWh.

At this intensity a well installed heat pump that achieves an average COP of 3.0 delivers heat at a CO2 intensity of 129gCO2/kWh heat including 7% grid losses. This provides a significant 44% co2 emissions reduction compared to having an efficient gas boiler which delivers heat at a CO2 intensity of 230gCO2/kWh.

An electric car achieving a real world mountainous north Wales terrain driving efficiency of 3.7 miles per kWh (5.9km/kWh) including charging losses powered by gas electricity has a co2 intensity of 61gCO2/kWh which again provides a significant 44% co2 emissions reduction compared to real world efficient small petrol car co2 emissions of110 gCO2/km based on: 10.6 kgCO2 per gallon [1] and 60mpg (typical of the most efficient small car real world mpg [2].
</code></pre>
</div>
<p><a href="http://www.carbonindependent.org/sources_car.html">[1]</a>
<a href="http://www.whatcar.com/car-news/real-world-mpg-efficient-small-cars/1214063">[2]</a></p>

<p>The average CO2 intensity for the UK grid as a whole in 2015 was <a href="http://www.earth.org.uk/note-on-UK-grid-CO2-intensity-variations.html">367gCO2/kWh</a> http://www.earth.org.uk/note-on-UK-grid-CO2-intensity-variations.html#fullyear2015 - providing similar CO2 emission reduction potential to the gas only calculations above.</p>

<p>It is interesting to note that this average, results from coal generation with a CO2 intensity of 910gCO2/kWh being offset somewhat by generation from renewable energy and nuclear at 0gCO2/kWh resulting in a CO2 intensity that is close to what it would be if gas CCGT was our only supply source – which really highlights how carbon intensive coal is.</p>

<p>When we move energy demands from one form to another such as replacing a gas boiler with a heat pump the carbon reduction benefits depend heavily on what kind of generation provides for that additional demand. If the additional demand is provided for by CCGT gas turbines the switch makes sense, if it is provided by coal generation at 910gCO2/kWh it does not make so much sense. If it is provided by mix of renewable energy and CCGT is will make even more sense.</p>

<p>There are several different approaches to calculating the co2 intensity of delivered electricity each with their benefits and drawbacks which I will try and explore below and in further posts.</p>

<p>Whole grid averageHere we consider the grid as one big system with the CO2 intensity calculated as the total CO2 emitted by all forms of generation divided by the total demand over an extended period of time – one or more years. The co2 intensity of the UK electricity grid for 2015 was 367gCO2/kWh.</p>

<p>Near real-time co2 intensity using grid wide data</p>

<p>Here the CO2 intensity is calculated by the total CO2 emitted divided by total demand on typically a 10 minute basis. The CO2 intensity calculated this way will often show higher CO2 intensity in the day where gas and coal are a larger percentage of overall supply than at night time. CO2 intensity is also higher when its colder where demand is pushed up by higher heating requirements.</p>

<p><img src="https://blog.openenergymonitor.org/images/ukgrid.png" alt="UK Grid Carbon" /></p>

<p><a href="https://openenergymonitor.org/ukgrid">OpenEnergyMonitor UK Grid page</a> showing real-time CO2 Intensity.</p>

<p>If we use this real-time CO2 intensity in order to choose when to use electricity it gets more complicated, we may decide to shift electric vehicle charging or heat pump hot water heating to the night time in order to make use of grid carbon intensities that can often be 50-100gCO2/kWh less than day-time rates, but is this really a valid approach? The lower CO2 intensities at night are as a result of demand being lower and nuclear + renewables making up a larger share of generation, if night time demand is increased through demand shifting, turning on more gas and coal power plants, the carbon intensity would increase as well.</p>

<p>Given that most of the dis-patchable generation is gas and coal and assuming low levels of wind curtailment at night then it could be argued that the effective carbon intensity of moving demand to the night time should be calculated at the carbon intensity of this dis-patchable generation which depends on the proportion of gas to coal, a more in depth understanding as to how the proportion of gas and coal generation is decided would be needed to assess the carbon value of demand shifting. If the proportions are constant, shifting would make no difference, if gas is ramped up to meet the additional demand there may well be a benefit to shifting on the other hand if the difference is made up with more coal generation there would not be. There’s a bit more on this here using 2011 data from <a href="http://people.bath.ac.uk/en8sc/GridCarbonIntensity.pdf">Sam Cooper of Bath University</a> <a href="http://www.earth.org.uk/note-on-UK-grid-CO2-intensity-variations.html">linked from earth notes here</a>.</p>

<p>Shifting demand away from peak times may well make sense from a transmission and distribution grid capacity perspective but this is largely a different argument and would require a different calculation to assess. It may also be the case that some wind curtailment does take place although the precise extent of this and where on the grid using more will reduce curtailment is difficult to quantify.</p>

<p>In the next blog I will discuss the work I’ve been doing with Dominic McCann from the Carbon Coop on estimating CO2 intensity with onsite and green tariff renewable energy considered.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[GitHub Submodules]]></title>
    <link href="https://blog.openenergymonitor.org/2016/04/Git-Sub-Modules/"/>
    <updated>2016-04-18T15:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/04/Git-Sub-Modules</id>
    <content type="html"><![CDATA[<p><strong>Update: PlatformIO does library management much better then git-submodules, we have switched to using PatformIO to manage library dependencies, <a href="http://blog.openenergymonitor.org/2016/06/platformio/">see blog posts</a></strong></p>

<p>Library management for Arduino has always been a bit of a pain; having to go and download and install all the required libraries for various locations on the internet and hope that they are the correct version.  Library management becomes even more important when debugging and supporting a project as libraries get changed and updated.</p>

<p>Things have improved in recent years with the increased use of GitHub for Arduino libs allowing changes to be tracked easier and the later version of Arduino IDE including a library manager which can auto-update.</p>

<p>However I have always wanted to have all required libs and files for a particular project all in once place. I feel that I have now found the best solution (for now!).</p>

<!--more-->

<h2 id="github-submodules">GitHub Submodules</h2>

<blockquote>
  <p>With git submodules a repository can contain a checkout of another repository as a subdirectory.
The subfolder stores the submodule repository location and a commit ID. This means you can, for example, keep some common code in a separate repository and use a specific, known-working version of this code in other projects.
If the submodule gets an update, the submodule will not get updated in the repo until you specifically pull the changes into them. Also, you can make changes to the submodule from within a project and push those changes to the submodule’s repository to make them available to other projects.</p>
</blockquote>

<h2 id="example">Example</h2>

<p>Here is the firmware folder of the <a href="https://github.com/openenergymonitor/emonpi/tree/master/firmware/libraries">emonPi GitHub Repo</a>. The visible sub folders contain the required Arduino libs at a specific point in time.</p>

<p>Using submodules becomes very useful when testing an update to one of the libraries in a development branch, in the development branch the submodule can be fast-forwarded to the latest version leaving the master branch untouched.</p>

<p><img src="https://blog.openenergymonitor.org/images/submodules.png" alt="Git SubModules" /></p>

<p>Submodules also make it easy for users to clone a project repo including all the sketch source code and the Arduino libs at exactly the correct version all from one place. Using the later version of Arduino IDE (1.6+) it’s possible to set the sketchbook location to the project repo to import all the required libs into the IDE.</p>

<p>To obtain the submodules the repo must be Git cloned (not zip downloaded) then once the repo has been cloned a couple of extra steps are required to import the submodules. Here is an example for cloning the emonPi repo in pull in the sub modules:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ git clone https://github.com/openenergymonitor/emonpi
$ cd emonpi
$ git submodule update
$ git submodule init
$ git submodule update
</code></pre>
</div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Home Assistant and emonPi]]></title>
    <link href="https://blog.openenergymonitor.org/2016/04/Home-Assistant/"/>
    <updated>2016-04-01T17:00:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/04/Home-Assistant</id>
    <content type="html"><![CDATA[<p><a href="http://home-assistant.io/">Home Assistant</a> (HA) is a fully <a href="https://github.com/balloob/home-assistant">open-source</a> home automation platform.</p>

<p>In terms of functionality it’s quite similar to <a href="http://openenergymonitor.blogspot.co.uk/search/label/openHAB">openHAB</a> however it’s architecture is very different it runs on Python 3 as opposed to java.</p>

<p>I found home assistant very easy to setup and configure. It’s got some nice auto detect features e.g. It auto-detected by Chromecast devices. Home Assistant has got <a href="https://home-assistant.io/components/">pre-built component integrations</a> with many home automation and monitoring devices and platforms. I was also impressed with the presence detection support, I tested using <a href="https://home-assistant.io/components/device_tracker.nmap_scanner/">nmap</a> to scan my home router for presence of my phone connected to my home WiFi (indication that I’m home…or I forget my phone!) and <a href="https://home-assistant.io/components/device_tracker.owntracks/">OwnTracks</a> MQTT based GPS tracking.</p>

<!--more-->

<p>Interfacing with our <a href="http://openenergymonitor.org/emon/modules/emonpi">emonPi Raspberry Pi energy monitor</a> was easy, using MQTT component to connect to emonPi’s MQTT server and subscribe to the power and sensor readings of interest.</p>

<p>As yet I have not experimented with creating automations with HA .e.g turning off lights and heating when we’re not home. I think I will still prefer using nodeRED for these types of rule based automations. However what HA does well is present a nice clean, mobile friendly and easy to configure front-end interface:</p>

<p><img src="https://blog.openenergymonitor.org/images/ha1.jpg" alt="home assistant" />
My HA Home Setup So Far</p>

<p><img src="https://blog.openenergymonitor.org/images/ha2.png" alt="home assistant" />
Home Assistant has some nice mini graphing features to give you a quick overview.</p>

<p><img src="https://blog.openenergymonitor.org/images/ha3.png" alt="home assistant" /> <img src="https://blog.openenergymonitor.org/images/ha4.png" alt="home assistant" /></p>

<p>On a switch node a quite overview will tell you how long the switch has been on or off for. Very useful for checking long long the heating has been on for</p>

<p><img src="https://blog.openenergymonitor.org/images/ha5.png" alt="home assistant" /></p>

<p>Generic emonPi Config Example</p>

<p><a href="https://github.com/openenergymonitor/oem_home-assistant">I have published setup guide to setting up Home Assistant on an emonPi with example config</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Raspberry Pi 3 ]]></title>
    <link href="https://blog.openenergymonitor.org/2016/03/raspberry-pi-3/"/>
    <updated>2016-03-17T00:51:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/03/raspberry-pi-3</id>
    <content type="html"><![CDATA[The latest and greatest from the awesome Raspberry Pi team! An iterative upgrade but very welcome addition of on-board WiFi and a faster processor. <br /><br />The <a href="https://openenergymonitor.org/emon/node/12212">latest emonSD</a>&nbsp;for emonPi / emonBase&nbsp;seemed to work out of the box with the RasPi3, however it became apparent that something rather&nbsp;important was missing...serial communication with the emonPi's ATmega328!<br /><br />The emonPi communicates with the RasPi via GPIO 14/15 which on the Model B,B+ and Pi2 is mapped to UART0. However on the Pi3 these pins are mapped to UART1 since UART0 is now used for the Bluetooth module. However UART1 is software UART and baud rate is dependent to clock speed which can change with the CPU load, under voltage and temperature; therefore not stable enough. One hack is to force the CPU to a lower speed ( add core_freq=250 to /boot/cmdline.txt)which cripples the Pi3 performance.<br /><br />A better solution for the emonPi is to disable BT and map UART1 back to UART0 (ttyAMA0) so we can talk to the emonPi in the same way as before.<br /><br />

    <!--more-->

<div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-tu55USCyQO8/Vun9vCI01vI/AAAAAAABp0c/NPayDX64LusM8Uw1e0aX7QQri6Gqv--HA/s1600/IMG_20160301_164646193_HDR.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="225" src="https://2.bp.blogspot.com/-tu55USCyQO8/Vun9vCI01vI/AAAAAAABp0c/NPayDX64LusM8Uw1e0aX7QQri6Gqv--HA/s400/IMG_20160301_164646193_HDR.jpg" width="400" /></a></div><br />

First update:<br /><br /><pre>sudo apt-get update<br />sudo apt-get upgrade<br />sudo apt-get dist-upgrade<br />sudo rpi-update</pre><pre></pre><strong>To disable onboard&nbsp;Pi3 Bluetooth and restore UART0/ttyAMA0 over GPIOs 14 &amp; 15 modify:</strong><br /><pre></pre><pre>sudo nano /boot/config.txt</pre><pre></pre>Add to the end of the file<br /><br /><pre>dtoverlay=pi3-disable-bt</pre><pre></pre>We also need to run <br /><br /><pre>sudo systemctl disable hciuart<br /><br /> to stop the BT modem from trying to use the UART. See <a href="https://github.com/raspberrypi/firmware/commit/845eb064cb52af00f2ea33c0c9c54136f664a3e4">RasPi device tree commit for pi3-disable-bt</a> and raspi <a href="https://www.raspberrypi.org/forums/viewtopic.php?f=107&amp;t=138223">forum thread discussion</a>.</pre><br />Reboot and test serial coms with:<br /><br /><pre>sudo minicom -D /dev/ttyAMA0 -b38400</pre><div><br /></div><a href="https://openenergymonitor.org/emon/node/12311">
    

    
</a><a href="https://openenergymonitor.org/emon/node/12311">Forum post discussion</a><br /><div><pre></pre>There is an issue using the RasPi3 in the emonPi enclosure, for obvious reasons (laws of physics) the on-board Wifi does not like being enclosed in a metal box! We are working on getting some acrylic end-plates cut for testing. If this goes well, we will look at offering the RasPi3 with the emonPi&nbsp;+ acrylic end plates on the enclosure to enable the WiFi to operate correctly.<br /><br />Update: here's a photo of emonPi with prototype acrylic fascias. On-board WiFi works great :-)<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-m2AKbaYuYak/VvEY50spANI/AAAAAAABqGE/NCmZeMkRSEEbGg2EqGdhCPmAxT_J8wkwg/s1600/2016-03-19.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="266" src="https://1.bp.blogspot.com/-m2AKbaYuYak/VvEY50spANI/AAAAAAABqGE/NCmZeMkRSEEbGg2EqGdhCPmAxT_J8wkwg/s400/2016-03-19.jpg" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><span style="font-size: small; text-align: start;">emonPi with prototype acrylic fascias</span></td></tr></tbody></table><br /></div>
<br>
Update: Follow </a><a href="https://www.raspberrypi.org/forums/viewtopic.php?f=28&t=141195">this thread</a> to retain bluetooth functionality >
<br>
<br>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Outdoor Temperature Data from Weather Underground to Emoncms & MQTT]]></title>
    <link href="https://blog.openenergymonitor.org/2016/02/outdoor-temperature-data-from-weather/"/>
    <updated>2016-02-29T19:08:00+00:00</updated>
    <id>https://blog.openenergymonitor.org/2016/02/outdoor-temperature-data-from-weather</id>
    <content type="html"><![CDATA[Monitoring the temperature outside your house is super useful to inform your home automation systems and calculate domestic heating (and dressing!) requirements.<br /><br />One way is to monitor external temperature is to install your own external <a href="http://shop.openenergymonitor.com/emonth-433mhz-temperature-humidity-node/">emonTH wireless temperature node</a> or use a commercial web-connected weather station. However a cheaper way is to tap into the Internet of Things and connect to another weather station in your area. &nbsp;<a href="https://www.wunderground.com/weather/api/">Weather Underground</a> have over 18K weather stations online in the USA and a <a href="https://www.wunderground.com/weather/api/">free API</a> for non commercial use.<br /><br />Here's an example of using nodeRED to poll the Weather Underground API and post to Emoncms (using <a href="http://flows.nodered.org/node/node-red-node-emoncms">nodeRED Emoncms flow</a>) and MQTT.

<!--more-->

&nbsp;See bottom of the post for nodeRED flow export which you can import into your nodeRED by pasting into the import box.<br /><br />NodRED included pre-installed on <a href="https://openenergymonitor.org/emon/node/12212">the latest emonPi image (currently in release-candidate)</a>. The Emoncms flow is pre-installed, you will need to add the <a href="http://flows.nodered.org/node/node-red-node-weather-underground">nodeRED Weather Underground</a> flow by connecting via SSH and running :<br /><br />$ rpi-rw<br />$ cd ~/data/node-red<br />$ sudo npm install node-red-node-weather-underground<br />$ rpi-rw<br />$ exit<br /><br />Once installed you will need to paste in your API key and latitude and longitude (or city) into the Weather Underground node.<br /><br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://2.bp.blogspot.com/-mZJm0O0-xZM/VtSO8FO7O-I/AAAAAAABpIA/9wzoEv7Pz54/s1600/capture%2Bimage.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="290" src="https://2.bp.blogspot.com/-mZJm0O0-xZM/VtSO8FO7O-I/AAAAAAABpIA/9wzoEv7Pz54/s640/capture%2Bimage.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Example NodeRED flow pulling temperature data from Weather Underground to Emoncms and MQTT</td></tr></tbody></table><div class="separator" style="clear: both; text-align: center;"><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://4.bp.blogspot.com/-Q4L4K6rrVkY/VtSSuTC03sI/AAAAAAABpIQ/hXwY9yTgj-A/s1600/capture%2Bimage2.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="224" src="https://4.bp.blogspot.com/-Q4L4K6rrVkY/VtSSuTC03sI/AAAAAAABpIQ/hXwY9yTgj-A/s640/capture%2Bimage2.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Emoncms Internal &amp; External Temperature Multigraph</td></tr></tbody></table><div class="separator" style="clear: both; text-align: left;"><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-WQkcdh5STpY/VtSVU6WGhAI/AAAAAAABpIc/eWEaw8v0jj8/s1600/capture%2Bimage3.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="640" src="https://3.bp.blogspot.com/-WQkcdh5STpY/VtSVU6WGhAI/AAAAAAABpIc/eWEaw8v0jj8/s640/capture%2Bimage3.png" width="304" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">My openHAB dashboard displaying outdoor temperature and emonPi data from MQTT</td></tr></tbody></table><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Example nodeRED flow:&nbsp;</div><div class="separator" style="clear: both; text-align: center;"><span style="font-size: x-small;"><br /></span></div><div style="clear: both; text-align: left;"><span style="font-size: x-small;">[{"id":"14e3d598.a7352a","type":"emoncms-server","z":"4cd40f47.6c38f","server":"http://192.168.0.35/emoncms","name":"emonpi"},{"id":"286b0130.d794fe","type":"mqtt-broker","z":"","broker":"192.168.0.35","port":"1883","clientid":"","usetls":false,"verifyservercert":true,"compatmode":true,"keepalive":"15","cleansession":true,"willTopic":"","willQos":"0","willRetain":null,"willPayload":"","birthTopic":"","birthQos":"0","birthRetain":null,"birthPayload":""},{"id":"8e40f136.25c8c","type":"inject","z":"4cd40f47.6c38f","name":"Poke every 30min","topic":"","payload":"","payloadType":"str","repeat":"1800","crontab":"","once":true,"x":293.33331298828125,"y":616.3333740234375,"wires":[["801e0088.7a2eb"]]},{"id":"1d8fc53b.c7453b","type":"mqtt out","z":"4cd40f47.6c38f","name":"MQTT: weather/temp","topic":"weather/temp","qos":"","retain":"","broker":"286b0130.d794fe","x":840,"y":479,"wires":[]},{"id":"9dfe39d9.afac48","type":"debug","z":"4cd40f47.6c38f","name":"","active":true,"console":"false","complete":"payload","x":772,"y":395,"wires":[]},{"id":"c647a520.c30618","type":"debug","z":"4cd40f47.6c38f","name":"View full output","active":true,"console":"false","complete":"payload","x":581.3333129882812,"y":589.3333740234375,"wires":[]},{"id":"17551590.ce038a","type":"function","z":"4cd40f47.6c38f","name":"Return temp deg C","func":"context.global.outdoor_temp = msg.payload.tempc; &nbsp;\nreturn {payload:context.global.outdoor_temp};","outputs":1,"noerr":0,"x":533.3333129882812,"y":454.3333435058594,"wires":[["1d8fc53b.c7453b","9dfe39d9.afac48","50f404a6.f89bac"]]},{"id":"801e0088.7a2eb","type":"wunderground","z":"4cd40f47.6c38f","name":"","lon":"-4.1716485","lat":"53.1429426","city":"","country":"","x":321,"y":529,"wires":[["17551590.ce038a","c647a520.c30618"]]},{"id":"50f404a6.f89bac","type":"emoncms","z":"4cd40f47.6c38f","name":"Emoncms","emonServer":"14e3d598.a7352a","nodegroup":"weather","x":800,"y":539,"wires":[]}]</span></div>]]></content>
  </entry>
  
</feed>
