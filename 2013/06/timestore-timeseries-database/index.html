<!doctype html>
  <!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
  <!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
  <!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
  <!--[if gt IE 8]><!--> <html> <!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Timestore timeseries database - Blog | OpenEnergyMonitor</title>
    <meta name="author" content="Glyn Hudson">
    <meta name="description" content="OpenEnergyMonitor Blog">
    
    <meta name="viewport" content="width=device-width">
    <link rel="canonical" href="https://blog.openenergymonitor.org/2013/06/timestore-timeseries-database/">

    <meta property="fb:app_id" content="">
    <meta property="og:title" content="Timestore timeseries database">
    <meta property="og:site_name" content="Blog | OpenEnergyMonitor">
    <meta property="og:url" content="https://blog.openenergymonitor.org/2013/06/timestore-timeseries-database/">
    <meta property="og:type" content="article">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@openenergymon">
    
    <meta name="twitter:title" content="Timestore timeseries database">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
    <link href="/atom.xml" rel="alternate" title="Blog | OpenEnergyMonitor" type="application/atom+xml">
    <link rel='shortcut icon' href='/images/favicon.ico' />
    <link rel='icon' type='image/png' href='/images/favicon-192x192.png' sizes='192x192' />
    
    
    
    <link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<link rel="icon" type="image/png" sizes="196x196" href="/images/favicon-192.png">
	<link rel="icon" type="image/png" sizes="160x160" href="/images/favicon-160.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96.png">
	<link rel="icon" type="image/png" sizes="64x64" href="/images/favicon-64.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.png">
	<link rel="apple-touch-icon" href="/images/favicon-57.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/images/favicon-114.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/images/favicon-72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/images/favicon-144.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/images/favicon-60.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/images/favicon-120.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/images/favicon-76.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/images/favicon-152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-180.png">
	<meta name="msapplication-TileColor" content="#FFFFFF">
	<meta name="msapplication-TileImage" content="/images/favicon-144.png">
	<meta name="msapplication-config" content="/images/browserconfig.xml">
	
  </head>

  <body >

    <header>
      <div class="grid-wrapper">
  <div class="grid">

    <div class="grid__item three-tenths lap-two-sixths palm-one-whole ha-title">
  <a href="/" class="site-title">
    <!--<img width='40' src='/images/favicon-192x192.png'> -->
    
    <span style="color:#555;font-weight:bold;font-family:Arial;font-size:20"'>
Open</span><span style="color:#0699fa;font-weight:bold;font-family:Arial;font-size:20"'>EnergyMonitor</span>

  </a>
</div>

<div class="grid__item seven-tenths lap-four-sixths palm-one-whole">
  <nav>
    <input type="checkbox" id="toggle">
<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu"></label>
<ul class="menu pull-right">
  <li><a href="https://openenergymonitor.org">Main Site</a></li>
  <li><a href="https://guide.openenergymonitor.org">User Guide</a></li>
  <li><a href="https://emoncms.org">Emoncms</a></li>
  <li><a href="https://community.openenergymonitor.org">Community</a></li>
  <li><a href="https://shop.openenergymonitor.com    ">Shop<i class="icon icon-shopping-cart"></i></a></li>
</ul>
  </nav>
</div>

  </div>
</div>
    </header>

    

    <div class="grid-wrapper">
      <div class="grid grid-center">
        
        <div class="grid__item two-thirds lap-one-whole palm-one-whole">
        

          <article class="post">
  <div class='edit-github'><a href='https://github.com/openenergymonitor/blog/tree/master/source/_posts/2013-06-03-timestore-timeseries-database.html'>Edit on GitHub</a></div>
<div class='edit-github'><a href='http://prose.io/#openenergymonitor/blog/edit/master/source/_posts/2013-06-03-timestore-timeseries-database.html'>Edit on GitHub Prose</a></div>
  
  <header>
  
  <h1 class="title indent">Timestore timeseries database</h1>
  

  
  <div class="meta clearfix">
    <time datetime="2013-06-03T14:03:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2013-06-03 14:03:00 +00002013-06-03 14:03:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> four minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emoncms/'>emoncms</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2013/06/timestore-timeseries-database/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  The first and most developed solution to both the query speed problem and disk space problem is timestore.<br /><br /><a href="http://www.mike-stirling.com/redmine/projects/timestore" style="color: #3465a4;">http://www.mike-stirling.com/redmine/projects/timestore</a><br /><br />Timestore is a lightweight time-series database developed by Mike Stirling. It uses a NoSQL approach to store an arbitrary number of time points without an index.<br /><br /><b>Query speeds</b><br />Timestore is fast, here's the figures given by Mike Stirling on the documentation page:<br /><br />From the resulting data set containing 1M points spanning about 1 year on 30 second intervals:<br /><br />Retrieve 100 points from the first hour: 2.6 ms<br />Retrieve 1000 points from the first hour (duplicates inserted automatically): 6.2 ms<br />Retrieve 100 points over the entire dataset (about a year worth): 2.5 ms<br />Retrieve 1000 points over the entire dataset: 7.0 ms<br /><br /><b>Disk use</b><br /><br />Timestore uses a double as a default data type which is 8 bytes. The current emoncms mysql database stores data values as floats which take up 4 bytes, its easy to change the data type in timestore so for a fair comparison we can change the default datatype to a 4-byte float:<br /><br />Layer 1: 10s layer = 3153600 datapoints x 4 bytes = 12614400 bytes<br />Layer 2: 60 layer1 datapoints averaged = 52560 datapoints x 4 bytes = 210240 Bytes<br />Layer 3: 10 layer2 datapoints averaged = 5256 datapoints x 4 bytes = 21024 bytes<br />Layer 4: 6 layer3 datapoints averaged = 876 datapoints x 4 bytes = 7008 bytes<br />Layer 5: 6 layer4 datapoints averaged = 146 datapoints x 4 bytes = 1168 bytes<br />Layer 6: 4 layer5 datapoints averaged = 36 datapoints x 4 bytes = 288 bytes<br />Layer 7: 7 layer6 datapoints averaged = 5 datapoints x 4 bytes = 40 bytes<br /><br /><b>total size = 12854168 Bytes or 12.26Mb</b><br /><br />The current emoncms data storage implementation uses 60Mb to hold the same data as it saves both the timestamp and an associated index. Timestore therefore has the potential to reduce diskuse by 80% for realtime data feeds.<br /><br />Interestingly all the downsampled layers created by timestore only come too <b>0.23 Mb</b>. Before doing the calculation above I used to think that adding all the downsampled layers would add to the problem of disk space significantly but evidently it a very small contribution compared with the full resolution data layer.<br /><br /><b>Emoncms timestore development branch</b><br /><br />I made a start on integrating timestore in emoncms, there's still a lot to do to make it fully functional but it works as a demo for now, here's how to get it setup:<br /><br /><b>1) Download, make and start timestore</b><br /><br />$ git clone <a href="http://mikestirling.co.uk/git/timestore.git" style="color: #3465a4;">http://mikestirling.co.uk/git/timestore.git</a><br />$ cd timestore<br />$ make<br />$ cd src<br />$ sudo ./timestore -d<br /><br />Fetch the admin key<br /><br />$ cd <a href="http://www.blogger.com/var/lib/timestore" style="color: #3465a4;">/var/lib/timestore</a><br />$ nano adminkey.txt<br /><br />copy the admin key which looks something like this: POpP)@H=1[#MJYX&lt;(i{YZ.0/Ni.5,g~&lt;<br />the admin key is generated anew every time timestore is restarted.<br /><br /><b>2) Download and setup the emoncms timestore branch</b><br /><br />Download copy of the timestore development branch<br /><br />$ git clone -b timestore <a href="https://github.com/emoncms/emoncms.git" style="color: #3465a4;">https://github.com/emoncms/emoncms.git</a> timestore<br /><br />Create a mysql database for emoncms and enter database settings into settings.php.<br /><br />Add a line to settings.php with the timestore adminkey:<br />$timestore_adminkey = "POpP)@H=1[#MJYX&lt;(i{YZ.0/Ni.5,g~&lt;";<br /><br />Create a user and login<br /><br />The development branch currently only implements timestore for realtime data and the feed/data api is restricted to timestore data only which means that daily data does not work. The use of timestore for daily data needs to be implemented.<br /><br />The feed model methods implemented to use timestore so far are create, insert_data and get_data.<br /><br /><b>Try it out</b><br /><br />Navigate to the feeds tab, click on feed API helper, create a new feed by typing:<br /><a href="http://localhost/timestore/feed/create.json?name=power&amp;type=1" style="color: #3465a4;">http://localhost/timestore/feed/create.json?name=power&amp;type=1</a><br /><br />It should return {"success":true,"feedid":1}<br /><br />Navigate back to feeds, you should now see your power feed in the list.<br />Navigate again to the api helper to fetch the insert data api url<br /><br />Call the insert data api a few times over say a minute (so that we have at least 6 datapoints - one every 10 seconds).&nbsp;Vary the value to make it more interesting:<br /><a href="http://localhost/timestore/feed/insert.json?id=1&amp;value=100.0" style="color: #3465a4;">http://localhost/timestore/feed/insert.json?id=1&amp;value=100.0</a><br /><br />Select the rawdata visualisation from the vis menu<br /><a href="http://localhost/timestore/vis/rawdata&amp;feedid=1" style="color: #3465a4;">http://localhost/timestore/vis/rawdata&amp;feedid=1</a><br /><br />zoom to the last couple of minutes to see the data.<br /><br /><br />I met Mike Stirling a little over a month ago in Chester for a beer and a chat after Mike originally got in contact to let me know about timestore. We discussed data storage, secure authentication, low cost temperature sensing and <a href="http://www.earth.org.uk/open-source-programmable-thermostatic-radiator-valve.html">openTRV</a> the project Mike is working on. I think there could be great benefit to work on making what we're developing here with openenergymonitor interoperable with what Mike and others are developing with openTRV, especially as we develop more building heating and building fabric performance monitoring tools. This could all develop into a super nice open source whole building energy (both electric and heat) monitoring and control ecosystem of hardware and software tools.<br /><br />Check out Mike's blog here:<br /><br /><a href="http://www.mike-stirling.com/">http://www.mike-stirling.com/</a><br />and&nbsp;<a href="http://www.earth.org.uk/open-source-programmable-thermostatic-radiator-valve.html">http://www.earth.org.uk/open-source-programmable-thermostatic-radiator-valve.html</a>
      <b>To engage in discussion regarding this post, please post on our <a href="http://community.openenergymonitor.org">Community Forum</a></b>.
    <br>
</article>



        </div>

        
        <aside id="sidebar" class="grid__item one-third lap-one-whole palm-one-whole">
          <div class="grid">

 
 <section id="recent-posts" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">Recent Posts</h1>
  <ul class="divided">
    
      
        <li class="post">
          <a href="/2016/09/emonth2/">Introducing emonTH V2</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/09/summer-placement/">Summer Placement</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/08/ecohomelab-control/">EcoHome Lab: From Monitoring to Control</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/07/HTU21D-Temperature-Humidity-sensor/">HTU21D / Si72021 Temperature and Humidity Sensor</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/06/esp8266-ota-update/">Part 3/3: Continuous Deployment (Over-The-Air Update to ESP8266)</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/06/emoncms-docker/">Emoncms Docker</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/06/esp8266-emonesp-developments/">ESP8266 WIFI developments</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/06/auto-build-continuous-test-firmware/">Part 2/3: Firmware Continuous Test & Build</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/06/platformio/">Part 1/3: PlatformIO open-source embedded development ecosystem</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/06/emonpi-vrms-line-fault/">Electrical Supply Line Fault</a>
        </li>
      
    
  </ul>
</section>
  
  
</div>
        </aside>
        
      </div>
    </div>

    <footer>
      <div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item">
      <style>


div.searchtool {
  position: relative;
  display: inline-block;
  top: -6px;
}

input[type=text] {
  border: 3px solid #0699fa;
}

fieldset {
  border: 0;
}

</style>
<div class="copyright">

  <a rel="me" href='https://twitter.com/openenergymon'><i class="icon-twitter"></i></a>
  <a rel="me" href='https://github.com/openenergymonitor/guide'><i class="icon-github"></i></a>
  <a rel="me" href='https://blog.openenergymonitor.org/feed.xml'><i class="icon-rss"></i></a>

  <div class="credit">
    Website powered by <a href='http://jekyllrb.com/'>Jekyll</a> and <a href='https://github.com/coogie/oscailte'>Oscalite</a>.<br />
    Hosted by <a href='https://pages.github.com/'>GitHub</a> and served by <a href='https://cloudflare.com'>CloudFlare</a>.
  </div>

<div class="searchtool">


<form action="https://encrypted.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.openenergymonitor.org" />
    <input class="search" id="search" type="text" name="q" results="0" placeholder="Search..." />
  </fieldset>
</form>


</div>
</div>
    </div>
  </div>
</div>
    </footer>

    <!--[if lt IE 7]>
      <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->

    <script>
  var _gaq=[['_setAccount','UA-10321170-4'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
<script>
  var disqus_shortname = 'openenergymonitor';
  
    
    var disqus_script = 'count.js';
  
  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>


<script>
  $(document).ready(function(){
    if (!window.jXHR){
      var jxhr = document.createElement('script');
      jxhr.type = 'text/javascript';
      jxhr.src = '/javascripts/libs/jXHR.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jxhr, s);
    }

    github.showRepos({
      user: 'openenergymonitor',
      count: 5,
      skip_forks: true,
      target: '#gh_repos'
    });
  });
</script>
<script src="/javascripts/github.js"></script>

  </body>
</html>