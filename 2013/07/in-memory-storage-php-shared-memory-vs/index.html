<!doctype html>
  <!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
  <!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
  <!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
  <!--[if gt IE 8]><!--> <html> <!--<![endif]-->

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>In memory storage: PHP shared memory vs Redis vs MYSQL - Blog | OpenEnergyMonitor</title>
    <meta name="author" content="Glyn Hudson">
    <meta name="description" content="OpenEnergyMonitor Blog">
    
    <meta name="viewport" content="width=device-width">
    <link rel="canonical" href="https://blog.openenergymonitor.org/2013/07/in-memory-storage-php-shared-memory-vs/">

    <meta property="fb:app_id" content="">
    <meta property="og:title" content="In memory storage: PHP shared memory vs Redis vs MYSQL">
    <meta property="og:site_name" content="Blog | OpenEnergyMonitor">
    <meta property="og:url" content="https://blog.openenergymonitor.org/2013/07/in-memory-storage-php-shared-memory-vs/">
    <meta property="og:type" content="article">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@openenergymon">
    
    <meta name="twitter:title" content="In memory storage: PHP shared memory vs Redis vs MYSQL">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="https://guide.openenergymonitor.org/images/favicon-192x192.png">

    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
    <link href="/atom.xml" rel="alternate" title="Blog | OpenEnergyMonitor" type="application/atom+xml">
    <link rel='shortcut icon' href='/images/favicon.ico' />
    <link rel='icon' type='image/png' href='/images/favicon-192x192.png' sizes='192x192' />
    
    
    
    <link rel="shortcut icon" href="/favicon.ico">
	<link rel="icon" sizes="16x16 32x32 64x64" href="/favicon.ico">
	<link rel="icon" type="image/png" sizes="196x196" href="/images/favicon-192.png">
	<link rel="icon" type="image/png" sizes="160x160" href="/images/favicon-160.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96.png">
	<link rel="icon" type="image/png" sizes="64x64" href="/images/favicon-64.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.png">
	<link rel="apple-touch-icon" href="/images/favicon-57.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/images/favicon-114.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/images/favicon-72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/images/favicon-144.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/images/favicon-60.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/images/favicon-120.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/images/favicon-76.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/images/favicon-152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-180.png">
	<meta name="msapplication-TileColor" content="#FFFFFF">
	<meta name="msapplication-TileImage" content="/images/favicon-144.png">
	<meta name="msapplication-config" content="/images/browserconfig.xml">
	
  </head>

  <body >

    <header>
      <div class="grid-wrapper">
  <div class="grid">

    <div class="grid__item three-tenths lap-two-sixths palm-one-whole ha-title">
  <a href="/" class="site-title">
    <!--<img width='40' src='/images/favicon-192x192.png'> -->
    
    <span style="color:#555;font-weight:bold;font-family:Arial;font-size:20"'>
Open</span><span style="color:#0699fa;font-weight:bold;font-family:Arial;font-size:20"'>EnergyMonitor</span>

  </a>
</div>

<div class="grid__item seven-tenths lap-four-sixths palm-one-whole">
  <nav>
    <input type="checkbox" id="toggle">
<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu"></label>
<ul class="menu pull-right">
  <li><a href="http://openenergymonitor.org">Home</a></li>
  <li><a href="http://shop.openenergymonitor.com">Online-Store</a></li>
  <li><a href="http://guide.openenergymonitor.org">User Guide</a></li>
  <li><a href="http://emoncms.org">Emoncms</a></li>
  <li><a href="http://community.openenergymonitor.org">Forum</a></li>
</ul>
  </nav>
</div>

  </div>
</div>
    </header>

    

    <div class="grid-wrapper">
      <div class="grid grid-center">
        
        <div class="grid__item two-thirds lap-one-whole palm-one-whole">
        

          <article class="post">
  <div class='edit-github'><a href='https://github.com/openenergymonitor/blog/tree/master/source/_posts/2013-07-04-in-memory-storage-php-shared-memory-vs.html'>Edit this post on GitHub</a></div>
  
  <header>
  
  <h1 class="title indent">In memory storage: PHP shared memory vs Redis vs MYSQL</h1>
  

  
  <div class="meta clearfix">
    <time datetime="2013-07-04T09:25:00+00:00" pubdate data-updated="true"><i class="icon-calendar"></i> 2013-07-04 09:25:00 +00002013-07-04 09:25:00 +0000
    <span class="byline author vcard"><i class='icon-user'></i> Trystan Lea</span> <br>
    <span><i class='icon-time'></i> three minutes reading time</span> <br>
    <span>
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/categories/emoncms/'>emoncms</a></li>
      
        <li><a class='category' href='/categories/feed-storage/'>feed storage</a></li>
      
    
    </ul>
  </span> <br>
    
      <a class='comments'
         href="/2013/07/in-memory-storage-php-shared-memory-vs/#disqus_thread"
         >Comments</a>
    
  </div>
  
</header>


  Continuing on the theme of rethinking the data core of emoncms, as <a href="http://openenergymonitor.blogspot.co.uk/2013/06/rethinking-data-input-and-storage-core.html">previously mentioned</a> for short term storage, storage to disk may not be necessary, instead we can store data in memory using an in-memory database. Here are some tests and benchmarks for in memory storage:<br /><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">To start with I created baseline test using MYSQL updating a feed's last time and value in the feeds table row for that feed. This took around: 4800 – 5100 ms to update a row 10000 times.</div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;"><a href="https://github.com/emoncms/experimental/blob/master/storage/inmemory/baselinemysql.php">https://github.com/emoncms/experimental/blob/master/storage/inmemory/baselinemysql.php</a></div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">We would imagine Redis doing a lot better as its in-memory, it&nbsp;isn't&nbsp;writing to disk each time which is much slower than memory access. Redis did indeed perform faster completing the same number of updates to a key-value pair in 1900 – 2350ms.&nbsp;I'm&nbsp;a little surprised thought that it was only 2.3x as fast and not much faster, but then there is a lot going on Redis has its own server which needs to be accessed from the PHP client this is going to slow things down a bit, I tested both the phpredis client and Predis. Phpredis was between 500-1000 ms faster than the Predis client and is written in c.</div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;"><a href="https://github.com/emoncms/experimental/blob/master/storage/inmemory/redis.php">https://github.com/emoncms/experimental/blob/master/storage/inmemory/redis.php</a></div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">How fast can in-memory storage be? A general program variable is also a form of in-memory storage, a quick test suggests that it takes 21ms to write to a program variable 10000 times, much better than 2.3x faster&nbsp;that's&nbsp;230x faster! The problem with in program variables is that if they are written to in one script say an instance of input/post they cannot be accessed by another instance serving feed/list, we need some form of storage that can be accessed across different instances of scripts.</div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;"><a href="https://github.com/emoncms/experimental/blob/master/storage/inmemory/programvariable.php">https://github.com/emoncms/experimental/blob/master/storage/inmemory/programvariable.php</a></div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">The difference between 21ms and 1900-2350ms for redis is intriguingly large and so I thought I would search for other ways of storing data in-memory that would allow access between different application scripts and instances.</div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">I came across the PHP shared memory functions which are similar to the flat file access but for memory, the results of a simple test are encouraging showing a write time of 48ms for 10000 updates. So from a performance perspective using php shared memory looks like a better way of doing things.  </div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;"><a href="https://github.com/emoncms/experimental/blob/master/storage/inmemory/sharedmemory.php">https://github.com/emoncms/experimental/blob/master/storage/inmemory/sharedmemory.php</a></div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">The issue though is implementation, mysql made it really easy to search for the feed rows that you wanted (either by selecting by feed id or by feeds that belong to a user or feeds that are public), I'm a little unsure about how best to implement the similar functionality in redis but it looks like it may be possible by just storing each feed meta data roughly like this: feed_1: {"time":1300,"value":20}.  </div><div style="margin-bottom: 0cm;"><br /></div><div style="margin-bottom: 0cm;">Shared memory though looks like it could be quite a bit more complicated to implement, but then it does appear to be much faster. Maybe the 2.3x speed improvement over mysql offered by redis is fast enough? and its probably much faster in high-concurrency&nbsp;situations. I think more testing and attempts at writing full implementations using each approach is needed before a definitive answer can be reached.</div>
      <b>To engage in discussion regarding this post, please post on our <a href="http://community.openenergymonitor.org">Community Forum</a></b>.
    <br>
</article>



        </div>

        
        <aside id="sidebar" class="grid__item one-third lap-one-whole palm-one-whole">
          <div class="grid">

 
 <section id="recent-posts" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">Recent Posts</h1>
  <ul class="divided">
    
      
        <li class="post">
          <a href="/2016/05/emonsd-update-03may16/">emonPi emonSD pre-built SD card update</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/05/emonpi-raspberrypi3/">emonPi / emonBase Raspberry Pi 3</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/05/emoncms-qr/">Emoncms android App QR Code Scanner Setup</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/05/website-changes/">New Forum, Blog and User Guide Website</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/05/Part3-Aggregated-supply-and-demand/">Part 3: Aggregated supply and demand across multiple households</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/04/Part2-Exploring-carbon-intensity/">Part 2: Exploring carbon intensity and renewable energy matching</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/04/Understand-CO2-intensity-grid-electricity/">Part 1: Attempting to measure and understand the CO2 intensity of grid electricity</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/04/Git-Sub-Modules/">GitHub Submodules</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/04/Home-Assistant/">Home Assistant and emonPi</a>
        </li>
      
    
      
        <li class="post">
          <a href="/2016/03/raspberry-pi-3/">Raspberry Pi 3 </a>
        </li>
      
    
  </ul>
</section>
  
  
</div>
        </aside>
        
      </div>
    </div>

    <footer>
      <div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item">
      <div class="copyright">
    
    
        <form action="https://encrypted.google.com/search" method="get">
          <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.openenergymonitor.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
          </fieldset>
        </form>
    
  <a rel="me" href='https://twitter.com/openenergymon'><i class="icon-twitter"></i></a>
  <a rel="me" href='https://github.com/openenergymonitor'><i class="icon-github"></i></a>
  <a rel="me" href='https://blog.openenergymonitor.org/feed.xml'><i class="icon-rss"></i></a>

  <div class="credit">
    Website powered by <a href='http://jekyllrb.com/'>Jekyll</a> and the <a href='https://github.com/coogie/oscailte'>Oscalite theme</a>.<br />
    Hosted by <a href='https://pages.github.com/'>GitHub</a> and served by <a href='https://cloudflare.com'>CloudFlare</a>.
  </div>
</div>
    </div>
  </div>
</div>
    </footer>

    <!--[if lt IE 7]>
      <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->

    <script>
  var _gaq=[['_setAccount','UA-10321170-4'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
<script>
  var disqus_shortname = 'openenergymonitor';
  
    
    var disqus_script = 'count.js';
  
  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>


<script>
  $(document).ready(function(){
    if (!window.jXHR){
      var jxhr = document.createElement('script');
      jxhr.type = 'text/javascript';
      jxhr.src = '/javascripts/libs/jXHR.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jxhr, s);
    }

    github.showRepos({
      user: 'openenergymonitor',
      count: 5,
      skip_forks: true,
      target: '#gh_repos'
    });
  });
</script>
<script src="/javascripts/github.js"></script>

  </body>
</html>